<!DOCTYPE html>

<!--

    Licensed to the Apache Software Foundation (ASF) under one
    or more contributor license agreements.  See the NOTICE file
    distributed with this work for additional information
    regarding copyright ownership.  The ASF licenses this file
    to you under the Apache License, Version 2.0 (the
    "License"); you may not use this file except in compliance
    with the License.  You may obtain a copy of the License at

      http://www.apache.org/licenses/LICENSE-2.0

    Unless required by applicable law or agreed to in writing,
    software distributed under the License is distributed on an
    "AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
    KIND, either express or implied.  See the License for the
    specific language governing permissions and limitations
    under the License.

-->

<html>
  <head>
    <!--

    Licensed to the Apache Software Foundation (ASF) under one
    or more contributor license agreements.  See the NOTICE file
    distributed with this work for additional information
    regarding copyright ownership.  The ASF licenses this file
    to you under the Apache License, Version 2.0 (the
    "License"); you may not use this file except in compliance
    with the License.  You may obtain a copy of the License at

      http://www.apache.org/licenses/LICENSE-2.0

    Unless required by applicable law or agreed to in writing,
    software distributed under the License is distributed on an
    "AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
    KIND, either express or implied.  See the License for the
    specific language governing permissions and limitations
    under the License.

-->
<title>PulsarにおけるWebSocket API</title>

<meta charset="utf-8">

<link rel="stylesheet" href="/css/style.css">
<link rel="shortcut icon" href="/img/favicon.ico">

<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/tether/1.4.0/js/tether.min.js"></script>
<script src="https://code.jquery.com/ui/1.12.1/jquery-ui.min.js"></script>
<script src="/js/jquery.tocify.min.js"></script>
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0-alpha.6/js/bootstrap.min.js" integrity="sha384-vBWWzlZJ8ea9aCX4pEW3rVHjgjt7zpkNpZk+02D9phzyeVkE+jo0ieGizqPLForn" crossorigin="anonymous"></script>

<script src="/js/jquery.scrollTo.min.js"></script>
<script async src="/js/main.js"></script>

  </head>
  <body class="body">
    <main class="main">
      <!--

    Licensed to the Apache Software Foundation (ASF) under one
    or more contributor license agreements.  See the NOTICE file
    distributed with this work for additional information
    regarding copyright ownership.  The ASF licenses this file
    to you under the Apache License, Version 2.0 (the
    "License"); you may not use this file except in compliance
    with the License.  You may obtain a copy of the License at

      http://www.apache.org/licenses/LICENSE-2.0

    Unless required by applicable law or agreed to in writing,
    software distributed under the License is distributed on an
    "AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
    KIND, either express or implied.  See the License for the
    specific language governing permissions and limitations
    under the License.

-->

<nav class="navbar navbar-toggleable-md navbar-light sticky-top">
  <button class="navbar-toggler navbar-toggler-right" type="button" data-toggle="collapse" data-target="#navbarNavDropdown" aria-controls="navbarNavDropdown" aria-expanded="false" aria-label="Toggle navigation">
    <span class="navbar-toggler-icon"></span>
  </button>

  
  <a class="navbar-brand" href="/">
    <img class="main-logo" src="/img/pulsar-logo.png" alt="Pulsar logo">
  </a>
  

  <a class="navbar-nav"></a>

  <div class="collapse navbar-collapse justify-content-end" id="navbarNavDropdown">
    <ul class="navbar-nav">
      <li class="nav-item dropdown">
        <a class="nav-link dropdown-toggle" href="#" id="clientLibsDropdown" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">Documentation</a>

        <div class="dropdown-menu" aria-labelledby="documentationDropdown">
          <a class="dropdown-item" href="/docs/latest/getting-started/LocalCluster">Latest</a>

          <div class="dropdown-divider"></div>
          <h3 class="dropdown-header">Stable release</h3>
          <a class="dropdown-item" href="/docs/v2.0.1-incubating/getting-started/LocalCluster">2.0.1-incubating</a>

          
              <div class="dropdown-divider"></div>
              <h3 class="dropdown-header">Other releases</h3>

              
                  <a class="dropdown-item" href="/docs/v1.22.1-incubating/getting-started/LocalCluster">1.22.1-incubating</a>
              
                  <a class="dropdown-item" href="/docs/v2.0.0-rc1-incubating/getting-started/LocalCluster">2.0.0-rc1-incubating</a>
              
                  <a class="dropdown-item" href="/docs/v1.22.0-incubating/getting-started/LocalCluster">1.22.0-incubating</a>
              
                  <a class="dropdown-item" href="/docs/v1.21.0-incubating/getting-started/LocalCluster">1.21.0-incubating</a>
              
                  <a class="dropdown-item" href="/docs/v1.20.0-incubating/getting-started/LocalCluster">1.20.0-incubating</a>
              
                  <a class="dropdown-item" href="/docs/v1.19.0-incubating/getting-started/LocalCluster">1.19.0-incubating</a>
              
          
        </div>
      </li>

      <li class="nav-item">
          <a class="nav-link" href="/download">Download</a>
      </li>

      <li class="nav-item dropdown">
        <a class="nav-link dropdown-toggle" href="#" id="clientLibsDropdown" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
          Client libraries
        </a>
        <div class="dropdown-menu" aria-labelledby="clientLibsDropdown">
          <a class="dropdown-item" href="/docs/latest/clients/Java">
            Java
          </a>
          <a class="dropdown-item" href="/docs/latest/clients/go">
            Go
          </a>
          <a class="dropdown-item" href="/docs/latest/clients/Python">
            Python
          </a>
          <a class="dropdown-item" href="/docs/latest/clients/Cpp">
            C++
          </a>
          <div class="dropdown-divider"></div>
          <a class="dropdown-item" href="/api/client">
            Java client Javadoc
          </a>
          <a class="dropdown-item" href="/api/admin">
            Java admin Javadoc
          </a>
          <a class="dropdown-item" href="https://godoc.org/github.com/apache/incubator-pulsar/pulsar-client-go/pulsar">
            GoDoc
          </a>
          <a class="dropdown-item" href="/api/pulsar-functions">
            Pulsar Functions Java SDK
          </a>
          <a class="dropdown-item" href="/api/python">
            Python API docs
          </a>
          <a class="dropdown-item" href="/api/cpp">
            C++ API docs
          </a>
        </div>
      </li>

      <li class="nav-item dropdown">
        <a class="nav-link dropdown-toggle" href="#" id="versionsDropdown" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
          Community
        </a>
        <div class="dropdown-menu dropdown-left" aria-labelledby="versionsDropdown">
          <h3 class="dropdown-header">Get in touch</h3>
          <a class="dropdown-item" href="/contact">Contact</a>
          <a class="dropdown-item" href="/events/current-event">Events</a>
          <a class="dropdown-item" href="https://twitter.com/Apache_Pulsar">Twitter</a>
          <a class="dropdown-item" href="https://github.com/apache/incubator-pulsar/wiki">Wiki</a>
          <a class="dropdown-item" href="https://github.com/apache/incubator-pulsar/issues">Issue tracking</a>
          <div class="dropdown-divider"></div>
          <h3 class="dropdown-header">Resources</h3>
          <a class="dropdown-item" href="/resources">Resources</a>
          <a class="dropdown-item" href="/team">Team</a>
          <div class="dropdown-divider"></div>
          <h3 class="dropdown-header">Apache</h3>
          <a class="dropdown-item" href="https://www.apache.org/">The Apache Software Foundation</a>
          <a class="dropdown-item" href="https://www.apache.org/licenses/">License</a>
          <a class="dropdown-item" href="https://www.apache.org/foundation/sponsorship.html">Sponsorship</a>
          <a class="dropdown-item" href="https://www.apache.org/foundation/thanks.html">Thanks</a>
          <a class="dropdown-item" href="https://www.apache.org/security">Security</a>
        </div>
      </li>
    </ul>
  </div>
  <a class="hidden-md-down" href="http://www.apache.org/">
    <img class="asf-logo" title="Apache Software Foundation" src="/img/feather.png" />
  </a>
</nav>

<!--
<nav class="navbar navbar-toggleable-md navbar-light" style="border: 1px solid red;">
  <button class="navbar-toggler navbar-toggler-right" type="button" data-toggle="collapse" data-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
    <span class="navbar-toggler-icon"></span>
  </button>

  <a class="navbar-brand" href="/">
    <img src="/img/pulsar-logo.png" class="d-inline-block align-top" alt="Pulsar logo" height="40" width="60">
  </a>

  <div class="collapse navbar-collapse" id="navbarSupportedContent">
    <ul class="navbar-nav mr-auto">
      <li class="nav-item active">
        <a class="nav-link" href="#">Home <span class="sr-only">(current)</span></a>
      </li>
      <li class="nav-item">
        <a class="nav-link" href="#">Link</a>
      </li>
      <li class="nav-item">
        <a class="nav-link disabled" href="#">Disabled</a>
      </li>
    </ul>
  </div>
</nav>-->


      <main>
        <!--

    Licensed to the Apache Software Foundation (ASF) under one
    or more contributor license agreements.  See the NOTICE file
    distributed with this work for additional information
    regarding copyright ownership.  The ASF licenses this file
    to you under the Apache License, Version 2.0 (the
    "License"); you may not use this file except in compliance
    with the License.  You may obtain a copy of the License at

      http://www.apache.org/licenses/LICENSE-2.0

    Unless required by applicable law or agreed to in writing,
    software distributed under the License is distributed on an
    "AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
    KIND, either express or implied.  See the License for the
    specific language governing permissions and limitations
    under the License.

-->


<div class="docs-container container-fluid">
  <div class="row">
    <nav class="sidebar-nav hidden-md-down col-lg-3">
      <!--

    Licensed to the Apache Software Foundation (ASF) under one
    or more contributor license agreements.  See the NOTICE file
    distributed with this work for additional information
    regarding copyright ownership.  The ASF licenses this file
    to you under the Apache License, Version 2.0 (the
    "License"); you may not use this file except in compliance
    with the License.  You may obtain a copy of the License at

      http://www.apache.org/licenses/LICENSE-2.0

    Unless required by applicable law or agreed to in writing,
    software distributed under the License is distributed on an
    "AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
    KIND, either express or implied.  See the License for the
    specific language governing permissions and limitations
    under the License.

-->


<aside class="sidebar-nav">
  <div id="sidebar-accordion" role="tablist" aria-multiselectable="true">
    
    
    <div class="card">
      <div class="card-header" role="tab" id="heading-入門">
        <h5>
          <a data-toggle="collapse" data-parent="#sidebar-accordion" href="#collapse-入門" aria-controls="collapse-入門">
            入門
          </a>
        </h5>
      </div>

      <div class="sidebar-group collapse" id="collapse-入門" role="tabpanel" aria-labelledby="heading-入門">
        <ul>
          
          
          <li>
            <a href="/ja/getting-started/LocalCluster">
              ローカルでPulsarを起動
            </a>
          </li>
          
          
          <li>
            <a href="/ja/getting-started/Clients">
              クライアントライブラリ
            </a>
          </li>
          
          
          <li>
            <a href="/ja/getting-started/ConceptsAndArchitecture">
              コンセプトとアーキテクチャ
            </a>
          </li>
          
        </ul>
      </div>
    </div>
    
    
    <div class="card">
      <div class="card-header" role="tab" id="heading-デプロイ">
        <h5>
          <a data-toggle="collapse" data-parent="#sidebar-accordion" href="#collapse-デプロイ" aria-controls="collapse-デプロイ">
            デプロイ
          </a>
        </h5>
      </div>

      <div class="sidebar-group collapse" id="collapse-デプロイ" role="tabpanel" aria-labelledby="heading-デプロイ">
        <ul>
          
          
          <li>
            <a href="/ja/deployment/InstanceSetup">
              ベアメタル
            </a>
          </li>
          
          
          <li>
            <a href="/ja/deployment/Kubernetes">
              Kubernetes
            </a>
          </li>
          
          
          <li>
            <a href="/ja/deployment/Kubernetes/#google-kubernetes-engine">
              Google Kubernetes Engine
            </a>
          </li>
          
          
          <li>
            <a href="/ja/deployment/Kubernetes/#amazon-web-services">
              AWS
            </a>
          </li>
          
          
          <li>
            <a href="/ja/deployment/Monitoring">
              監視
            </a>
          </li>
          
        </ul>
      </div>
    </div>
    
    
    <div class="card">
      <div class="card-header" role="tab" id="heading-管理">
        <h5>
          <a data-toggle="collapse" data-parent="#sidebar-accordion" href="#collapse-管理" aria-controls="collapse-管理">
            管理
          </a>
        </h5>
      </div>

      <div class="sidebar-group collapse" id="collapse-管理" role="tabpanel" aria-labelledby="heading-管理">
        <ul>
          
          
          <li>
            <a href="/ja/admin/AdminInterface">
              Pulsar adminインターフェース
            </a>
          </li>
          
          
          <li>
            <a href="/ja/admin/ClustersBrokers">
              クラスタとBroker
            </a>
          </li>
          
          
          <li>
            <a href="/ja/admin/PropertiesNamespaces">
              プロパティとネームスペース
            </a>
          </li>
          
          
          <li>
            <a href="/ja/admin/ZooKeeperBookKeeper">
              ZooKeeperとBookKeeper
            </a>
          </li>
          
          
          <li>
            <a href="/ja/admin/Dashboard">
              ダッシュボード
            </a>
          </li>
          
          
          <li>
            <a href="/ja/admin/Authz">
              認証と認可
            </a>
          </li>
          
          
          <li>
            <a href="/ja/admin/GeoReplication">
              ジオレプリケーション
            </a>
          </li>
          
          
          <li>
            <a href="/ja/admin/Stats">
              統計情報
            </a>
          </li>
          
          
          <li>
            <a href="/ja/admin/ModularLoadManager">
              モジュラロードマネージャ
            </a>
          </li>
          
        </ul>
      </div>
    </div>
    
    
    <div class="card">
      <div class="card-header" role="tab" id="heading-クライアントライブラリ">
        <h5>
          <a data-toggle="collapse" data-parent="#sidebar-accordion" href="#collapse-クライアントライブラリ" aria-controls="collapse-クライアントライブラリ">
            クライアントライブラリ
          </a>
        </h5>
      </div>

      <div class="sidebar-group collapse" id="collapse-クライアントライブラリ" role="tabpanel" aria-labelledby="heading-クライアントライブラリ">
        <ul>
          
          
          <li>
            <a href="/ja/clients/Java">
              Java
            </a>
          </li>
          
          
          <li>
            <a href="/ja/clients/Cpp">
              C++
            </a>
          </li>
          
          
          <li>
            <a href="/ja/clients/Python">
              Python
            </a>
          </li>
          
          
          <li>
            <a href="/ja/clients/WebSocket">
              WebSocket API
            </a>
          </li>
          
        </ul>
      </div>
    </div>
    
    
    <div class="card">
      <div class="card-header" role="tab" id="heading-アダプタ">
        <h5>
          <a data-toggle="collapse" data-parent="#sidebar-accordion" href="#collapse-アダプタ" aria-controls="collapse-アダプタ">
            アダプタ
          </a>
        </h5>
      </div>

      <div class="sidebar-group collapse" id="collapse-アダプタ" role="tabpanel" aria-labelledby="heading-アダプタ">
        <ul>
          
          
          <li>
            <a href="/ja/adaptors/PulsarSpark">
              Spark Streaming
            </a>
          </li>
          
          
          <li>
            <a href="/ja/adaptors/PulsarStorm">
              Apache Storm
            </a>
          </li>
          
        </ul>
      </div>
    </div>
    
    
    <div class="card">
      <div class="card-header" role="tab" id="heading-高度な機能">
        <h5>
          <a data-toggle="collapse" data-parent="#sidebar-accordion" href="#collapse-高度な機能" aria-controls="collapse-高度な機能">
            高度な機能
          </a>
        </h5>
      </div>

      <div class="sidebar-group collapse" id="collapse-高度な機能" role="tabpanel" aria-labelledby="heading-高度な機能">
        <ul>
          
          
          <li>
            <a href="/ja/advanced/PartitionedTopics">
              パーティションドトピック
            </a>
          </li>
          
          
          <li>
            <a href="/ja/advanced/RetentionExpiry">
              保存と有効期限
            </a>
          </li>
          
        </ul>
      </div>
    </div>
    
    
    <div class="card">
      <div class="card-header" role="tab" id="heading-開発">
        <h5>
          <a data-toggle="collapse" data-parent="#sidebar-accordion" href="#collapse-開発" aria-controls="collapse-開発">
            開発
          </a>
        </h5>
      </div>

      <div class="sidebar-group collapse" id="collapse-開発" role="tabpanel" aria-labelledby="heading-開発">
        <ul>
          
          
          <li>
            <a href="/ja/project/SimulationTools">
              シミュレーションツール
            </a>
          </li>
          
          
          <li>
            <a href="/ja/project/BinaryProtocol">
              バイナリプロトコル
            </a>
          </li>
          
          
          <li>
            <a href="/ja/project/Codebase">
              コードベース
            </a>
          </li>
          
        </ul>
      </div>
    </div>
    
    
    <div class="card">
      <div class="card-header" role="tab" id="heading-リファレンス">
        <h5>
          <a data-toggle="collapse" data-parent="#sidebar-accordion" href="#collapse-リファレンス" aria-controls="collapse-リファレンス">
            リファレンス
          </a>
        </h5>
      </div>

      <div class="sidebar-group collapse" id="collapse-リファレンス" role="tabpanel" aria-labelledby="heading-リファレンス">
        <ul>
          
          
          <li>
            <a href="/ja/reference/RestApi">
              Pulsar REST API
            </a>
          </li>
          
          
          <li>
            <a href="/ja/reference/CliTools">
              コマンドラインツール
            </a>
          </li>
          
          
          <li>
            <a href="/ja/reference/Configuration">
              設定
            </a>
          </li>
          
        </ul>
      </div>
    </div>
    
  </div>
</aside>


    </nav>

    <article class="col-xs-12 col-sm-12 col-md-12 col-lg-7">
      <section class="docs-header">
        <h1 class="docs-title">PulsarにおけるWebSocket API</h1>
        
        <section class="tags">
          
          <!-- <span class="badge badge-pill badge-primary">websocket</span> -->
          <button type="button" class="btn btn-primary" data-toggle="modal" data-target="#modal-websocket">websocket</button>
          <!--

    Licensed to the Apache Software Foundation (ASF) under one
    or more contributor license agreements.  See the NOTICE file
    distributed with this work for additional information
    regarding copyright ownership.  The ASF licenses this file
    to you under the Apache License, Version 2.0 (the
    "License"); you may not use this file except in compliance
    with the License.  You may obtain a copy of the License at

      http://www.apache.org/licenses/LICENSE-2.0

    Unless required by applicable law or agreed to in writing,
    software distributed under the License is distributed on an
    "AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
    KIND, either express or implied.  See the License for the
    specific language governing permissions and limitations
    under the License.

-->
<div class="modal fade" id="modal-websocket">
  <div class="modal-dialog" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title"><strong>websocket</strong>タグのページ一覧</h5>
      </div>
      <div class="modal-body">
        <ul>
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          <li><a href="/ja/clients/WebSocket/">PulsarにおけるWebSocket API</a></li>
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
        </ul>
      </div>
    </div>
  </div>
</div>

          
          <!-- <span class="badge badge-pill badge-primary">nodejs</span> -->
          <button type="button" class="btn btn-primary" data-toggle="modal" data-target="#modal-nodejs">nodejs</button>
          <!--

    Licensed to the Apache Software Foundation (ASF) under one
    or more contributor license agreements.  See the NOTICE file
    distributed with this work for additional information
    regarding copyright ownership.  The ASF licenses this file
    to you under the Apache License, Version 2.0 (the
    "License"); you may not use this file except in compliance
    with the License.  You may obtain a copy of the License at

      http://www.apache.org/licenses/LICENSE-2.0

    Unless required by applicable law or agreed to in writing,
    software distributed under the License is distributed on an
    "AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
    KIND, either express or implied.  See the License for the
    specific language governing permissions and limitations
    under the License.

-->
<div class="modal fade" id="modal-nodejs">
  <div class="modal-dialog" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title"><strong>nodejs</strong>タグのページ一覧</h5>
      </div>
      <div class="modal-body">
        <ul>
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          <li><a href="/ja/clients/WebSocket/">PulsarにおけるWebSocket API</a></li>
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
        </ul>
      </div>
    </div>
  </div>
</div>

          
          <!-- <span class="badge badge-pill badge-primary">python</span> -->
          <button type="button" class="btn btn-primary" data-toggle="modal" data-target="#modal-python">python</button>
          <!--

    Licensed to the Apache Software Foundation (ASF) under one
    or more contributor license agreements.  See the NOTICE file
    distributed with this work for additional information
    regarding copyright ownership.  The ASF licenses this file
    to you under the Apache License, Version 2.0 (the
    "License"); you may not use this file except in compliance
    with the License.  You may obtain a copy of the License at

      http://www.apache.org/licenses/LICENSE-2.0

    Unless required by applicable law or agreed to in writing,
    software distributed under the License is distributed on an
    "AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
    KIND, either express or implied.  See the License for the
    specific language governing permissions and limitations
    under the License.

-->
<div class="modal fade" id="modal-python">
  <div class="modal-dialog" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title"><strong>python</strong>タグのページ一覧</h5>
      </div>
      <div class="modal-body">
        <ul>
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          <li><a href="/ja/clients/Python/">Pulsar Pythonクライアント</a></li>
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          <li><a href="/ja/clients/WebSocket/">PulsarにおけるWebSocket API</a></li>
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
        </ul>
      </div>
    </div>
  </div>
</div>

          
        </section>

        <hr class="hr">
      </section>

      <section class="content">
        <!--

    Licensed to the Apache Software Foundation (ASF) under one
    or more contributor license agreements.  See the NOTICE file
    distributed with this work for additional information
    regarding copyright ownership.  The ASF licenses this file
    to you under the Apache License, Version 2.0 (the
    "License"); you may not use this file except in compliance
    with the License.  You may obtain a copy of the License at

      http://www.apache.org/licenses/LICENSE-2.0

    Unless required by applicable law or agreed to in writing,
    software distributed under the License is distributed on an
    "AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
    KIND, either express or implied.  See the License for the
    specific language governing permissions and limitations
    under the License.

-->

<p>Pulsarにおける<a href="https://developer.mozilla.org/ja/docs/Web/API/WebSockets_API">WebSocket</a> APIは公式の<a href="../../getting-started/Clients">クライアントライブラリ</a>のない言語からもPulsarとメッセージをやり取りする簡単な方法を提供することを意味します。WebSocketを通してメッセージの送受信と<a href="../Java">Java</a>, <a href="../Python">Python</a>, <a href="../Cpp">C++</a>クライアントライブラリから利用可能な全機能を利用できます。</p>

<!--

    Licensed to the Apache Software Foundation (ASF) under one
    or more contributor license agreements.  See the NOTICE file
    distributed with this work for additional information
    regarding copyright ownership.  The ASF licenses this file
    to you under the Apache License, Version 2.0 (the
    "License"); you may not use this file except in compliance
    with the License.  You may obtain a copy of the License at

      http://www.apache.org/licenses/LICENSE-2.0

    Unless required by applicable law or agreed to in writing,
    software distributed under the License is distributed on an
    "AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
    KIND, either express or implied.  See the License for the
    specific language governing permissions and limitations
    under the License.

-->
<div class="admonition">
  <div class="success">
    
    <p>PulsarのWebSocket APIはどのWebSocketクライアントライブラリからでも利用できます。PythonとNode.jsのサンプルは<a href="#クライアントの実装例">こちら</a>にあります。</p>

  </div>
</div>

<h2 id="websocketサービスの起動">WebSocketサービスの起動</h2>

<p><a href="../../getting-started/LocalCluster">ローカルでの開発</a>で推奨しているPulsarの<span class="popover-term" tabindex="0" title="スタンドアローンのPulsar Brokerとは？" data-placement="top" data-content="単一のJVMプロセス上で全てのコンポーネントが起動される軽量なPulsar Brokerのことです。スタンドアローンのクラスタは単一のマシン上で実行され、開発時に役立ちます。" data-toggle="popover" data-trigger="focus">スタンドアローン</span>モードではすでにWebSocketサービスは利用可能な状態です。</p>

<p>スタンドアローン以外のモードではWebSocketサービスをデプロイする方法が2つあります:</p>
<ul>
  <li>Pulsar <span class="popover-term" tabindex="0" title="Brokerとは？" data-placement="top" data-content="2つの異なるコンポーネントを実行するPulsarクラスタのステートレスなコンポーネントです。2つのコンポーネントとは管理操作とトピックルックアップのためのRESTインターフェースを提供するHTTPサーバと全てのメッセージの転送を処理するディスパッチャです。またPulsarクラスタは基本的に複数のBrokerから構成されます。" data-toggle="popover" data-trigger="focus">Broker</span>に<a href="#pulsar-brokerに組み込む">組み込む</a></li>
  <li><a href="#独立したコンポーネントとして起動">独立したコンポーネント</a>として起動する</li>
</ul>

<h3 id="pulsar-brokerに組み込む">Pulsar Brokerに組み込む</h3>

<p>このモードでは、WebSocketサービスはBrokerですでに起動されている同じHTTPサービス内に起動します。このモードを有効にするには、 <a href="../../reference/Configuration#broker"><code class="highlighter-rouge">conf/broker.conf</code></a>ファイルに<a href="../../reference/Configuration#broker-webSocketServiceEnabled"><code class="highlighter-rouge">webSocketServiceEnabled</code></a>パラメータをセットします。</p>

<div class="language-properties highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="py">webSocketServiceEnabled</span><span class="p">=</span><span class="s">true</span>
</code></pre></div></div>

<h3 id="独立したコンポーネントとして起動">独立したコンポーネントとして起動</h3>

<p>このモードでは、Pulsar <span class="popover-term" tabindex="0" title="Brokerとは？" data-placement="top" data-content="2つの異なるコンポーネントを実行するPulsarクラスタのステートレスなコンポーネントです。2つのコンポーネントとは管理操作とトピックルックアップのためのRESTインターフェースを提供するHTTPサーバと全てのメッセージの転送を処理するディスパッチャです。またPulsarクラスタは基本的に複数のBrokerから構成されます。" data-toggle="popover" data-trigger="focus">Broker</span>とは別サービスとして起動されます。このモードの設定は<a href="../../reference/Configuration#websocket"><code class="highlighter-rouge">conf/websocket.conf</code></a>ファイルでハンドリングされます。<em>少なくとも</em>以下のパラメータを設定する必要があります:</p>

<ul>
  <li><a href="../../reference/Configuration#websocket-globalZookeeperServers"><code class="highlighter-rouge">globalZookeeperServers</code></a></li>
  <li><a href="../../reference/Configuration#websocket-webServicePort"><code class="highlighter-rouge">webServicePort</code></a></li>
  <li><a href="../../reference/Configuration#websocket-clusterName"><code class="highlighter-rouge">clusterName</code></a></li>
</ul>

<p>こちらは設定例です:</p>

<div class="language-properties highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="py">globalZookeeperServers</span><span class="p">=</span><span class="s">zk1:2181,zk2:2181,zk3:2181</span>
<span class="py">webServicePort</span><span class="p">=</span><span class="s">8080</span>
<span class="py">clusterName</span><span class="p">=</span><span class="s">my-cluster</span>
</code></pre></div></div>

<h3 id="websocketサービスの起動-1">WebSocketサービスの起動</h3>

<p>設定を行なったら、<a href="../../reference/CliTools#pulsar-daemon"><code class="highlighter-rouge">pulsar-daemon</code></a>ツールを利用してサービスを起動できます:</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>bin/pulsar-daemon start websocket
</code></pre></div></div>

<h2 id="apiリファレンス">APIリファレンス</h2>

<p>PulsarのWebSocket APIは2つのエンドポイントを提供します。メッセージを<a href="#producerエンドポイント">produce</a>するためのエンドポイントと<a href="#consumerエンドポイント">consume</a>するためのエンドポイントです。</p>

<p>WebSocket APIを介した全てのやり取りはJSONで行われます。</p>

<h3 id="producerエンドポイント">Producerエンドポイント</h3>

<p>ProducerエンドポイントはURLで<span class="popover-term" tabindex="0" title="プロパティとは？" data-placement="top" data-content="Pulsarのテナントです。" data-toggle="popover" data-trigger="focus">プロパティ</span>、<span class="popover-term" tabindex="0" title="クラスタとは？" data-placement="top" data-content="Pulsar BrokerとBookKeeperサーバ (Bookie) のセットのことです。それぞれのクラスタは異なる地理的地域に存在することができ、メッセージをクラスタ間で相互に複製することができます。この機能をジオレプリケーションと呼びます。" data-toggle="popover" data-trigger="focus">クラスタ</span>、<span class="popover-term" tabindex="0" title="ネームスペースとは？" data-placement="top" data-content="関連トピックのグループ化メカニズムです。" data-toggle="popover" data-trigger="focus">ネームスペース</span>、<span class="popover-term" tabindex="0" title="トピックとは？" data-placement="top" data-content="Producerが発行したメッセージをConsumerに届けるために使用される名前付きのチャネルです。" data-toggle="popover" data-trigger="focus">トピック</span>を指定します:</p>

<div class="highlighter-rouge endpoint"><pre class="highlight"><code class="method "></code><code class="url">ws://broker-service-url<span class="endpoint">:8080</span>/ws/producer/persistent/<span class="endpoint">:property</span>/<span class="endpoint">:cluster</span>/<span class="endpoint">:namespace</span>/<span class="endpoint">:topic</span></code></pre></div>

<h4 id="メッセージの送信">メッセージの送信</h4>
<div class="language-json highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">{</span><span class="w">
  </span><span class="s2">"payload"</span><span class="p">:</span><span class="w"> </span><span class="s2">"SGVsbG8gV29ybGQ="</span><span class="p">,</span><span class="w">
  </span><span class="s2">"properties"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="s2">"key1"</span><span class="p">:</span><span class="w"> </span><span class="s2">"value1"</span><span class="p">,</span><span class="w"> </span><span class="s2">"key2"</span><span class="p">:</span><span class="w"> </span><span class="s2">"value2"</span><span class="p">},</span><span class="w">
  </span><span class="s2">"context"</span><span class="p">:</span><span class="w"> </span><span class="s2">"1"</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div></div>

<table>
  <thead>
    <tr>
      <th style="text-align: left">キー</th>
      <th style="text-align: left">型</th>
      <th style="text-align: left">必須?</th>
      <th style="text-align: left">説明</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td style="text-align: left"><code class="highlighter-rouge">payload</code></td>
      <td style="text-align: left">string</td>
      <td style="text-align: left">必須</td>
      <td style="text-align: left">Base-64エンコードされたペイロード</td>
    </tr>
    <tr>
      <td style="text-align: left"><code class="highlighter-rouge">properties</code></td>
      <td style="text-align: left">key-value pairs</td>
      <td style="text-align: left">任意</td>
      <td style="text-align: left">アプリケーションによって定義されたプロパティ</td>
    </tr>
    <tr>
      <td style="text-align: left"><code class="highlighter-rouge">context</code></td>
      <td style="text-align: left">string</td>
      <td style="text-align: left">任意</td>
      <td style="text-align: left">アプリケーションによって定義されたリクエスト識別子</td>
    </tr>
    <tr>
      <td style="text-align: left"><code class="highlighter-rouge">key</code></td>
      <td style="text-align: left">string</td>
      <td style="text-align: left">任意</td>
      <td style="text-align: left">パーティションドトピックの場合、使用するパーティション</td>
    </tr>
    <tr>
      <td style="text-align: left"><code class="highlighter-rouge">replicationClusters</code></td>
      <td style="text-align: left">array</td>
      <td style="text-align: left">任意</td>
      <td style="text-align: left">レプリケーションを行う<span class="popover-term" tabindex="0" title="クラスタとは？" data-placement="top" data-content="Pulsar BrokerとBookKeeperサーバ (Bookie) のセットのことです。それぞれのクラスタは異なる地理的地域に存在することができ、メッセージをクラスタ間で相互に複製することができます。この機能をジオレプリケーションと呼びます。" data-toggle="popover" data-trigger="focus">クラスタ</span>をここで指定したものだけに制限</td>
    </tr>
  </tbody>
</table>

<h5 id="成功時のレスポンス例">成功時のレスポンス例</h5>

<div class="language-json highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">{</span><span class="w">
   </span><span class="s2">"result"</span><span class="p">:</span><span class="w"> </span><span class="s2">"ok"</span><span class="p">,</span><span class="w">
   </span><span class="s2">"messageId"</span><span class="p">:</span><span class="w"> </span><span class="s2">"CAAQAw=="</span><span class="p">,</span><span class="w">
   </span><span class="s2">"context"</span><span class="p">:</span><span class="w"> </span><span class="s2">"1"</span><span class="w">
 </span><span class="p">}</span><span class="w">
</span></code></pre></div></div>
<h5 id="失敗時のレスポンス例">失敗時のレスポンス例</h5>

<div class="language-json highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="w"> </span><span class="p">{</span><span class="w">
   </span><span class="s2">"result"</span><span class="p">:</span><span class="w"> </span><span class="s2">"send-error:3"</span><span class="p">,</span><span class="w">
   </span><span class="s2">"errorMsg"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Failed to de-serialize from JSON"</span><span class="p">,</span><span class="w">
   </span><span class="s2">"context"</span><span class="p">:</span><span class="w"> </span><span class="s2">"1"</span><span class="w">
 </span><span class="p">}</span><span class="w">
</span></code></pre></div></div>

<table>
  <thead>
    <tr>
      <th style="text-align: left">キー</th>
      <th style="text-align: left">型</th>
      <th style="text-align: left">必須?</th>
      <th style="text-align: left">説明</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td style="text-align: left"><code class="highlighter-rouge">result</code></td>
      <td style="text-align: left">string</td>
      <td style="text-align: left">必須</td>
      <td style="text-align: left">成功時は<code class="highlighter-rouge">ok</code>、失敗時はエラーメッセージ</td>
    </tr>
    <tr>
      <td style="text-align: left"><code class="highlighter-rouge">messageId</code></td>
      <td style="text-align: left">string</td>
      <td style="text-align: left">必須</td>
      <td style="text-align: left">produceされたメッセージに割り当てられたメッセージID</td>
    </tr>
    <tr>
      <td style="text-align: left"><code class="highlighter-rouge">context</code></td>
      <td style="text-align: left">string</td>
      <td style="text-align: left">任意</td>
      <td style="text-align: left">アプリケーションによって定義されたリクエスト識別子</td>
    </tr>
  </tbody>
</table>

<h3 id="consumerエンドポイント">Consumerエンドポイント</h3>

<p>Consumerエンドポイントは<span class="popover-term" tabindex="0" title="プロパティとは？" data-placement="top" data-content="Pulsarのテナントです。" data-toggle="popover" data-trigger="focus">プロパティ</span>、<span class="popover-term" tabindex="0" title="クラスタとは？" data-placement="top" data-content="Pulsar BrokerとBookKeeperサーバ (Bookie) のセットのことです。それぞれのクラスタは異なる地理的地域に存在することができ、メッセージをクラスタ間で相互に複製することができます。この機能をジオレプリケーションと呼びます。" data-toggle="popover" data-trigger="focus">クラスタ</span>、<span class="popover-term" tabindex="0" title="ネームスペースとは？" data-placement="top" data-content="関連トピックのグループ化メカニズムです。" data-toggle="popover" data-trigger="focus">ネームスペース</span>、<span class="popover-term" tabindex="0" title="トピックとは？" data-placement="top" data-content="Producerが発行したメッセージをConsumerに届けるために使用される名前付きのチャネルです。" data-toggle="popover" data-trigger="focus">トピック</span>と同様に<span class="popover-term" tabindex="0" title="サブスクリプションとは？" data-placement="top" data-content="Consumerによって確立されたトピック上のリースです。Pulsarには3つのサブスクリプションモード (exclusive, shared, failover) があります。" data-toggle="popover" data-trigger="focus">サブスクリプション</span>もURLで指定します:</p>

<div class="highlighter-rouge endpoint"><pre class="highlight"><code class="method "></code><code class="url">ws://broker-service-url<span class="endpoint">:8080</span>/ws/consumer/persistent/<span class="endpoint">:property</span>/<span class="endpoint">:cluster</span>/<span class="endpoint">:namespace</span>/<span class="endpoint">:topic</span>/<span class="endpoint">:subscription</span></code></pre></div>

<h5 id="メッセージの受信">メッセージの受信</h5>

<p>WebSocketセッション上でサーバからメッセージがプッシュされます:</p>

<div class="language-json highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">{</span><span class="w">
  </span><span class="s2">"messageId"</span><span class="p">:</span><span class="w"> </span><span class="s2">"CAAQAw=="</span><span class="p">,</span><span class="w">
  </span><span class="s2">"payload"</span><span class="p">:</span><span class="w"> </span><span class="s2">"SGVsbG8gV29ybGQ="</span><span class="p">,</span><span class="w">
  </span><span class="s2">"properties"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="s2">"key1"</span><span class="p">:</span><span class="w"> </span><span class="s2">"value1"</span><span class="p">,</span><span class="w"> </span><span class="s2">"key2"</span><span class="p">:</span><span class="w"> </span><span class="s2">"value2"</span><span class="p">},</span><span class="w">
  </span><span class="s2">"publishTime"</span><span class="p">:</span><span class="w"> </span><span class="s2">"2016-08-30 16:45:57.785"</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div></div>

<table>
  <thead>
    <tr>
      <th style="text-align: left">キー</th>
      <th style="text-align: left">型</th>
      <th style="text-align: left">必須?</th>
      <th style="text-align: left">説明</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td style="text-align: left"><code class="highlighter-rouge">messageId</code></td>
      <td style="text-align: left">string</td>
      <td style="text-align: left">必須</td>
      <td style="text-align: left">メッセージID</td>
    </tr>
    <tr>
      <td style="text-align: left"><code class="highlighter-rouge">payload</code></td>
      <td style="text-align: left">string</td>
      <td style="text-align: left">必須</td>
      <td style="text-align: left">Base-64エンコードされたペイロード</td>
    </tr>
    <tr>
      <td style="text-align: left"><code class="highlighter-rouge">publishTime</code></td>
      <td style="text-align: left">string</td>
      <td style="text-align: left">必須</td>
      <td style="text-align: left">メッセージがproduceされた時間のタイムスタンプ</td>
    </tr>
    <tr>
      <td style="text-align: left"><code class="highlighter-rouge">properties</code></td>
      <td style="text-align: left">key-value pairs</td>
      <td style="text-align: left">任意</td>
      <td style="text-align: left">アプリケーションによって定義されたプロパティ</td>
    </tr>
    <tr>
      <td style="text-align: left"><code class="highlighter-rouge">key</code></td>
      <td style="text-align: left">string</td>
      <td style="text-align: left">任意</td>
      <td style="text-align: left">Producerによってセットされたオリジナルのルーティングキー</td>
    </tr>
  </tbody>
</table>

<h4 id="ack-確認応答">Ack (確認応答)</h4>

<p>Pulsar Brokerがメッセージを削除できるように、Consumerはメッセージが正常に処理できたというAckを返す必要があります。</p>

<div class="language-json highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">{</span><span class="w">
  </span><span class="s2">"messageId"</span><span class="p">:</span><span class="w"> </span><span class="s2">"CAAQAw=="</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div></div>

<table>
  <thead>
    <tr>
      <th style="text-align: left">キー</th>
      <th style="text-align: left">型</th>
      <th style="text-align: left">必須?</th>
      <th style="text-align: left">説明</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td style="text-align: left"><code class="highlighter-rouge">messageId</code></td>
      <td style="text-align: left">string</td>
      <td style="text-align: left">必須</td>
      <td style="text-align: left">処理したメッセージのメッセージID</td>
    </tr>
  </tbody>
</table>

<h3 id="エラーコード">エラーコード</h3>
<p>エラーの場合、サーバは次のエラーコードを利用してWebSocketセッションをクローズします:</p>

<table>
  <thead>
    <tr>
      <th style="text-align: left">エラーコード</th>
      <th style="text-align: left">エラーメッセージ</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td style="text-align: left">1</td>
      <td style="text-align: left">Producerの作成に失敗</td>
    </tr>
    <tr>
      <td style="text-align: left">2</td>
      <td style="text-align: left">購読に失敗</td>
    </tr>
    <tr>
      <td style="text-align: left">3</td>
      <td style="text-align: left">JSONからのデシリアライズに失敗</td>
    </tr>
    <tr>
      <td style="text-align: left">4</td>
      <td style="text-align: left">JSONへのシリアライズに失敗</td>
    </tr>
    <tr>
      <td style="text-align: left">5</td>
      <td style="text-align: left">クライアントの認証に失敗</td>
    </tr>
    <tr>
      <td style="text-align: left">6</td>
      <td style="text-align: left">クライアントが認可されていない</td>
    </tr>
    <tr>
      <td style="text-align: left">7</td>
      <td style="text-align: left">ペイロードの誤ったエンコード</td>
    </tr>
    <tr>
      <td style="text-align: left">8</td>
      <td style="text-align: left">未知のエラー</td>
    </tr>
  </tbody>
</table>

<!--

    Licensed to the Apache Software Foundation (ASF) under one
    or more contributor license agreements.  See the NOTICE file
    distributed with this work for additional information
    regarding copyright ownership.  The ASF licenses this file
    to you under the Apache License, Version 2.0 (the
    "License"); you may not use this file except in compliance
    with the License.  You may obtain a copy of the License at

      http://www.apache.org/licenses/LICENSE-2.0

    Unless required by applicable law or agreed to in writing,
    software distributed under the License is distributed on an
    "AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
    KIND, either express or implied.  See the License for the
    specific language governing permissions and limitations
    under the License.

-->
<div class="admonition">
  <div class="warning">
    
    <p>アプリケーションは、バックオフ期間後にWebSocketセッションを再確立する責任があります。</p>

  </div>
</div>

<h2 id="クライアントの実装例">クライアントの実装例</h2>

<p>以下は<a href="#python">Python</a>と<a href="#nodejs">Node.js</a>のサンプルコードです。</p>

<h3 id="python">Python</h3>

<p>この例では<a href="https://pypi.python.org/pypi/websocket-client"><code class="highlighter-rouge">websocket-client</code></a>パッケージを利用します。<a href="https://pypi.python.org/pypi/pip">pip</a>を利用してインストールできます:</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>pip <span class="nb">install </span>websocket-client
</code></pre></div></div>

<p><a href="https://pypi.python.org/pypi/websocket-client">PyPI</a>から直接ダウンロードすることもできます。</p>

<h4 id="python-producer">Python Producer</h4>

<p>Pulsarの<span class="popover-term" tabindex="0" title="トピックとは？" data-placement="top" data-content="Producerが発行したメッセージをConsumerに届けるために使用される名前付きのチャネルです。" data-toggle="popover" data-trigger="focus">トピック</span>に簡単なメッセージを送信するPython <span class="popover-term" tabindex="0" title="Producerとは？" data-placement="top" data-content="Pulsarのトピックにメッセージを発行するプロセスです。" data-toggle="popover" data-trigger="focus">Producer</span>の実装例です。</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">import</span> <span class="nn">websocket</span><span class="p">,</span> <span class="n">base64</span><span class="p">,</span> <span class="n">json</span>

<span class="n">TOPIC</span> <span class="o">=</span> <span class="s">'ws://localhost:8080/ws/producer/persistent/sample/standalone/ns1/my-topic'</span>

<span class="n">ws</span> <span class="o">=</span> <span class="n">websocket</span><span class="o">.</span><span class="n">create_connection</span><span class="p">(</span><span class="n">TOPIC</span><span class="p">)</span>

<span class="c"># Send one message as JSON</span>
<span class="n">ws</span><span class="o">.</span><span class="n">send</span><span class="p">(</span><span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">({</span>
    <span class="s">'payload'</span> <span class="p">:</span> <span class="n">base64</span><span class="o">.</span><span class="n">b64encode</span><span class="p">(</span><span class="s">'Hello World'</span><span class="p">),</span>
    <span class="s">'properties'</span><span class="p">:</span> <span class="p">{</span>
        <span class="s">'key1'</span> <span class="p">:</span> <span class="s">'value1'</span><span class="p">,</span>
        <span class="s">'key2'</span> <span class="p">:</span> <span class="s">'value2'</span>
    <span class="p">},</span>
    <span class="s">'context'</span> <span class="p">:</span> <span class="mi">5</span>
<span class="p">}))</span>

<span class="n">response</span> <span class="o">=</span>  <span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">ws</span><span class="o">.</span><span class="n">recv</span><span class="p">())</span>
<span class="k">if</span> <span class="n">response</span><span class="p">[</span><span class="s">'result'</span><span class="p">]</span> <span class="o">==</span> <span class="s">'ok'</span><span class="p">:</span>
    <span class="k">print</span> <span class="s">'Message published successfully'</span>
<span class="k">else</span><span class="p">:</span>
    <span class="k">print</span> <span class="s">'Failed to publish message:'</span><span class="p">,</span> <span class="n">response</span>
<span class="n">ws</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</code></pre></div></div>

<h4 id="python-consumer">Python Consumer</h4>

<p>Pulsar <span class="popover-term" tabindex="0" title="トピックとは？" data-placement="top" data-content="Producerが発行したメッセージをConsumerに届けるために使用される名前付きのチャネルです。" data-toggle="popover" data-trigger="focus">トピック</span>をリッスンしてメッセージを受信するたびにそのメッセージIDを表示するPython <span class="popover-term" tabindex="0" title="Consumerとは？" data-placement="top" data-content="Pulsarのトピックを購読し、Producerによって発行されたメッセージを処理するプロセスです。" data-toggle="popover" data-trigger="focus">Consumer</span>の実装例です:</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">import</span> <span class="nn">websocket</span><span class="p">,</span> <span class="n">base64</span><span class="p">,</span> <span class="n">json</span>

<span class="n">TOPIC</span> <span class="o">=</span> <span class="s">'ws://localhost:8080/ws/consumer/persistent/sample/standalone/ns1/my-topic/my-sub'</span>

<span class="n">ws</span> <span class="o">=</span> <span class="n">websocket</span><span class="o">.</span><span class="n">create_connection</span><span class="p">(</span><span class="n">TOPIC</span><span class="p">)</span>

<span class="k">while</span> <span class="bp">True</span><span class="p">:</span>
    <span class="n">msg</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">ws</span><span class="o">.</span><span class="n">recv</span><span class="p">())</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">msg</span><span class="p">:</span> <span class="k">break</span>

    <span class="k">print</span> <span class="s">"Received: {} - payload: {}"</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">msg</span><span class="p">,</span> <span class="n">base64</span><span class="o">.</span><span class="n">b64decode</span><span class="p">(</span><span class="n">msg</span><span class="p">[</span><span class="s">'payload'</span><span class="p">]))</span>

    <span class="c"># 正常に処理できた事を応答します</span>
    <span class="n">ws</span><span class="o">.</span><span class="n">send</span><span class="p">(</span><span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">({</span><span class="s">'messageId'</span> <span class="p">:</span> <span class="n">msg</span><span class="p">[</span><span class="s">'messageId'</span><span class="p">]}))</span>

<span class="n">ws</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</code></pre></div></div>

<h3 id="nodejs">Node.js</h3>

<p>この例では <a href="https://websockets.github.io/ws/"><code class="highlighter-rouge">ws</code></a>パッケージを利用します。<a href="https://www.npmjs.com/">npm</a>を利用してインストールできます:</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>npm <span class="nb">install </span>ws
</code></pre></div></div>

<h4 id="nodejs-producer">Node.js Producer</h4>

<p>Pulsarの<span class="popover-term" tabindex="0" title="トピックとは？" data-placement="top" data-content="Producerが発行したメッセージをConsumerに届けるために使用される名前付きのチャネルです。" data-toggle="popover" data-trigger="focus">トピック</span>に簡単なメッセージを送信するNode.jsの実装例です。</p>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">var</span> <span class="nx">WebSocket</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">'ws'</span><span class="p">),</span>
    <span class="nx">topic</span> <span class="o">=</span> <span class="s2">"ws://localhost:8080/ws/producer/persistent/my-property/us-west/my-ns/my-topic1"</span><span class="p">,</span>
    <span class="nx">ws</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">WebSocket</span><span class="p">(</span><span class="nx">topic</span><span class="p">);</span>

<span class="kd">var</span> <span class="nx">message</span> <span class="o">=</span> <span class="p">{</span>
  <span class="s2">"payload"</span> <span class="p">:</span> <span class="k">new</span> <span class="nx">Buffer</span><span class="p">(</span><span class="s2">"Hello World"</span><span class="p">).</span><span class="nx">toString</span><span class="p">(</span><span class="s1">'base64'</span><span class="p">),</span>
  <span class="s2">"properties"</span><span class="p">:</span> <span class="p">{</span>
    <span class="s2">"key1"</span> <span class="p">:</span> <span class="s2">"value1"</span><span class="p">,</span>
    <span class="s2">"key2"</span> <span class="p">:</span> <span class="s2">"value2"</span>
  <span class="p">},</span>
  <span class="s2">"context"</span> <span class="p">:</span> <span class="s2">"1"</span>
<span class="p">};</span>

<span class="nx">ws</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s1">'open'</span><span class="p">,</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
 <span class="err"> </span><span class="c1">// 1つのメッセージを送信します</span>
 <span class="err"> </span><span class="nx">ws</span><span class="p">.</span><span class="nx">send</span><span class="p">(</span><span class="nx">JSON</span><span class="p">.</span><span class="nx">stringify</span><span class="p">(</span><span class="nx">message</span><span class="p">));</span>
<span class="p">});</span>

<span class="nx">ws</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s1">'message'</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">message</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">'received ack: %s'</span><span class="p">,</span> <span class="nx">message</span><span class="p">);</span>
<span class="p">});</span>

</code></pre></div></div>

<h4 id="nodejs-consumer">NodeJS Consumer</h4>
<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">var</span> <span class="nx">WebSocket</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">'ws'</span><span class="p">),</span>
    <span class="nx">topic</span> <span class="o">=</span> <span class="s2">"ws://localhost:8080/ws/consumer/persistent/my-property/us-west/my-ns/my-topic1/my-sub"</span><span class="p">,</span>
    <span class="nx">ws</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">WebSocket</span><span class="p">(</span><span class="nx">topic</span><span class="p">);</span>

<span class="nx">socket</span><span class="p">.</span><span class="nx">onmessage</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">packet</span><span class="p">)</span> <span class="p">{</span>
	<span class="kd">var</span> <span class="nx">receiveMsg</span> <span class="o">=</span> <span class="nx">JSON</span><span class="p">.</span><span class="nx">parse</span><span class="p">(</span><span class="nx">packet</span><span class="p">.</span><span class="nx">data</span><span class="p">);</span>
	<span class="kd">var</span> <span class="nx">ackMsg</span> <span class="o">=</span> <span class="p">{</span><span class="s2">"messageId"</span> <span class="p">:</span> <span class="nx">receiveMsg</span><span class="p">.</span><span class="nx">messageId</span><span class="p">};</span>
	<span class="nx">socket</span><span class="p">.</span><span class="nx">send</span><span class="p">(</span><span class="nx">JSON</span><span class="p">.</span><span class="nx">stringify</span><span class="p">(</span><span class="nx">ackMsg</span><span class="p">));</span>      
<span class="p">};</span>
</code></pre></div></div>

      </section>
    </article>

    <nav class="toc-bar hidden-md-down col-lg-2">
      
      <div id="toc">
        <h4>PulsarにおけるWebSocket API</h4>
      </div>
      
    </nav>
  </div>
</div>

      </main>
    </main>

    <!--

    Licensed to the Apache Software Foundation (ASF) under one
    or more contributor license agreements.  See the NOTICE file
    distributed with this work for additional information
    regarding copyright ownership.  The ASF licenses this file
    to you under the Apache License, Version 2.0 (the
    "License"); you may not use this file except in compliance
    with the License.  You may obtain a copy of the License at

      http://www.apache.org/licenses/LICENSE-2.0

    Unless required by applicable law or agreed to in writing,
    software distributed under the License is distributed on an
    "AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
    KIND, either express or implied.  See the License for the
    specific language governing permissions and limitations
    under the License.

-->
<footer class="footer">
  <div class="container">
    <p class="text-center">Copyright 2019 The Apache Software Foundation. All Rights Reserved.</p>
    <p class="text-center">Apache, Apache Pulsar and the Apache feather logo are trademarks of The Apache Software Foundation.</p>
  </div>
</footer>


    

    
    <!--

    Licensed to the Apache Software Foundation (ASF) under one
    or more contributor license agreements.  See the NOTICE file
    distributed with this work for additional information
    regarding copyright ownership.  The ASF licenses this file
    to you under the Apache License, Version 2.0 (the
    "License"); you may not use this file except in compliance
    with the License.  You may obtain a copy of the License at

      http://www.apache.org/licenses/LICENSE-2.0

    Unless required by applicable law or agreed to in writing,
    software distributed under the License is distributed on an
    "AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
    KIND, either express or implied.  See the License for the
    specific language governing permissions and limitations
    under the License.

-->

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-102219959-1', 'auto');
  ga('send', 'pageview');
</script>

    

    <script type="text/javascript">
      var navbarOffset = -1 * (document.getElementsByClassName("navbar")[0].offsetHeight);
      var shiftWindow = function() { scrollBy(0, navbarOffset) };
      window.addEventListener("hashchange", shiftWindow);
      window.addEventListener("pageshow", shiftWindow);
      function load() { if (window.location.hash) shiftWindow(); }
    </script>
  </body>
</html>
