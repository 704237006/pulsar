<!DOCTYPE html>

<!--

    Licensed to the Apache Software Foundation (ASF) under one
    or more contributor license agreements.  See the NOTICE file
    distributed with this work for additional information
    regarding copyright ownership.  The ASF licenses this file
    to you under the Apache License, Version 2.0 (the
    "License"); you may not use this file except in compliance
    with the License.  You may obtain a copy of the License at

      http://www.apache.org/licenses/LICENSE-2.0

    Unless required by applicable law or agreed to in writing,
    software distributed under the License is distributed on an
    "AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
    KIND, either express or implied.  See the License for the
    specific language governing permissions and limitations
    under the License.

-->

<html>
  <head>
    <!--

    Licensed to the Apache Software Foundation (ASF) under one
    or more contributor license agreements.  See the NOTICE file
    distributed with this work for additional information
    regarding copyright ownership.  The ASF licenses this file
    to you under the Apache License, Version 2.0 (the
    "License"); you may not use this file except in compliance
    with the License.  You may obtain a copy of the License at

      http://www.apache.org/licenses/LICENSE-2.0

    Unless required by applicable law or agreed to in writing,
    software distributed under the License is distributed on an
    "AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
    KIND, either express or implied.  See the License for the
    specific language governing permissions and limitations
    under the License.

-->
<title>Pulsar adminインターフェース</title>

<meta charset="utf-8">

<link rel="stylesheet" href="/css/style.css">
<link rel="shortcut icon" href="/img/favicon.ico">

<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/tether/1.4.0/js/tether.min.js"></script>
<script src="https://code.jquery.com/ui/1.12.1/jquery-ui.min.js"></script>
<script src="/js/jquery.tocify.min.js"></script>
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0-alpha.6/js/bootstrap.min.js" integrity="sha384-vBWWzlZJ8ea9aCX4pEW3rVHjgjt7zpkNpZk+02D9phzyeVkE+jo0ieGizqPLForn" crossorigin="anonymous"></script>

<script src="/js/jquery.scrollTo.min.js"></script>
<script async src="/js/main.js"></script>

  </head>
  <body class="body">
    <main class="main">
      <!--

    Licensed to the Apache Software Foundation (ASF) under one
    or more contributor license agreements.  See the NOTICE file
    distributed with this work for additional information
    regarding copyright ownership.  The ASF licenses this file
    to you under the Apache License, Version 2.0 (the
    "License"); you may not use this file except in compliance
    with the License.  You may obtain a copy of the License at

      http://www.apache.org/licenses/LICENSE-2.0

    Unless required by applicable law or agreed to in writing,
    software distributed under the License is distributed on an
    "AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
    KIND, either express or implied.  See the License for the
    specific language governing permissions and limitations
    under the License.

-->

<nav class="navbar navbar-toggleable-md navbar-light sticky-top">
  <button class="navbar-toggler navbar-toggler-right" type="button" data-toggle="collapse" data-target="#navbarNavDropdown" aria-controls="navbarNavDropdown" aria-expanded="false" aria-label="Toggle navigation">
    <span class="navbar-toggler-icon"></span>
  </button>

  
  <a class="navbar-brand" href="/">
    <img class="main-logo" src="/img/pulsar-logo.png" alt="Pulsar logo">
  </a>
  

  <a class="navbar-nav"></a>

  <div class="collapse navbar-collapse justify-content-end" id="navbarNavDropdown">
    <ul class="navbar-nav">
      <li class="nav-item dropdown">
        <a class="nav-link dropdown-toggle" href="#" id="clientLibsDropdown" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">Documentation</a>

        <div class="dropdown-menu" aria-labelledby="documentationDropdown">
          <a class="dropdown-item" href="/docs/latest/getting-started/LocalCluster">Latest</a>

          <div class="dropdown-divider"></div>
          <h3 class="dropdown-header">Stable release</h3>
          <a class="dropdown-item" href="/docs/v2.0.1-incubating/getting-started/LocalCluster">2.0.1-incubating</a>

          
              <div class="dropdown-divider"></div>
              <h3 class="dropdown-header">Other releases</h3>

              
                  <a class="dropdown-item" href="/docs/v1.22.1-incubating/getting-started/LocalCluster">1.22.1-incubating</a>
              
                  <a class="dropdown-item" href="/docs/v2.0.0-rc1-incubating/getting-started/LocalCluster">2.0.0-rc1-incubating</a>
              
                  <a class="dropdown-item" href="/docs/v1.22.0-incubating/getting-started/LocalCluster">1.22.0-incubating</a>
              
                  <a class="dropdown-item" href="/docs/v1.21.0-incubating/getting-started/LocalCluster">1.21.0-incubating</a>
              
                  <a class="dropdown-item" href="/docs/v1.20.0-incubating/getting-started/LocalCluster">1.20.0-incubating</a>
              
                  <a class="dropdown-item" href="/docs/v1.19.0-incubating/getting-started/LocalCluster">1.19.0-incubating</a>
              
          
        </div>
      </li>

      <li class="nav-item">
          <a class="nav-link" href="/download">Download</a>
      </li>

      <li class="nav-item dropdown">
        <a class="nav-link dropdown-toggle" href="#" id="clientLibsDropdown" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
          Client libraries
        </a>
        <div class="dropdown-menu" aria-labelledby="clientLibsDropdown">
          <a class="dropdown-item" href="/docs/latest/clients/Java">
            Java
          </a>
          <a class="dropdown-item" href="/docs/latest/clients/go">
            Go
          </a>
          <a class="dropdown-item" href="/docs/latest/clients/Python">
            Python
          </a>
          <a class="dropdown-item" href="/docs/latest/clients/Cpp">
            C++
          </a>
          <div class="dropdown-divider"></div>
          <a class="dropdown-item" href="/api/client">
            Java client Javadoc
          </a>
          <a class="dropdown-item" href="/api/admin">
            Java admin Javadoc
          </a>
          <a class="dropdown-item" href="https://godoc.org/github.com/apache/incubator-pulsar/pulsar-client-go/pulsar">
            GoDoc
          </a>
          <a class="dropdown-item" href="/api/pulsar-functions">
            Pulsar Functions Java SDK
          </a>
          <a class="dropdown-item" href="/api/python">
            Python API docs
          </a>
          <a class="dropdown-item" href="/api/cpp">
            C++ API docs
          </a>
        </div>
      </li>

      <li class="nav-item dropdown">
        <a class="nav-link dropdown-toggle" href="#" id="versionsDropdown" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
          Community
        </a>
        <div class="dropdown-menu dropdown-left" aria-labelledby="versionsDropdown">
          <h3 class="dropdown-header">Get in touch</h3>
          <a class="dropdown-item" href="/contact">Contact</a>
          <a class="dropdown-item" href="/events/current-event">Events</a>
          <a class="dropdown-item" href="https://twitter.com/Apache_Pulsar">Twitter</a>
          <a class="dropdown-item" href="https://github.com/apache/incubator-pulsar/wiki">Wiki</a>
          <a class="dropdown-item" href="https://github.com/apache/incubator-pulsar/issues">Issue tracking</a>
          <div class="dropdown-divider"></div>
          <h3 class="dropdown-header">Resources</h3>
          <a class="dropdown-item" href="/resources">Resources</a>
          <a class="dropdown-item" href="/team">Team</a>
          <div class="dropdown-divider"></div>
          <h3 class="dropdown-header">Apache</h3>
          <a class="dropdown-item" href="https://www.apache.org/">The Apache Software Foundation</a>
          <a class="dropdown-item" href="https://www.apache.org/licenses/">License</a>
          <a class="dropdown-item" href="https://www.apache.org/foundation/sponsorship.html">Sponsorship</a>
          <a class="dropdown-item" href="https://www.apache.org/foundation/thanks.html">Thanks</a>
          <a class="dropdown-item" href="https://www.apache.org/security">Security</a>
        </div>
      </li>
    </ul>
  </div>
  <a class="hidden-md-down" href="http://www.apache.org/">
    <img class="asf-logo" title="Apache Software Foundation" src="/img/feather.png" />
  </a>
</nav>

<!--
<nav class="navbar navbar-toggleable-md navbar-light" style="border: 1px solid red;">
  <button class="navbar-toggler navbar-toggler-right" type="button" data-toggle="collapse" data-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
    <span class="navbar-toggler-icon"></span>
  </button>

  <a class="navbar-brand" href="/">
    <img src="/img/pulsar-logo.png" class="d-inline-block align-top" alt="Pulsar logo" height="40" width="60">
  </a>

  <div class="collapse navbar-collapse" id="navbarSupportedContent">
    <ul class="navbar-nav mr-auto">
      <li class="nav-item active">
        <a class="nav-link" href="#">Home <span class="sr-only">(current)</span></a>
      </li>
      <li class="nav-item">
        <a class="nav-link" href="#">Link</a>
      </li>
      <li class="nav-item">
        <a class="nav-link disabled" href="#">Disabled</a>
      </li>
    </ul>
  </div>
</nav>-->


      <main>
        <!--

    Licensed to the Apache Software Foundation (ASF) under one
    or more contributor license agreements.  See the NOTICE file
    distributed with this work for additional information
    regarding copyright ownership.  The ASF licenses this file
    to you under the Apache License, Version 2.0 (the
    "License"); you may not use this file except in compliance
    with the License.  You may obtain a copy of the License at

      http://www.apache.org/licenses/LICENSE-2.0

    Unless required by applicable law or agreed to in writing,
    software distributed under the License is distributed on an
    "AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
    KIND, either express or implied.  See the License for the
    specific language governing permissions and limitations
    under the License.

-->


<div class="docs-container container-fluid">
  <div class="row">
    <nav class="sidebar-nav hidden-md-down col-lg-3">
      <!--

    Licensed to the Apache Software Foundation (ASF) under one
    or more contributor license agreements.  See the NOTICE file
    distributed with this work for additional information
    regarding copyright ownership.  The ASF licenses this file
    to you under the Apache License, Version 2.0 (the
    "License"); you may not use this file except in compliance
    with the License.  You may obtain a copy of the License at

      http://www.apache.org/licenses/LICENSE-2.0

    Unless required by applicable law or agreed to in writing,
    software distributed under the License is distributed on an
    "AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
    KIND, either express or implied.  See the License for the
    specific language governing permissions and limitations
    under the License.

-->


<aside class="sidebar-nav">
  <div id="sidebar-accordion" role="tablist" aria-multiselectable="true">
    
    
    <div class="card">
      <div class="card-header" role="tab" id="heading-入門">
        <h5>
          <a data-toggle="collapse" data-parent="#sidebar-accordion" href="#collapse-入門" aria-controls="collapse-入門">
            入門
          </a>
        </h5>
      </div>

      <div class="sidebar-group collapse" id="collapse-入門" role="tabpanel" aria-labelledby="heading-入門">
        <ul>
          
          
          <li>
            <a href="/ja/getting-started/LocalCluster">
              ローカルでPulsarを起動
            </a>
          </li>
          
          
          <li>
            <a href="/ja/getting-started/Clients">
              クライアントライブラリ
            </a>
          </li>
          
          
          <li>
            <a href="/ja/getting-started/ConceptsAndArchitecture">
              コンセプトとアーキテクチャ
            </a>
          </li>
          
        </ul>
      </div>
    </div>
    
    
    <div class="card">
      <div class="card-header" role="tab" id="heading-デプロイ">
        <h5>
          <a data-toggle="collapse" data-parent="#sidebar-accordion" href="#collapse-デプロイ" aria-controls="collapse-デプロイ">
            デプロイ
          </a>
        </h5>
      </div>

      <div class="sidebar-group collapse" id="collapse-デプロイ" role="tabpanel" aria-labelledby="heading-デプロイ">
        <ul>
          
          
          <li>
            <a href="/ja/deployment/InstanceSetup">
              ベアメタル
            </a>
          </li>
          
          
          <li>
            <a href="/ja/deployment/Kubernetes">
              Kubernetes
            </a>
          </li>
          
          
          <li>
            <a href="/ja/deployment/Kubernetes/#google-kubernetes-engine">
              Google Kubernetes Engine
            </a>
          </li>
          
          
          <li>
            <a href="/ja/deployment/Kubernetes/#amazon-web-services">
              AWS
            </a>
          </li>
          
          
          <li>
            <a href="/ja/deployment/Monitoring">
              監視
            </a>
          </li>
          
        </ul>
      </div>
    </div>
    
    
    <div class="card">
      <div class="card-header" role="tab" id="heading-管理">
        <h5>
          <a data-toggle="collapse" data-parent="#sidebar-accordion" href="#collapse-管理" aria-controls="collapse-管理">
            管理
          </a>
        </h5>
      </div>

      <div class="sidebar-group collapse" id="collapse-管理" role="tabpanel" aria-labelledby="heading-管理">
        <ul>
          
          
          <li>
            <a href="/ja/admin/AdminInterface">
              Pulsar adminインターフェース
            </a>
          </li>
          
          
          <li>
            <a href="/ja/admin/ClustersBrokers">
              クラスタとBroker
            </a>
          </li>
          
          
          <li>
            <a href="/ja/admin/PropertiesNamespaces">
              プロパティとネームスペース
            </a>
          </li>
          
          
          <li>
            <a href="/ja/admin/ZooKeeperBookKeeper">
              ZooKeeperとBookKeeper
            </a>
          </li>
          
          
          <li>
            <a href="/ja/admin/Dashboard">
              ダッシュボード
            </a>
          </li>
          
          
          <li>
            <a href="/ja/admin/Authz">
              認証と認可
            </a>
          </li>
          
          
          <li>
            <a href="/ja/admin/GeoReplication">
              ジオレプリケーション
            </a>
          </li>
          
          
          <li>
            <a href="/ja/admin/Stats">
              統計情報
            </a>
          </li>
          
          
          <li>
            <a href="/ja/admin/ModularLoadManager">
              モジュラロードマネージャ
            </a>
          </li>
          
        </ul>
      </div>
    </div>
    
    
    <div class="card">
      <div class="card-header" role="tab" id="heading-クライアントライブラリ">
        <h5>
          <a data-toggle="collapse" data-parent="#sidebar-accordion" href="#collapse-クライアントライブラリ" aria-controls="collapse-クライアントライブラリ">
            クライアントライブラリ
          </a>
        </h5>
      </div>

      <div class="sidebar-group collapse" id="collapse-クライアントライブラリ" role="tabpanel" aria-labelledby="heading-クライアントライブラリ">
        <ul>
          
          
          <li>
            <a href="/ja/clients/Java">
              Java
            </a>
          </li>
          
          
          <li>
            <a href="/ja/clients/Cpp">
              C++
            </a>
          </li>
          
          
          <li>
            <a href="/ja/clients/Python">
              Python
            </a>
          </li>
          
          
          <li>
            <a href="/ja/clients/WebSocket">
              WebSocket API
            </a>
          </li>
          
        </ul>
      </div>
    </div>
    
    
    <div class="card">
      <div class="card-header" role="tab" id="heading-アダプタ">
        <h5>
          <a data-toggle="collapse" data-parent="#sidebar-accordion" href="#collapse-アダプタ" aria-controls="collapse-アダプタ">
            アダプタ
          </a>
        </h5>
      </div>

      <div class="sidebar-group collapse" id="collapse-アダプタ" role="tabpanel" aria-labelledby="heading-アダプタ">
        <ul>
          
          
          <li>
            <a href="/ja/adaptors/PulsarSpark">
              Spark Streaming
            </a>
          </li>
          
          
          <li>
            <a href="/ja/adaptors/PulsarStorm">
              Apache Storm
            </a>
          </li>
          
        </ul>
      </div>
    </div>
    
    
    <div class="card">
      <div class="card-header" role="tab" id="heading-高度な機能">
        <h5>
          <a data-toggle="collapse" data-parent="#sidebar-accordion" href="#collapse-高度な機能" aria-controls="collapse-高度な機能">
            高度な機能
          </a>
        </h5>
      </div>

      <div class="sidebar-group collapse" id="collapse-高度な機能" role="tabpanel" aria-labelledby="heading-高度な機能">
        <ul>
          
          
          <li>
            <a href="/ja/advanced/PartitionedTopics">
              パーティションドトピック
            </a>
          </li>
          
          
          <li>
            <a href="/ja/advanced/RetentionExpiry">
              保存と有効期限
            </a>
          </li>
          
        </ul>
      </div>
    </div>
    
    
    <div class="card">
      <div class="card-header" role="tab" id="heading-開発">
        <h5>
          <a data-toggle="collapse" data-parent="#sidebar-accordion" href="#collapse-開発" aria-controls="collapse-開発">
            開発
          </a>
        </h5>
      </div>

      <div class="sidebar-group collapse" id="collapse-開発" role="tabpanel" aria-labelledby="heading-開発">
        <ul>
          
          
          <li>
            <a href="/ja/project/SimulationTools">
              シミュレーションツール
            </a>
          </li>
          
          
          <li>
            <a href="/ja/project/BinaryProtocol">
              バイナリプロトコル
            </a>
          </li>
          
          
          <li>
            <a href="/ja/project/Codebase">
              コードベース
            </a>
          </li>
          
        </ul>
      </div>
    </div>
    
    
    <div class="card">
      <div class="card-header" role="tab" id="heading-リファレンス">
        <h5>
          <a data-toggle="collapse" data-parent="#sidebar-accordion" href="#collapse-リファレンス" aria-controls="collapse-リファレンス">
            リファレンス
          </a>
        </h5>
      </div>

      <div class="sidebar-group collapse" id="collapse-リファレンス" role="tabpanel" aria-labelledby="heading-リファレンス">
        <ul>
          
          
          <li>
            <a href="/ja/reference/RestApi">
              Pulsar REST API
            </a>
          </li>
          
          
          <li>
            <a href="/ja/reference/CliTools">
              コマンドラインツール
            </a>
          </li>
          
          
          <li>
            <a href="/ja/reference/Configuration">
              設定
            </a>
          </li>
          
        </ul>
      </div>
    </div>
    
  </div>
</aside>


    </nav>

    <article class="col-xs-12 col-sm-12 col-md-12 col-lg-7">
      <section class="docs-header">
        <h1 class="docs-title">Pulsar adminインターフェース</h1>
        
        <section class="tags">
          
          <!-- <span class="badge badge-pill badge-primary">admin</span> -->
          <button type="button" class="btn btn-primary" data-toggle="modal" data-target="#modal-admin">admin</button>
          <!--

    Licensed to the Apache Software Foundation (ASF) under one
    or more contributor license agreements.  See the NOTICE file
    distributed with this work for additional information
    regarding copyright ownership.  The ASF licenses this file
    to you under the Apache License, Version 2.0 (the
    "License"); you may not use this file except in compliance
    with the License.  You may obtain a copy of the License at

      http://www.apache.org/licenses/LICENSE-2.0

    Unless required by applicable law or agreed to in writing,
    software distributed under the License is distributed on an
    "AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
    KIND, either express or implied.  See the License for the
    specific language governing permissions and limitations
    under the License.

-->
<div class="modal fade" id="modal-admin">
  <div class="modal-dialog" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title"><strong>admin</strong>タグのページ一覧</h5>
      </div>
      <div class="modal-body">
        <ul>
          
          
          <li><a href="/ja/admin/AdminInterface/">Pulsar adminインターフェース</a></li>
          
          
          
          <li><a href="/ja/admin/Authz/">Pulsarにおける認証と認可</a></li>
          
          
          
          
          
          
          
          
          
          <li><a href="/ja/reference/CliTools/">Pulsarコマンドラインツール</a></li>
          
          
          
          
          
          
          
          <li><a href="/ja/admin/ClustersBrokers/">PulsarクラスタとBrokerの管理</a></li>
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          <li><a href="/ja/deployment/InstanceSetup/">Pulsarインスタンスのデプロイ</a></li>
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          <li><a href="/ja/advanced/PartitionedTopics/">パーティションドトピック</a></li>
          
          
          
          <li><a href="/ja/admin/PropertiesNamespaces/">プロパティとネームスペースの管理</a></li>
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          <li><a href="/ja/advanced/RetentionExpiry/">メッセージの保存と有効期限</a></li>
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
        </ul>
      </div>
    </div>
  </div>
</div>

          
          <!-- <span class="badge badge-pill badge-primary">cli</span> -->
          <button type="button" class="btn btn-primary" data-toggle="modal" data-target="#modal-cli">cli</button>
          <!--

    Licensed to the Apache Software Foundation (ASF) under one
    or more contributor license agreements.  See the NOTICE file
    distributed with this work for additional information
    regarding copyright ownership.  The ASF licenses this file
    to you under the Apache License, Version 2.0 (the
    "License"); you may not use this file except in compliance
    with the License.  You may obtain a copy of the License at

      http://www.apache.org/licenses/LICENSE-2.0

    Unless required by applicable law or agreed to in writing,
    software distributed under the License is distributed on an
    "AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
    KIND, either express or implied.  See the License for the
    specific language governing permissions and limitations
    under the License.

-->
<div class="modal fade" id="modal-cli">
  <div class="modal-dialog" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title"><strong>cli</strong>タグのページ一覧</h5>
      </div>
      <div class="modal-body">
        <ul>
          
          
          <li><a href="/ja/admin/AdminInterface/">Pulsar adminインターフェース</a></li>
          
          
          
          
          
          
          
          
          
          
          
          <li><a href="/ja/reference/CliTools/">Pulsarコマンドラインツール</a></li>
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
        </ul>
      </div>
    </div>
  </div>
</div>

          
          <!-- <span class="badge badge-pill badge-primary">rest</span> -->
          <button type="button" class="btn btn-primary" data-toggle="modal" data-target="#modal-rest">rest</button>
          <!--

    Licensed to the Apache Software Foundation (ASF) under one
    or more contributor license agreements.  See the NOTICE file
    distributed with this work for additional information
    regarding copyright ownership.  The ASF licenses this file
    to you under the Apache License, Version 2.0 (the
    "License"); you may not use this file except in compliance
    with the License.  You may obtain a copy of the License at

      http://www.apache.org/licenses/LICENSE-2.0

    Unless required by applicable law or agreed to in writing,
    software distributed under the License is distributed on an
    "AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
    KIND, either express or implied.  See the License for the
    specific language governing permissions and limitations
    under the License.

-->
<div class="modal fade" id="modal-rest">
  <div class="modal-dialog" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title"><strong>rest</strong>タグのページ一覧</h5>
      </div>
      <div class="modal-body">
        <ul>
          
          
          <li><a href="/ja/admin/AdminInterface/">Pulsar adminインターフェース</a></li>
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
        </ul>
      </div>
    </div>
  </div>
</div>

          
          <!-- <span class="badge badge-pill badge-primary">java</span> -->
          <button type="button" class="btn btn-primary" data-toggle="modal" data-target="#modal-java">java</button>
          <!--

    Licensed to the Apache Software Foundation (ASF) under one
    or more contributor license agreements.  See the NOTICE file
    distributed with this work for additional information
    regarding copyright ownership.  The ASF licenses this file
    to you under the Apache License, Version 2.0 (the
    "License"); you may not use this file except in compliance
    with the License.  You may obtain a copy of the License at

      http://www.apache.org/licenses/LICENSE-2.0

    Unless required by applicable law or agreed to in writing,
    software distributed under the License is distributed on an
    "AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
    KIND, either express or implied.  See the License for the
    specific language governing permissions and limitations
    under the License.

-->
<div class="modal fade" id="modal-java">
  <div class="modal-dialog" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title"><strong>java</strong>タグのページ一覧</h5>
      </div>
      <div class="modal-body">
        <ul>
          
          
          <li><a href="/ja/admin/AdminInterface/">Pulsar adminインターフェース</a></li>
          
          
          
          <li><a href="/ja/admin/Authz/">Pulsarにおける認証と認可</a></li>
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          <li><a href="/ja/clients/Java/">Pulsar Javaクライアント</a></li>
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          <li><a href="/ja/adaptors/PulsarSpark/">Spark Streaming Pulsar Receiver</a></li>
          
          
          
          
          
          <li><a href="/ja/adaptors/PulsarStorm/">Apache StormのためのPulsarアダプタ</a></li>
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
        </ul>
      </div>
    </div>
  </div>
</div>

          
        </section>

        <hr class="hr">
      </section>

      <section class="content">
        <!--

    Licensed to the Apache Software Foundation (ASF) under one
    or more contributor license agreements.  See the NOTICE file
    distributed with this work for additional information
    regarding copyright ownership.  The ASF licenses this file
    to you under the Apache License, Version 2.0 (the
    "License"); you may not use this file except in compliance
    with the License.  You may obtain a copy of the License at

      http://www.apache.org/licenses/LICENSE-2.0

    Unless required by applicable law or agreed to in writing,
    software distributed under the License is distributed on an
    "AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
    KIND, either express or implied.  See the License for the
    specific language governing permissions and limitations
    under the License.

-->

<p>Pulsar adminインターフェースは、<span class="popover-term" tabindex="0" title="プロパティとは？" data-placement="top" data-content="Pulsarのテナントです。" data-toggle="popover" data-trigger="focus">プロパティ</span>、<span class="popover-term" tabindex="0" title="ネームスペースとは？" data-placement="top" data-content="関連トピックのグループ化メカニズムです。" data-toggle="popover" data-trigger="focus">ネームスペース</span>、<span class="popover-term" tabindex="0" title="トピックとは？" data-placement="top" data-content="Producerが発行したメッセージをConsumerに届けるために使用される名前付きのチャネルです。" data-toggle="popover" data-trigger="focus">トピック</span>のようなPulsar<span class="popover-term" tabindex="0" title="Pulsarインスタンスとは？" data-placement="top" data-content="単一の単位として動作するPulsarクラスタのグループのことです。" data-toggle="popover" data-trigger="focus">インスタンス</span>における重要なエンティティの管理を可能にします。</p>

<p>現在、以下の方法でadminインターフェースを利用できます:</p>

<ol>
  <li>Pulsar <span class="popover-term" tabindex="0" title="Brokerとは？" data-placement="top" data-content="2つの異なるコンポーネントを実行するPulsarクラスタのステートレスなコンポーネントです。2つのコンポーネントとは管理操作とトピックルックアップのためのRESTインターフェースを提供するHTTPサーバと全てのメッセージの転送を処理するディスパッチャです。またPulsarクラスタは基本的に複数のBrokerから構成されます。" data-toggle="popover" data-trigger="focus">Broker</span>が提供するadmin <a href="../../reference/RestApi">REST API</a>にHTTPリクエストを送信</li>
  <li>
    <p><a href="../../getting-started/LocalCluster">Pulsarをインストール</a>すると<code class="highlighter-rouge">bin</code>フォルダに配置される<code class="highlighter-rouge">pulsar-admin</code> CLIツールを使用</p>

    <div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code> <span class="nv">$ </span>bin/pulsar-admin
</code></pre></div>    </div>

    <p>このツールの完全なドキュメントは<a href="../../reference/CliTools#pulsar-admin">Pulsarコマンドラインツール</a>で閲覧できます。</p>
  </li>
  <li>Javaクライアントインターフェース</li>
</ol>

<!--

    Licensed to the Apache Software Foundation (ASF) under one
    or more contributor license agreements.  See the NOTICE file
    distributed with this work for additional information
    regarding copyright ownership.  The ASF licenses this file
    to you under the Apache License, Version 2.0 (the
    "License"); you may not use this file except in compliance
    with the License.  You may obtain a copy of the License at

      http://www.apache.org/licenses/LICENSE-2.0

    Unless required by applicable law or agreed to in writing,
    software distributed under the License is distributed on an
    "AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
    KIND, either express or implied.  See the License for the
    specific language governing permissions and limitations
    under the License.

-->

<div class="admonition">
  <div class="info">
    <span class="admonition-title"><p>REST APIは管理インターフェースです</p>
</span>
    <p>内部的には、<code class="highlighter-rouge">pulsar-admin</code> CLIツールとJavaクライアントは共にREST APIを使用しています。独自の管理インターフェースを実装したい場合、同じようにREST APIを使用する必要があります。完全なドキュメントは<a href="../../reference/RestApi">こちら</a>で確認できます。</p>

  </div>
</div>

<p>このドキュメントでは、利用可能な3つのインターフェースそれぞれの例を示します。</p>

<h2 id="adminインターフェースのセットアップ">adminインターフェースのセットアップ</h2>

<!--

    Licensed to the Apache Software Foundation (ASF) under one
    or more contributor license agreements.  See the NOTICE file
    distributed with this work for additional information
    regarding copyright ownership.  The ASF licenses this file
    to you under the Apache License, Version 2.0 (the
    "License"); you may not use this file except in compliance
    with the License.  You may obtain a copy of the License at

      http://www.apache.org/licenses/LICENSE-2.0

    Unless required by applicable law or agreed to in writing,
    software distributed under the License is distributed on an
    "AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
    KIND, either express or implied.  See the License for the
    specific language governing permissions and limitations
    under the License.

-->

<p>Pulsarの3つのadminインターフェース—<a href="../../reference/CliTools#pulsar-admin"><code class="highlighter-rouge">pulsar-admin</code></a>CLIツール, <a href="/api/admin">Java admin API</a>, <a href="../../reference/RestApi">REST API</a>—は、Pulsar<span class="popover-term" tabindex="0" title="Pulsarインスタンスとは？" data-placement="top" data-content="単一の単位として動作するPulsarクラスタのグループのことです。" data-toggle="popover" data-trigger="focus">インスタンス</span>で<a href="../../admin/Authz#認証プロバイダ">認証</a>を有効にしている場合にいくつかの特別なセットアップを必要とします。</p>

<h3 id="pulsar-admin">pulsar-admin</h3>

<p>もし<a href="../../admin/Authz#認証プロバイダ">認証</a>を有効にしている場合、<a href="../../reference/CliTools#pulsar-admin"><code class="highlighter-rouge">pulsar-admin</code></a>ツールを利用するために認証の設定をする必要があります。デフォルトでは、<code class="highlighter-rouge">pulsar-admin</code>ツールの設定は<a href="../../reference/Configuration#クライアント"><code class="highlighter-rouge">conf/client.conf</code></a>にあります。以下は設定可能なパラメータです:</p>

<!--

    Licensed to the Apache Software Foundation (ASF) under one
    or more contributor license agreements.  See the NOTICE file
    distributed with this work for additional information
    regarding copyright ownership.  The ASF licenses this file
    to you under the Apache License, Version 2.0 (the
    "License"); you may not use this file except in compliance
    with the License.  You may obtain a copy of the License at

      http://www.apache.org/licenses/LICENSE-2.0

    Unless required by applicable law or agreed to in writing,
    software distributed under the License is distributed on an
    "AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
    KIND, either express or implied.  See the License for the
    specific language governing permissions and limitations
    under the License.

-->

<table class="config">
  <thead>
    <tr>
      <th>Name</th>
      <th>Description</th>
      <th>Default</th>
    </tr>
  </thead>
  <tbody>
    
    <tr id="client-webServiceUrl">
      <td>webServiceUrl</td>
      <td>The web URL for the cluster.
</td>
      <td>http://localhost:8080/</td>
    </tr>
    
    <tr id="client-brokerServiceUrl">
      <td>brokerServiceUrl</td>
      <td>The Pulsar protocol URL for the cluster.
</td>
      <td>pulsar://localhost:6650/</td>
    </tr>
    
    <tr id="client-authPlugin">
      <td>authPlugin</td>
      <td>The authentication plugin.
</td>
      <td></td>
    </tr>
    
    <tr id="client-authParams">
      <td>authParams</td>
      <td>The authentication parameters for the cluster, as a comma-separated string.
</td>
      <td></td>
    </tr>
    
    <tr id="client-useTls">
      <td>useTls</td>
      <td>Whether or not TLS authentication will be enforced in the cluster.
</td>
      <td>false</td>
    </tr>
    
    <tr id="client-tlsAllowInsecureConnection">
      <td>tlsAllowInsecureConnection</td>
      <td>
</td>
      <td></td>
    </tr>
    
    <tr id="client-tlsTrustCertsFilePath">
      <td>tlsTrustCertsFilePath</td>
      <td>
</td>
      <td></td>
    </tr>
    
  </tbody>
</table>

<h3 id="rest-api">REST API</h3>

<p>この<a href="../../reference/RestApi">リファレンス</a>上でPulsar <span class="popover-term" tabindex="0" title="Brokerとは？" data-placement="top" data-content="2つの異なるコンポーネントを実行するPulsarクラスタのステートレスなコンポーネントです。2つのコンポーネントとは管理操作とトピックルックアップのためのRESTインターフェースを提供するHTTPサーバと全てのメッセージの転送を処理するディスパッチャです。またPulsarクラスタは基本的に複数のBrokerから構成されます。" data-toggle="popover" data-trigger="focus">Broker</span>が提供しているREST APIのドキュメントを参照できます。</p>

<h3 id="java-adminクライアント">Java adminクライアント</h3>

<p>Java admin APIを利用するために、Pulsar <span class="popover-term" tabindex="0" title="Brokerとは？" data-placement="top" data-content="2つの異なるコンポーネントを実行するPulsarクラスタのステートレスなコンポーネントです。2つのコンポーネントとは管理操作とトピックルックアップのためのRESTインターフェースを提供するHTTPサーバと全てのメッセージの転送を処理するディスパッチャです。またPulsarクラスタは基本的に複数のBrokerから構成されます。" data-toggle="popover" data-trigger="focus">Broker</span>のURLと<a target="_blank" href="/api/admin/org/apache/pulsar/client/admin/ClientConfiguration.html"><code class="highlighter-rouge">ClientConfiguration</code></a>を指定して<a target="_blank" href="/api/admin/org/apache/pulsar/client/admin/PulsarAdmin.html"><code class="highlighter-rouge">PulsarAdmin</code></a>オブジェクトをインスタンス化します。 以下は<code class="highlighter-rouge">localhost</code>を利用した最小限の例です:</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">URL</span> <span class="n">url</span> <span class="o">=</span> <span class="k">new</span> <span class="n">URL</span><span class="o">(</span><span class="s">"http://localhost:8080"</span><span class="o">);</span>
<span class="n">String</span> <span class="n">authPluginClassName</span> <span class="o">=</span> <span class="s">"com.org.MyAuthPluginClass"</span><span class="o">;</span> <span class="c1">//認証が有効な場合にauth-pluginクラスの完全修飾名を渡します。</span>
<span class="n">String</span> <span class="n">authParams</span> <span class="o">=</span> <span class="s">"param1:value1"</span><span class="o">;</span> <span class="c1">//auth-pluginクラスが要求しているパラメータを渡します。</span>
<span class="kt">boolean</span> <span class="n">useTls</span> <span class="o">=</span> <span class="kc">false</span><span class="o">;</span>
<span class="kt">boolean</span> <span class="n">tlsAllowInsecureConnection</span> <span class="o">=</span> <span class="kc">false</span><span class="o">;</span>
<span class="n">String</span> <span class="n">tlsTrustCertsFilePath</span> <span class="o">=</span> <span class="kc">null</span><span class="o">;</span>

<span class="n">ClientConfiguration</span> <span class="n">config</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ClientConfiguration</span><span class="o">();</span>
<span class="n">config</span><span class="o">.</span><span class="na">setAuthentication</span><span class="o">(</span><span class="n">authPluginClassName</span><span class="o">,</span> <span class="n">authParams</span><span class="o">);</span>
<span class="n">config</span><span class="o">.</span><span class="na">setUseTls</span><span class="o">(</span><span class="n">useTls</span><span class="o">);</span>
<span class="n">config</span><span class="o">.</span><span class="na">setTlsAllowInsecureConnection</span><span class="o">(</span><span class="n">tlsAllowInsecureConnection</span><span class="o">);</span>
<span class="n">config</span><span class="o">.</span><span class="na">setTlsTrustCertsFilePath</span><span class="o">(</span><span class="n">tlsTrustCertsFilePath</span><span class="o">);</span>

<span class="n">PulsarAdmin</span> <span class="n">admin</span> <span class="o">=</span> <span class="k">new</span> <span class="n">PulsarAdmin</span><span class="o">(</span><span class="n">url</span><span class="o">,</span> <span class="n">config</span><span class="o">);</span>
</code></pre></div></div>

<h2 id="クラスタの管理">クラスタの管理</h2>

<!--

    Licensed to the Apache Software Foundation (ASF) under one
    or more contributor license agreements.  See the NOTICE file
    distributed with this work for additional information
    regarding copyright ownership.  The ASF licenses this file
    to you under the Apache License, Version 2.0 (the
    "License"); you may not use this file except in compliance
    with the License.  You may obtain a copy of the License at

      http://www.apache.org/licenses/LICENSE-2.0

    Unless required by applicable law or agreed to in writing,
    software distributed under the License is distributed on an
    "AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
    KIND, either express or implied.  See the License for the
    specific language governing permissions and limitations
    under the License.

-->

<p>Pulsarのクラスタは1つ以上のPulsar <span class="popover-term" tabindex="0" title="Brokerとは？" data-placement="top" data-content="2つの異なるコンポーネントを実行するPulsarクラスタのステートレスなコンポーネントです。2つのコンポーネントとは管理操作とトピックルックアップのためのRESTインターフェースを提供するHTTPサーバと全てのメッセージの転送を処理するディスパッチャです。またPulsarクラスタは基本的に複数のBrokerから構成されます。" data-toggle="popover" data-trigger="focus">Broker</span>、1つ以上の<span class="popover-term" tabindex="0" title="BookKeeperとは？" data-placement="top" data-content="Apache BookKeeperは永続ログストレージです。Pulsarではメッセージデータの保存に利用しています。" data-toggle="popover" data-trigger="focus">BookKeeper</span>サーバ (<span class="popover-term" tabindex="0" title="Bookieとは？" data-placement="top" data-content="各BookKeeperサーバのことをBookieと呼びます。" data-toggle="popover" data-trigger="focus">Bookie</span>) 、設定と調整管理の機能を提供する<span class="popover-term" tabindex="0" title="ZooKeeperとは？" data-placement="top" data-content="Pulsarが調整タスクに利用するサービスです。&lt;br /&gt;&lt;br /&gt;Pulsarインスタンスはクラスタ特有のタスク用のLocal ZooKeeperとインスタンス全体のタスク用のGlobal ZooKeeperに依存しています。" data-toggle="popover" data-trigger="focus">ZooKeeper</span>クラスタから構成されます。</p>

<p>クラスタは次の方法で管理できます:</p>

<ul>
  <li><a href="../../reference/CliTools#pulsar-admin"><code class="highlighter-rouge">pulsar-admin</code></a>ツールの<a href="../../reference/CliTools#pulsar-admin-clusters"><code class="highlighter-rouge">clusters</code></a>コマンド</li>
  <li>admin <a href="../../reference/RestApi">REST API</a>の<code class="highlighter-rouge">/admin/clusters</code>エンドポイント</li>
  <li>Java <a href="../../admin/AdminInterface">admin API</a>の<a target="_blank" href="/api/admin/org/apache/pulsar/client/admin/PulsarAdmin.html"><code class="highlighter-rouge">PulsarAdmin</code></a>オブジェクトの<code class="highlighter-rouge">clusters</code>メソッド</li>
</ul>

<h3 id="準備">準備</h3>

<p>新しいクラスタはadminインターフェースを使用して準備できます。</p>

<!--

    Licensed to the Apache Software Foundation (ASF) under one
    or more contributor license agreements.  See the NOTICE file
    distributed with this work for additional information
    regarding copyright ownership.  The ASF licenses this file
    to you under the Apache License, Version 2.0 (the
    "License"); you may not use this file except in compliance
    with the License.  You may obtain a copy of the License at

      http://www.apache.org/licenses/LICENSE-2.0

    Unless required by applicable law or agreed to in writing,
    software distributed under the License is distributed on an
    "AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
    KIND, either express or implied.  See the License for the
    specific language governing permissions and limitations
    under the License.

-->

<div class="admonition">
  <div class="warning">
    
    <p>この操作には<a href="../../admin/Authz#スーパーユーザ">スーパーユーザ</a>権限が必要です。</p>

  </div>
</div>

<h4 id="pulsar-admin-1">pulsar-admin</h4>

<p><a href="../../reference/CliTools#pulsar-admin-clusters-create"><code class="highlighter-rouge">create</code></a>サブコマンドを使用する事で新しいクラスタを準備できます。以下はその例です:</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>pulsar-admin clusters create cluster-1 <span class="se">\</span>
  <span class="nt">--url</span> http://my-cluster.org.com:8080 <span class="se">\</span>
  <span class="nt">--broker-url</span> pulsar://my-cluster.org.com:6650
</code></pre></div></div>

<h4 id="rest-api-1">REST API</h4>

<div class="highlighter-rouge endpoint"><pre class="highlight"><code class="method put">PUT</code><code class="url">/admin/clusters/<span class="endpoint">:cluster</span></code></pre></div>

<p><a href="../../reference/RestApi#/admin/clusters/:cluster">詳細</a></p>

<h4 id="java">Java</h4>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">ClusterData</span> <span class="n">clusterData</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ClusterData</span><span class="o">(</span>
        <span class="n">serviceUrl</span><span class="o">,</span>
        <span class="n">serviceUrlTls</span><span class="o">,</span>
        <span class="n">brokerServiceUrl</span><span class="o">,</span>
        <span class="n">brokerServiceUrlTls</span>
<span class="o">);</span>
<span class="n">admin</span><span class="o">.</span><span class="na">clusters</span><span class="o">().</span><span class="na">createCluster</span><span class="o">(</span><span class="n">clusterName</span><span class="o">,</span> <span class="n">clusterData</span><span class="o">);</span>
</code></pre></div></div>

<h3 id="クラスタメタデータの初期化">クラスタメタデータの初期化</h3>

<p>新しいクラスタを準備する際には、そのクラスタの<a href="../../getting-started/ConceptsAndArchitecture#メタデータストア">メタデータ</a>を初期化する必要があります。クラスタメタデータを初期化する場合、次の全てのパラメータを指定しなければなりません:</p>

<ul>
  <li>クラスタの名前</li>
  <li>そのクラスタのLocal ZooKeeperをカンマで連結した文字列</li>
  <li>インスタンス全体のGlobal ZooKeeperをカンマで連結した文字列</li>
  <li>クラスタのウェブサービスのURL</li>
  <li>クラスタ内の<span class="popover-term" tabindex="0" title="Brokerとは？" data-placement="top" data-content="2つの異なるコンポーネントを実行するPulsarクラスタのステートレスなコンポーネントです。2つのコンポーネントとは管理操作とトピックルックアップのためのRESTインターフェースを提供するHTTPサーバと全てのメッセージの転送を処理するディスパッチャです。またPulsarクラスタは基本的に複数のBrokerから構成されます。" data-toggle="popover" data-trigger="focus">Broker</span>との対話を可能にするBrokerサービスのURL</li>
</ul>

<p>クラスタに属する<a href="../../admin/ClustersBrokers#brokerの管理">Broker</a>を起動する<em>前に</em>クラスタメタデータは初期化しなければなりません。</p>

<!--

    Licensed to the Apache Software Foundation (ASF) under one
    or more contributor license agreements.  See the NOTICE file
    distributed with this work for additional information
    regarding copyright ownership.  The ASF licenses this file
    to you under the Apache License, Version 2.0 (the
    "License"); you may not use this file except in compliance
    with the License.  You may obtain a copy of the License at

      http://www.apache.org/licenses/LICENSE-2.0

    Unless required by applicable law or agreed to in writing,
    software distributed under the License is distributed on an
    "AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
    KIND, either express or implied.  See the License for the
    specific language governing permissions and limitations
    under the License.

-->
<div class="admonition">
  <div class="warning">
    <span class="admonition-title"><p>REST APIやJava admin APIを使用したクラスタメタデータの初期化はできません</p>
</span>
    
<p>Pulsarの他の多くの管理機能とは異なり、クラスタメタデータの初期化はZooKeeperと直接通信するためadmin REST APIやadmin Javaクライアントを使用する事はできません。代わりに、<a href="../../reference/CliTools#pulsar"><code class="highlighter-rouge">pulsar</code></a> CLIツール、特に<a href="../../reference/CliTools#pulsar-initialize-cluster-metadata"><code class="highlighter-rouge">initialize-cluster-metadata</code></a>コマンドが利用できます。</p>

  </div>
</div>

<p>以下はクラスタメタデータの初期化コマンドの例です:</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>bin/pulsar initialize-cluster-metadata <span class="se">\</span>
  <span class="nt">--cluster</span> us-west <span class="se">\</span>
  <span class="nt">--zookeeper</span> zk1.us-west.example.com:2181 <span class="se">\</span>
  <span class="nt">--global-zookeeper</span> zk1.us-west.example.com:2184 <span class="se">\</span>
  <span class="nt">--web-service-url</span> http://pulsar.us-west.example.com:8080/ <span class="se">\</span>
  <span class="nt">--web-service-url-tls</span> https://pulsar.us-west.example.com:8443/ <span class="se">\</span>
  <span class="nt">--broker-service-url</span> pulsar://pulsar.us-west.example.com:6650/ <span class="se">\</span>
  <span class="nt">--broker-service-url-tls</span> pulsar+ssl://pulsar.us-west.example.com:6651/
</code></pre></div></div>

<p>インスタンスで<a href="../../admin/Authz#tlsクライアント認証">TLS認証</a>を使用している場合のみ、<code class="highlighter-rouge">--*-tls</code>オプションを使用する必要があります。</p>

<h3 id="設定の取得">設定の取得</h3>

<p>既存のクラスタの<a href="../../reference/Configuration">設定</a>はいつでも取得が可能です。</p>

<h4 id="pulsar-admin-2">pulsar-admin</h4>

<p><a href="../../reference/CliTools#pulsar-admin-clusters-get"><code class="highlighter-rouge">get</code></a>サブコマンドを使用し、クラスタの名前を指定してください。以下はその例です:</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>pulsar-admin clusters get cluster-1
<span class="o">{</span>
    <span class="s2">"serviceUrl"</span>: <span class="s2">"http://my-cluster.org.com:8080/"</span>,
    <span class="s2">"serviceUrlTls"</span>: null,
    <span class="s2">"brokerServiceUrl"</span>: <span class="s2">"pulsar://my-cluster.org.com:6650/"</span>,
    <span class="s2">"brokerServiceUrlTls"</span>: null
<span class="o">}</span>
</code></pre></div></div>

<h4 id="rest-api-2">REST API</h4>

<div class="highlighter-rouge endpoint"><pre class="highlight"><code class="method get">GET</code><code class="url">/admin/clusters/<span class="endpoint">:cluster</span></code></pre></div>

<p><a href="../../reference/RestApi#/admin/clusters/:cluster">詳細</a></p>

<h4 id="java-1">Java</h4>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">admin</span><span class="o">.</span><span class="na">clusters</span><span class="o">().</span><span class="na">getCluster</span><span class="o">(</span><span class="n">clusterName</span><span class="o">);</span>
</code></pre></div></div>

<h3 id="更新">更新</h3>

<p>既存クラスタの設定変更はいつでも可能です。</p>

<h4 id="pulsar-admin-3">pulsar-admin</h4>

<p><a href="../../reference/CliTools#pulsar-admin-clusters-update"><code class="highlighter-rouge">update</code></a>サブコマンドを使用し、新しい設定値を指定してください:</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>pulsar-admin clusters update cluster-1 <span class="se">\</span>
  <span class="nt">--url</span> http://my-cluster.org.com:4081 <span class="se">\</span>
  <span class="nt">--broker-url</span> pulsar://my-cluster.org.com:3350
</code></pre></div></div>

<h4 id="rest">REST</h4>

<div class="highlighter-rouge endpoint"><pre class="highlight"><code class="method post">POST</code><code class="url">/admin/clusters/<span class="endpoint">:cluster</span></code></pre></div>

<p><a href="../../reference/RestApi#/admin/clusters/:cluster">詳細</a></p>

<h4 id="java-2">Java</h4>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">ClusterData</span> <span class="n">clusterData</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ClusterData</span><span class="o">(</span>
        <span class="n">serviceUrl</span><span class="o">,</span>
        <span class="n">serviceUrlTls</span><span class="o">,</span>
        <span class="n">brokerServiceUrl</span><span class="o">,</span>
        <span class="n">brokerServiceUrlTls</span>
<span class="o">);</span>
<span class="n">admin</span><span class="o">.</span><span class="na">clusters</span><span class="o">().</span><span class="na">updateCluster</span><span class="o">(</span><span class="n">clusterName</span><span class="o">,</span> <span class="n">clusterData</span><span class="o">);</span>
</code></pre></div></div>

<h3 id="削除">削除</h3>

<p>クラスタをPulsar<span class="popover-term" tabindex="0" title="Pulsarインスタンスとは？" data-placement="top" data-content="単一の単位として動作するPulsarクラスタのグループのことです。" data-toggle="popover" data-trigger="focus">インスタンス</span>から削除できます。</p>

<h4 id="pulsar-admin-4">pulsar-admin</h4>

<p><a href="../../reference/CliTools#pulsar-admin-clusters-delete"><code class="highlighter-rouge">delete</code></a>サブコマンドを使用し、クラスタの名前を指定してください:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$ pulsar-admin clusters delete cluster-1
</code></pre></div></div>

<h4 id="rest-api-3">REST API</h4>

<div class="highlighter-rouge endpoint"><pre class="highlight"><code class="method delete">DELETE</code><code class="url">/admin/clusters/<span class="endpoint">:cluster</span></code></pre></div>

<p><a href="../../reference/RestApi#/admin/clusters/:cluster">詳細</a></p>

<h4 id="java-3">Java</h4>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">admin</span><span class="o">.</span><span class="na">clusters</span><span class="o">().</span><span class="na">deleteCluster</span><span class="o">(</span><span class="n">clusterName</span><span class="o">);</span>
</code></pre></div></div>

<h3 id="リストを取得">リストを取得</h3>

<p>Pulsar <span class="popover-term" tabindex="0" title="Pulsarインスタンスとは？" data-placement="top" data-content="単一の単位として動作するPulsarクラスタのグループのことです。" data-toggle="popover" data-trigger="focus">インスタンス</span>内の全てのクラスタのリストを取得できます。</p>

<h4 id="pulsar-admin-5">pulsar-admin</h4>

<p><a href="../../reference/CliTools#pulsar-admin-clusters-list"><code class="highlighter-rouge">list</code></a>サブコマンドを使用してください。</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>pulsar-admin clusters list
cluster-1
cluster-2
</code></pre></div></div>

<h4 id="rest-api-4">REST API</h4>

<div class="highlighter-rouge endpoint"><pre class="highlight"><code class="method get">GET</code><code class="url">/admin/clusters</code></pre></div>

<p><a href="../../reference/RestApi#/admin/clusters">詳細</a></p>

<h6 id="java-4">Java</h6>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">admin</span><span class="o">.</span><span class="na">clusters</span><span class="o">().</span><span class="na">getClusters</span><span class="o">();</span>
</code></pre></div></div>

<h2 id="brokerの管理">Brokerの管理</h2>

<!--

    Licensed to the Apache Software Foundation (ASF) under one
    or more contributor license agreements.  See the NOTICE file
    distributed with this work for additional information
    regarding copyright ownership.  The ASF licenses this file
    to you under the Apache License, Version 2.0 (the
    "License"); you may not use this file except in compliance
    with the License.  You may obtain a copy of the License at

      http://www.apache.org/licenses/LICENSE-2.0

    Unless required by applicable law or agreed to in writing,
    software distributed under the License is distributed on an
    "AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
    KIND, either express or implied.  See the License for the
    specific language governing permissions and limitations
    under the License.

-->

<p>Pulsar Brokerは2つのコンポーネントから構成されます:</p>

<ol>
  <li>管理操作と<span class="popover-term" tabindex="0" title="トピックとは？" data-placement="top" data-content="Producerが発行したメッセージをConsumerに届けるために使用される名前付きのチャネルです。" data-toggle="popover" data-trigger="focus">トピック</span>ルックアップのための<a href="../../reference/RestApi">RESTインターフェース</a>を提供するHTTPサーバ</li>
  <li>Pulsarの全ての<span class="popover-term" tabindex="0" title="Pulsarでのメッセージとは？" data-placement="top" data-content="A" data-toggle="popover" data-trigger="focus">メッセージ</span>の転送を処理するディスパッチャ</li>
</ol>

<p><span class="popover-term" tabindex="0" title="Brokerとは？" data-placement="top" data-content="2つの異なるコンポーネントを実行するPulsarクラスタのステートレスなコンポーネントです。2つのコンポーネントとは管理操作とトピックルックアップのためのRESTインターフェースを提供するHTTPサーバと全てのメッセージの転送を処理するディスパッチャです。またPulsarクラスタは基本的に複数のBrokerから構成されます。" data-toggle="popover" data-trigger="focus">Broker</span>は以下を経由して管理できます:</p>

<ul>
  <li><a href="../../reference/CliTools#pulsar-admin"><code class="highlighter-rouge">pulsar-admin</code></a>ツールの<a href="../../reference/CliTools#pulsar-admin-brokers"><code class="highlighter-rouge">brokers</code></a>コマンド</li>
  <li>admin <a href="../../reference/RestApi">REST API</a>の<code class="highlighter-rouge">/admin/brokers</code>エンドポイント</li>
  <li>Java <a href="../../admin/AdminInterface">admin API</a>の<a target="_blank" href="/api/admin/org/apache/pulsar/client/admin/PulsarAdmin.html"><code class="highlighter-rouge">PulsarAdmin</code></a>オブジェクトの<code class="highlighter-rouge">brokers</code>メソッド</li>
</ul>

<p>起動時に設定可能であることに加えて、<a href="#動的なBrokerの設定">動的に設定</a>可能です。</p>

<!--

    Licensed to the Apache Software Foundation (ASF) under one
    or more contributor license agreements.  See the NOTICE file
    distributed with this work for additional information
    regarding copyright ownership.  The ASF licenses this file
    to you under the Apache License, Version 2.0 (the
    "License"); you may not use this file except in compliance
    with the License.  You may obtain a copy of the License at

      http://www.apache.org/licenses/LICENSE-2.0

    Unless required by applicable law or agreed to in writing,
    software distributed under the License is distributed on an
    "AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
    KIND, either express or implied.  See the License for the
    specific language governing permissions and limitations
    under the License.

-->
<div class="admonition">
  <div class="info">
    
    
<p>Brokerの全パラメータのリストは<a href="../../reference/Configuration#broker">設定</a>ページを参照してください。</p>

  </div>
</div>

<h3 id="アクティブなbrokerリストの取得">アクティブなBrokerリストの取得</h3>

<p>トラフィックを処理している利用可能な全てのアクティブなBrokerリストを取得します。</p>

<h4 id="pulsar-admin-6">pulsar-admin</h4>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>pulsar-admin brokers list use
</code></pre></div></div>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>broker1.use.org.com:8080
</code></pre></div></div>

<h6 id="rest-1">REST</h6>

<div class="highlighter-rouge endpoint"><pre class="highlight"><code class="method get">GET</code><code class="url">/admin/brokers/<span class="endpoint">:cluster</span></code></pre></div>

<p><a href="../../reference/RestApi#/admin/brokers/:cluster">詳細</a></p>

<h6 id="java-5">Java</h6>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">admin</span><span class="o">.</span><span class="na">brokers</span><span class="o">().</span><span class="na">getActiveBrokers</span><span class="o">(</span><span class="n">clusterName</span><span class="o">)</span>
</code></pre></div></div>

<h4 id="指定したbrokerが担当しているネームスペースリストの取得">指定したBrokerが担当しているネームスペースリストの取得</h4>

<p>指定されたBrokerが担当、処理している全ネームスペースを取得します。</p>

<h6 id="cli">CLI</h6>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>pulsar-admin brokers namespaces use <span class="se">\</span>
  <span class="nt">--url</span> broker1.use.org.com:8080
</code></pre></div></div>

<div class="language-json highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">{</span><span class="w">
  </span><span class="s2">"my-property/use/my-ns/0x00000000_0xffffffff"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="s2">"broker_assignment"</span><span class="p">:</span><span class="w"> </span><span class="s2">"shared"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"is_controlled"</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="p">,</span><span class="w">
    </span><span class="s2">"is_active"</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="w">
  </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div></div>
<h6 id="rest-2">REST</h6>

<div class="highlighter-rouge endpoint"><pre class="highlight"><code class="method get">GET</code><code class="url">/admin/brokers/<span class="endpoint">:cluster</span>/<span class="endpoint">:broker</span>:/ownedNamespaces</code></pre></div>

<h6 id="java-6">Java</h6>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">admin</span><span class="o">.</span><span class="na">brokers</span><span class="o">().</span><span class="na">getOwnedNamespaces</span><span class="o">(</span><span class="n">cluster</span><span class="o">,</span><span class="n">brokerUrl</span><span class="o">);</span>
</code></pre></div></div>

<h3 id="動的なbrokerの設定">動的なBrokerの設定</h3>

<p>Pulsar <span class="popover-term" tabindex="0" title="Brokerとは？" data-placement="top" data-content="2つの異なるコンポーネントを実行するPulsarクラスタのステートレスなコンポーネントです。2つのコンポーネントとは管理操作とトピックルックアップのためのRESTインターフェースを提供するHTTPサーバと全てのメッセージの転送を処理するディスパッチャです。またPulsarクラスタは基本的に複数のBrokerから構成されます。" data-toggle="popover" data-trigger="focus">Broker</span>を設定する1つの方法はBroker<a href="../../reference/CliTools#pulsar-broker">起動</a>時に<a href="../../reference/Configuration#broker">設定</a>する方法です。</p>

<p>しかしPulsarでは全てのBrokerの設定は<span class="popover-term" tabindex="0" title="ZooKeeperとは？" data-placement="top" data-content="Pulsarが調整タスクに利用するサービスです。&lt;br /&gt;&lt;br /&gt;Pulsarインスタンスはクラスタ特有のタスク用のLocal ZooKeeperとインスタンス全体のタスク用のGlobal ZooKeeperに依存しています。" data-toggle="popover" data-trigger="focus">ZooKeeper</span>に保存されているので、<em>Brokerが起動していれば</em>設定値を動的に更新することも可能です。Brokerの設定を動的に更新したら、ZooKeeperはBrokerに変更を通知しBrokerは現在の設定値を上書きします。</p>

<ul>
  <li><a href="../../reference/CliTools#pulsar-admin"><code class="highlighter-rouge">pulsar-admin</code></a>ツールの<a href="../../reference/CliTools#pulsar-admin-brokers"><code class="highlighter-rouge">brokers</code></a>コマンドは、Brokerの設定を動的に操作したり、<a href="#動的な設定の更新">設定値</a>の更新などを可能にする様々なサブコマンドを持っています。</li>
  <li>Pulsarのadmin <a href="../../reference/RestApi">REST API</a>では、動的な設定は<code class="highlighter-rouge">/admin/brokers/configuration</code>エンドポイントを通して管理されます。</li>
</ul>

<h3 id="動的な設定の更新">動的な設定の更新</h3>

<h4 id="pulsar-admin-7">pulsar-admin</h4>

<p><a href="../../reference/CliTools#pulsar-admin-brokers-update-dynamic-config"><code class="highlighter-rouge">update-dynamic-config</code></a>サブコマンドは既存の設定を更新します。パラメータ名と新しい値の2つの引数を取ります。以下は<a href="../../reference/Configuration#broker-brokerShutdownTimeoutMs"><code class="highlighter-rouge">brokerShutdownTimeoutMs</code></a>パラメータの例です:</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>pulsar-admin brokers update-dynamic-config brokerShutdownTimeoutMs 100
</code></pre></div></div>

<h4 id="rest-api-5">REST API</h4>

<div class="highlighter-rouge endpoint"><pre class="highlight"><code class="method post">POST</code><code class="url">/admin/brokers/configuration/<span class="endpoint">:configName</span>/<span class="endpoint">:configValue</span></code></pre></div>

<p><a href="../../reference/RestApi#/admin/brokers/configuration/:configName/:configValue">詳細</a></p>

<h4 id="java-7">Java</h4>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">admin</span><span class="o">.</span><span class="na">brokers</span><span class="o">().</span><span class="na">updateDynamicConfiguration</span><span class="o">(</span><span class="n">configName</span><span class="o">,</span> <span class="n">configValue</span><span class="o">);</span>
</code></pre></div></div>

<h3 id="アップデート可能な値のリストを取得">アップデート可能な値のリストを取得</h3>

<p>全ての更新可能な設定パラメータリストを取得します。</p>

<h4 id="pulsar-admin-8">pulsar-admin</h4>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>pulsar-admin brokers list-dynamic-config
brokerShutdownTimeoutMs
</code></pre></div></div>

<h4 id="rest-api-6">REST API</h4>

<div class="highlighter-rouge endpoint"><pre class="highlight"><code class="method get">GET</code><code class="url">/admin/brokers/configuration</code></pre></div>

<p><a href="../../reference/RestApi#/admin/brokers/configuration">詳細</a></p>

<h4 id="java-8">Java</h4>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">admin</span><span class="o">.</span><span class="na">brokers</span><span class="o">().</span><span class="na">getDynamicConfigurationNames</span><span class="o">();</span>
</code></pre></div></div>

<h3 id="全てのリストを取得">全てのリストを取得</h3>

<p>動的に更新された全てのパラメータリストを取得します。</p>

<h4 id="pulsar-admin-9">pulsar-admin</h4>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>pulsar-admin brokers get-all-dynamic-config
brokerShutdownTimeoutMs:100
</code></pre></div></div>

<h4 id="rest-api-7">REST API</h4>

<div class="highlighter-rouge endpoint"><pre class="highlight"><code class="method get">GET</code><code class="url">/admin/brokers/configuration/values</code></pre></div>

<p><a href="../../reference/RestApi#/admin/brokers/configuration/values">詳細</a></p>

<h4 id="java-9">Java</h4>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">admin</span><span class="o">.</span><span class="na">brokers</span><span class="o">().</span><span class="na">getAllDynamicConfigurations</span><span class="o">();</span>
</code></pre></div></div>

<h2 id="プロパティの管理">プロパティの管理</h2>

<p>プロパティはアプリケーションドメインを識別するためのものです。例えばfinance, mail, sportsなどがプロパティの例にあたります。adminツールはPulsarのプロパティを管理するためのCRUD操作を可能にします。</p>

<h4 id="既存のプロパティのリストを取得">既存のプロパティのリストを取得</h4>

<p>Pulsarシステムにおける既存のプロパティのリストを取得します。</p>

<h6 id="cli-1">CLI</h6>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$ pulsar-admin properties list
</code></pre></div></div>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>my-property
</code></pre></div></div>

<h6 id="rest-3">REST</h6>

<div class="highlighter-rouge endpoint"><pre class="highlight"><code class="method get">GET</code><code class="url">/admin/properties</code></pre></div>

<h6 id="java-10">Java</h6>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">admin</span><span class="o">.</span><span class="na">properties</span><span class="o">().</span><span class="na">getProperties</span><span class="o">()</span>
</code></pre></div></div>

<h4 id="プロパティの作成">プロパティの作成</h4>

<p>Pulsarシステムに新しいプロパティを作成します。プロパティに対しては、プロパティを管理可能なadminロール (カンマ区切りで複数指定可能) とプロパティが利用可能なクラスタ (カンマ区切りで複数指定可能) を設定できます。</p>

<h6 id="cli-2">CLI</h6>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>pulsar-admin properties create my-property <span class="se">\</span>
  <span class="nt">--admin-roles</span> admin1,admin2 <span class="se">\</span>
  <span class="nt">--allowed-clusters</span> cl1,cl2
</code></pre></div></div>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>N/A
</code></pre></div></div>

<h6 id="rest-4">REST</h6>

<div class="highlighter-rouge endpoint"><pre class="highlight"><code class="method put">PUT</code><code class="url">/admin/properties/<span class="endpoint">:property</span></code></pre></div>

<h6 id="java-11">Java</h6>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">admin</span><span class="o">.</span><span class="na">properties</span><span class="o">().</span><span class="na">createProperty</span><span class="o">(</span><span class="n">property</span><span class="o">,</span> <span class="n">propertyAdmin</span><span class="o">)</span>
</code></pre></div></div>

<h4 id="プロパティの取得">プロパティの取得</h4>

<p>指定された既存プロパティの設定を取得します。</p>

<h6 id="cli-3">CLI</h6>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$pulsar-admin properties get my-property
</code></pre></div></div>

<div class="language-json highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">{</span><span class="w">
    </span><span class="s2">"adminRoles"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
        </span><span class="s2">"admin1"</span><span class="p">,</span><span class="w">
        </span><span class="s2">"admin2"</span><span class="w">
    </span><span class="p">],</span><span class="w">
    </span><span class="s2">"allowedClusters"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
        </span><span class="s2">"cl1"</span><span class="p">,</span><span class="w">
        </span><span class="s2">"cl2"</span><span class="w">
    </span><span class="p">]</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div></div>

<h6 id="rest-5">REST</h6>

<div class="highlighter-rouge endpoint"><pre class="highlight"><code class="method get">GET</code><code class="url">/admin/properties/<span class="endpoint">:property</span></code></pre></div>

<h6 id="java-12">Java</h6>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">admin</span><span class="o">.</span><span class="na">properties</span><span class="o">().</span><span class="na">getPropertyAdmin</span><span class="o">(</span><span class="n">property</span><span class="o">)</span>
</code></pre></div></div>

<h4 id="プロパティの更新">プロパティの更新</h4>

<p>既に作成済みのプロパティの設定を更新します。指定された既存プロパティのadminロールとクラスタ情報の更新が可能です。</p>

<h6 id="cli-4">CLI</h6>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>pulsar-admin properties update my-property <span class="se">\</span>
  <span class="nt">--admin-roles</span> admin-update-1,admin-update-2 <span class="se">\</span>
  <span class="nt">--allowed-clusters</span> cl1,cl2
</code></pre></div></div>

<h6 id="rest-6">REST</h6>

<div class="highlighter-rouge endpoint"><pre class="highlight"><code class="method post">POST</code><code class="url">/admin/properties/<span class="endpoint">:property</span></code></pre></div>

<h6 id="java-13">Java</h6>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">admin</span><span class="o">.</span><span class="na">properties</span><span class="o">().</span><span class="na">updateProperty</span><span class="o">(</span><span class="n">property</span><span class="o">,</span> <span class="n">propertyAdmin</span><span class="o">)</span>
</code></pre></div></div>

<h4 id="プロパティの削除">プロパティの削除</h4>

<p>Pulsarシステムから既存のプロパティを削除します。</p>
<h6 id="cli-5">CLI</h6>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$ pulsar-admin properties delete my-property
</code></pre></div></div>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>N/A
</code></pre></div></div>

<h6 id="rest-7">REST</h6>

<div class="highlighter-rouge endpoint"><pre class="highlight"><code class="method delete">DELETE</code><code class="url">/admin/properties/<span class="endpoint">:property</span></code></pre></div>

<h6 id="java-14">Java</h6>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">admin</span><span class="o">.</span><span class="na">properties</span><span class="o">().</span><span class="na">deleteProperty</span><span class="o">(</span><span class="n">property</span><span class="o">);</span>
</code></pre></div></div>

<h2 id="ネームスペースの管理">ネームスペースの管理</h2>

<!--

    Licensed to the Apache Software Foundation (ASF) under one
    or more contributor license agreements.  See the NOTICE file
    distributed with this work for additional information
    regarding copyright ownership.  The ASF licenses this file
    to you under the Apache License, Version 2.0 (the
    "License"); you may not use this file except in compliance
    with the License.  You may obtain a copy of the License at

      http://www.apache.org/licenses/LICENSE-2.0

    Unless required by applicable law or agreed to in writing,
    software distributed under the License is distributed on an
    "AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
    KIND, either express or implied.  See the License for the
    specific language governing permissions and limitations
    under the License.

-->

<p>Pulsarの<span class="popover-term" tabindex="0" title="ネームスペースとは？" data-placement="top" data-content="関連トピックのグループ化メカニズムです。" data-toggle="popover" data-trigger="focus">ネームスペース</span>は<span class="popover-term" tabindex="0" title="トピックとは？" data-placement="top" data-content="Producerが発行したメッセージをConsumerに届けるために使用される名前付きのチャネルです。" data-toggle="popover" data-trigger="focus">トピック</span>の論理的なグループです。</p>

<p>ネームスペースは以下のように管理されます:</p>

<ul>
  <li><a href="../../reference/CliTools#pulsar-admin"><code class="highlighter-rouge">pulsar-admin</code></a>ツールの<a href="../../reference/CliTools#pulsar-admin-namespaces"><code class="highlighter-rouge">namespaces</code></a>コマンド</li>
  <li>admin <a href="../../reference/RestApi">REST API</a>のエンドポイント<code class="highlighter-rouge">/admin/namespaces</code></li>
  <li>Java <a href="../../admin/AdminInterface">admin API</a>の<a target="_blank" href="/api/admin/org/apache/pulsar/client/admin/PulsarAdmin.html"><code class="highlighter-rouge">PulsarAdmin</code></a>オブジェクトの<code class="highlighter-rouge">namespaces</code>メソッド</li>
</ul>

<h3 id="作成">作成</h3>

<p>指定した<span class="popover-term" tabindex="0" title="プロパティとは？" data-placement="top" data-content="Pulsarのテナントです。" data-toggle="popover" data-trigger="focus">プロパティ</span>およびPulsar<span class="popover-term" tabindex="0" title="クラスタとは？" data-placement="top" data-content="Pulsar BrokerとBookKeeperサーバ (Bookie) のセットのことです。それぞれのクラスタは異なる地理的地域に存在することができ、メッセージをクラスタ間で相互に複製することができます。この機能をジオレプリケーションと呼びます。" data-toggle="popover" data-trigger="focus">クラスタ</span>内に新しいネームスペースを作成できます。</p>

<h4 id="pulsar-admin-10">pulsar-admin</h4>

<p><a href="../../reference/CliTools#pulsar-admin-namespaces-create"><code class="highlighter-rouge">create</code></a>サブコマンドを使用し、ネームスペースを指定します:</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>pulsar-admin namespaces create test-property/cl1/ns1
</code></pre></div></div>

<h4 id="rest-api-8">REST API</h4>

<div class="highlighter-rouge endpoint"><pre class="highlight"><code class="method put">PUT</code><code class="url">/admin/namespaces/<span class="endpoint">:property</span>/<span class="endpoint">:cluster</span>/<span class="endpoint">:namespace</span></code></pre></div>

<p><a href="../../reference/RestApi#/admin/namespaces/:property/:cluster/:namespace">詳細</a></p>

<h4 id="java-15">Java</h4>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">admin</span><span class="o">.</span><span class="na">namespaces</span><span class="o">().</span><span class="na">createNamespace</span><span class="o">(</span><span class="n">namespace</span><span class="o">);</span>
</code></pre></div></div>

<h3 id="ポリシーの取得">ポリシーの取得</h3>

<p>ネームスペースに関連付けられた現在のポリシーはいつでも取得できます。</p>

<h4 id="pulsar-admin-11">pulsar-admin</h4>

<p><a href="../../reference/CliTools#pulsar-admin-namespaces-policies"><code class="highlighter-rouge">policies</code></a>サブコマンドを使用して、ネームスペースを指定します:</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>pulsar-admin namespaces policies test-property/cl1/ns1
<span class="o">{</span>
  <span class="s2">"auth_policies"</span>: <span class="o">{</span>
    <span class="s2">"namespace_auth"</span>: <span class="o">{}</span>,
    <span class="s2">"destination_auth"</span>: <span class="o">{}</span>
  <span class="o">}</span>,
  <span class="s2">"replication_clusters"</span>: <span class="o">[]</span>,
  <span class="s2">"bundles_activated"</span>: <span class="nb">true</span>,
  <span class="s2">"bundles"</span>: <span class="o">{</span>
    <span class="s2">"boundaries"</span>: <span class="o">[</span>
      <span class="s2">"0x00000000"</span>,
      <span class="s2">"0xffffffff"</span>
    <span class="o">]</span>,
    <span class="s2">"numBundles"</span>: 1
  <span class="o">}</span>,
  <span class="s2">"backlog_quota_map"</span>: <span class="o">{}</span>,
  <span class="s2">"persistence"</span>: null,
  <span class="s2">"latency_stats_sample_rate"</span>: <span class="o">{}</span>,
  <span class="s2">"message_ttl_in_seconds"</span>: 0,
  <span class="s2">"retention_policies"</span>: null,
  <span class="s2">"deleted"</span>: <span class="nb">false</span>
<span class="o">}</span>
</code></pre></div></div>

<h4 id="rest-api-9">REST API</h4>

<div class="highlighter-rouge endpoint"><pre class="highlight"><code class="method get">GET</code><code class="url">/admin/namespaces/<span class="endpoint">:property</span>/<span class="endpoint">:cluster</span>/<span class="endpoint">:namespace</span></code></pre></div>

<p><a href="../../reference/RestApi#/admin/namespaces/:property/:cluster/:namespace">詳細</a></p>

<h4 id="java-16">Java</h4>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">admin</span><span class="o">.</span><span class="na">namespaces</span><span class="o">().</span><span class="na">getPolicies</span><span class="o">(</span><span class="n">namespace</span><span class="o">);</span>
</code></pre></div></div>

<h3 id="プロパティ内のネームスペースのリストを取得">プロパティ内のネームスペースのリストを取得</h3>

<p>指定されたPulsarの<span class="popover-term" tabindex="0" title="プロパティとは？" data-placement="top" data-content="Pulsarのテナントです。" data-toggle="popover" data-trigger="focus">プロパティ</span>内のすべてのネームスペースのリストを取得することができます。</p>

<h4 id="pulsar-admin-12">pulsar-admin</h4>

<p><a href="../../reference/CliTools#pulsar-admin-namespaces-list"><code class="highlighter-rouge">list</code></a>サブコマンドを使用して、プロパティを指定します:</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>pulsar-admin namespaces list test-property
test-property/cl1/ns1
test-property/cl2/ns2
</code></pre></div></div>

<h4 id="rest-api-10">REST API</h4>

<div class="highlighter-rouge endpoint"><pre class="highlight"><code class="method get">GET</code><code class="url">/admin/namespaces/<span class="endpoint">:property</span></code></pre></div>

<p><a href="../../reference/RestApi#/admin/namespaces/:property">詳細</a></p>

<h4 id="java-17">Java</h4>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">admin</span><span class="o">.</span><span class="na">namespaces</span><span class="o">().</span><span class="na">getNamespaces</span><span class="o">(</span><span class="n">property</span><span class="o">);</span>
</code></pre></div></div>

<h3 id="クラスタ内のネームスペースのリストを取得">クラスタ内のネームスペースのリストを取得</h3>

<p>指定したPulsar<span class="popover-term" tabindex="0" title="クラスタとは？" data-placement="top" data-content="Pulsar BrokerとBookKeeperサーバ (Bookie) のセットのことです。それぞれのクラスタは異なる地理的地域に存在することができ、メッセージをクラスタ間で相互に複製することができます。この機能をジオレプリケーションと呼びます。" data-toggle="popover" data-trigger="focus">クラスタ</span>内のすべてのネームスペースを表示できます。</p>

<h4 id="pulsar-admin-13">pulsar-admin</h4>

<p><a href="../../reference/CliTools#pulsar-admin-namespaces-list-cluster"><code class="highlighter-rouge">list-cluster</code></a>サブコマンドを使用して、クラスタを指定します:</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>pulsar-admin namespaces list-cluster test-property/cl1
test-property/cl1/ns1
test-property/cl1/ns1
</code></pre></div></div>

<h4 id="rest-api-11">REST API</h4>

<div class="highlighter-rouge endpoint"><pre class="highlight"><code class="method get">GET</code><code class="url">/admin/namespaces/<span class="endpoint">:property</span>/<span class="endpoint">:cluster</span></code></pre></div>

<p><a href="../../reference/RestApi#/admin/namespaces/:property/:cluster">詳細</a></p>

<h4 id="java-18">Java</h4>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">admin</span><span class="o">.</span><span class="na">namespaces</span><span class="o">().</span><span class="na">getNamespaces</span><span class="o">(</span><span class="n">property</span><span class="o">,</span> <span class="n">cluster</span><span class="o">);</span>
</code></pre></div></div>

<h3 id="削除-1">削除</h3>

<p>プロパティ/クラスタから既存のネームスペースを削除できます。</p>

<h4 id="pulsar-admin-14">pulsar-admin</h4>

<p><a href="../../reference/CliTools#pulsar-admin-namespaces-delete"><code class="highlighter-rouge">delete</code></a>サブコマンドを使用して、ネームスペースを指定します:</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>pulsar-admin namespaces delete test-property/cl1/ns1
</code></pre></div></div>

<h4 id="rest-8">REST</h4>

<div class="highlighter-rouge endpoint"><pre class="highlight"><code class="method delete">DELETE</code><code class="url">/admin/namespaces/<span class="endpoint">:property</span>/<span class="endpoint">:cluster</span>/<span class="endpoint">:namespace</span></code></pre></div>

<p><a href="../../reference/RestApi#/admin/namespaces/:property/:cluster/:namespace">詳細</a></p>

<h4 id="java-19">Java</h4>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">admin</span><span class="o">.</span><span class="na">namespaces</span><span class="o">().</span><span class="na">deleteNamespace</span><span class="o">(</span><span class="n">namespace</span><span class="o">);</span>
</code></pre></div></div>

<h2 id="パーミッションの管理">パーミッションの管理</h2>

<!--

    Licensed to the Apache Software Foundation (ASF) under one
    or more contributor license agreements.  See the NOTICE file
    distributed with this work for additional information
    regarding copyright ownership.  The ASF licenses this file
    to you under the Apache License, Version 2.0 (the
    "License"); you may not use this file except in compliance
    with the License.  You may obtain a copy of the License at

      http://www.apache.org/licenses/LICENSE-2.0

    Unless required by applicable law or agreed to in writing,
    software distributed under the License is distributed on an
    "AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
    KIND, either express or implied.  See the License for the
    specific language governing permissions and limitations
    under the License.

-->

<p>Pulsarにおけるパーミッションは<span class="popover-term" tabindex="0" title="ネームスペースとは？" data-placement="top" data-content="関連トピックのグループ化メカニズムです。" data-toggle="popover" data-trigger="focus">ネームスペース</span>レベル (つまり<span class="popover-term" tabindex="0" title="プロパティとは？" data-placement="top" data-content="Pulsarのテナントです。" data-toggle="popover" data-trigger="focus">プロパティ</span>および<span class="popover-term" tabindex="0" title="クラスタとは？" data-placement="top" data-content="Pulsar BrokerとBookKeeperサーバ (Bookie) のセットのことです。それぞれのクラスタは異なる地理的地域に存在することができ、メッセージをクラスタ間で相互に複製することができます。この機能をジオレプリケーションと呼びます。" data-toggle="popover" data-trigger="focus">クラスタ</span>内) で管理されます。</p>

<h3 id="パーミッションの付与">パーミッションの付与</h3>

<p><code class="highlighter-rouge">produce</code>や<code class="highlighter-rouge">consume</code>のような操作のリストに対して、特定のロールにパーミッションを与える事ができます。</p>

<h4 id="pulsar-admin-15">pulsar-admin</h4>

<p><a href="../../reference/CliTools#pulsar-admin-namespaces-grant-permission"><code class="highlighter-rouge">grant-permission</code></a>サブコマンドを使用し、ネームスペースと、<code class="highlighter-rouge">--actions</code>オプションでアクションを、<code class="highlighter-rouge">--role</code>オプションでロールを指定してください:</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>pulsar-admin namespaces grant-permission test-property/cl1/ns1 <span class="se">\</span>
  <span class="nt">--actions</span> produce,consume <span class="se">\</span>
  <span class="nt">--role</span> admin10
</code></pre></div></div>

<p><code class="highlighter-rouge">broker.conf</code>で<code class="highlighter-rouge">authorizationAllowWildcardsMatching</code>が<code class="highlighter-rouge">true</code>に設定されている場合、ワイルドカードを用いた認可が行われます。</p>

<p>例:</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>pulsar-admin namespaces grant-permission test-property/cl1/ns1 <span class="se">\</span>
                        <span class="nt">--actions</span> produce,consume <span class="se">\</span>
                        <span class="nt">--role</span> <span class="s1">'my.role.*'</span>
</code></pre></div></div>

<p>この時、<code class="highlighter-rouge">my.role.1</code>, <code class="highlighter-rouge">my.role.2</code>, <code class="highlighter-rouge">my.role.foo</code>, <code class="highlighter-rouge">my.role.bar</code>などのロールがproduce/consume可能となります。</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>pulsar-admin namespaces grant-permission test-property/cl1/ns1 <span class="se">\</span>
                        <span class="nt">--actions</span> produce,consume <span class="se">\</span>
                        <span class="nt">--role</span> <span class="s1">'*.role.my'</span>
</code></pre></div></div>

<p>この時、<code class="highlighter-rouge">1.role.my</code>, <code class="highlighter-rouge">2.role.my</code>, <code class="highlighter-rouge">foo.role.my</code>, <code class="highlighter-rouge">bar.role.my</code>などのロールがproduce/consume可能となります。</p>

<p><strong>注意</strong>: ワイルドカードを用いたマッチングは<strong>ロール名の先頭または末尾でのみ</strong>機能します。</p>

<p>例:</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>pulsar-admin namespaces grant-permission test-property/cl1/ns1 <span class="se">\</span>
                        <span class="nt">--actions</span> produce,consume <span class="se">\</span>
                        <span class="nt">--role</span> <span class="s1">'my.*.role'</span>
</code></pre></div></div>

<p>この場合、ロール<code class="highlighter-rouge">my.*.role</code>のみがパーミッションを持っています。<code class="highlighter-rouge">my.1.role</code>, <code class="highlighter-rouge">my.2.role</code>, <code class="highlighter-rouge">my.foo.role</code>, <code class="highlighter-rouge">my.bar.role</code>のようなロールはproduce/consumeが<strong>できません</strong>。</p>

<h4 id="rest-api-12">REST API</h4>

<div class="highlighter-rouge endpoint"><pre class="highlight"><code class="method post">POST</code><code class="url">/admin/namespaces/<span class="endpoint">:property</span>/<span class="endpoint">:cluster</span>/<span class="endpoint">:namespace</span>/permissions/<span class="endpoint">:role</span></code></pre></div>

<p><a href="../../reference/RestApi#/admin/namespaces/:property/:cluster/:namespace/permissions/:role">詳細</a></p>

<h4 id="java-20">Java</h4>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">admin</span><span class="o">.</span><span class="na">namespaces</span><span class="o">().</span><span class="na">grantPermissionOnNamespace</span><span class="o">(</span><span class="n">namespace</span><span class="o">,</span> <span class="n">role</span><span class="o">,</span> <span class="n">getAuthActions</span><span class="o">(</span><span class="n">actions</span><span class="o">));</span>
</code></pre></div></div>

<h3 id="パーミッションの取得">パーミッションの取得</h3>

<p>ネームスペースにおいて、どのロールにどのパーミッションが与えられているかを確認できます。</p>

<h4 id="pulsar-admin-16">pulsar-admin</h4>

<p><a href="../../reference/CliTools#pulsar-admin-namespaces-permissions"><code class="highlighter-rouge">permissions</code></a>サブコマンドを使用しネームスペースを指定してください:</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>pulsar-admin namespaces permissions test-property/cl1/ns1
<span class="o">{</span>
  <span class="s2">"admin10"</span>: <span class="o">[</span>
    <span class="s2">"produce"</span>,
    <span class="s2">"consume"</span>
  <span class="o">]</span>
<span class="o">}</span>   
</code></pre></div></div>

<h4 id="rest-api-13">REST API</h4>

<div class="highlighter-rouge endpoint"><pre class="highlight"><code class="method get">GET</code><code class="url">/admin/namespaces/<span class="endpoint">:property</span>/<span class="endpoint">:cluster</span>/<span class="endpoint">:namespace</span>/permissions</code></pre></div>

<p><a href="../../reference/RestApi#/admin/namespaces/:property/:cluster/:namespace/permissions">詳細</a></p>

<h4 id="java-21">Java</h4>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">admin</span><span class="o">.</span><span class="na">namespaces</span><span class="o">().</span><span class="na">getPermissions</span><span class="o">(</span><span class="n">namespace</span><span class="o">);</span>
</code></pre></div></div>

<h3 id="パーミッションの剥奪">パーミッションの剥奪</h3>

<p>特定のロールからパーミッションを剥奪できます。つまり、そのロールは指定されたネームスペースにアクセスできなくなります。</p>

<h4 id="pulsar-admin-17">pulsar-admin</h4>

<p><a href="../../reference/CliTools#pulsar-admin-revoke-permission"><code class="highlighter-rouge">revoke-permission</code></a>サブコマンドを使用し、ネームスペースと、<code class="highlighter-rouge">--role</code>オプションでロールを指定してください:</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>pulsar-admin namespaces revoke-permission test-property/cl1/ns1 <span class="se">\</span>
  <span class="nt">--role</span> admin10
</code></pre></div></div>

<h4 id="rest-api-14">REST API</h4>

<div class="highlighter-rouge endpoint"><pre class="highlight"><code class="method delete">DELETE</code><code class="url">/admin/namespaces/<span class="endpoint">:property</span>/<span class="endpoint">:cluster</span>/<span class="endpoint">:namespace</span>/permissions/<span class="endpoint">:role</span></code></pre></div>

<p><a href="../../reference/RestApi#/admin/namespaces/:property/:cluster/:namespace/permissions/:role">詳細</a></p>

<h4 id="java-22">Java</h4>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">admin</span><span class="o">.</span><span class="na">namespaces</span><span class="o">().</span><span class="na">revokePermissionsOnNamespace</span><span class="o">(</span><span class="n">namespace</span><span class="o">,</span> <span class="n">role</span><span class="o">);</span>
</code></pre></div></div>

<h4 id="レプリケーションクラスタの設定">レプリケーションクラスタの設定</h4>

<p>ネームスペースにレプリケーションクラスタを設定し、Pulsarが内部的に発行されたメッセージを一つのコロケーションから別のコロケーションにレプリケートできるようにします。しかし、レプリケーションクラスタをセットするためにはネームスペースは<em>test-property/<strong>global</strong>/ns1</em>のようにグローバルである必要があります。つまりクラスタ名は<em>“global”</em>でなければなりません。</p>

<h6 id="cli-6">CLI</h6>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$ pulsar-admin namespaces set-clusters test-property/cl1/ns1 \
  --clusters cl2
</code></pre></div></div>

<h6 id="rest-9">REST</h6>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>&lt;div class="highlighter-rouge endpoint"&gt;&lt;pre class="highlight"&gt;&lt;code class="method post"&gt;POST&lt;/code&gt;&lt;code class="url"&gt;/admin/namespaces/&lt;span class="endpoint"&gt;:property&lt;/span&gt;/&lt;span class="endpoint"&gt;:cluster&lt;/span&gt;/&lt;span class="endpoint"&gt;:namespace&lt;/span&gt;/replication&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
</code></pre></div></div>

<h6 id="java-23">Java</h6>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">admin</span><span class="o">.</span><span class="na">namespaces</span><span class="o">().</span><span class="na">setNamespaceReplicationClusters</span><span class="o">(</span><span class="n">namespace</span><span class="o">,</span> <span class="n">clusters</span><span class="o">)</span>
</code></pre></div></div>

<h4 id="レプリケーションクラスタの取得">レプリケーションクラスタの取得</h4>

<p>指定されたネームスペースのレプリケーションクラスタのリストを提供します。</p>

<h6 id="cli-7">CLI</h6>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$ pulsar-admin namespaces get-clusters test-property/cl1/ns1
</code></pre></div></div>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>cl2
</code></pre></div></div>

<h6 id="rest-10">REST</h6>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>GET /admin/namespaces/{property}/{cluster}/{namespace}/replication
</code></pre></div></div>

<h6 id="java-24">Java</h6>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">admin</span><span class="o">.</span><span class="na">namespaces</span><span class="o">().</span><span class="na">getNamespaceReplicationClusters</span><span class="o">(</span><span class="n">namespace</span><span class="o">)</span>
</code></pre></div></div>

<h4 id="バックログクォータポリシーの設定">バックログクォータポリシーの設定</h4>

<p>バックログクォータはBrokerが特定の閾値に達したとき、ネームスペースの帯域幅/ストレージを制限するのに役立ちます。管理者はこの制限と制限に達したときに行う下記のアクションの内一つを設定できます。</p>

<ol>
  <li>
    <p>producer_request_hold: Brokerはproduceリクエストのペイロードをホールドし、永続化しないようになります</p>
  </li>
  <li>
    <p>producer_exception: Brokerは例外を発生させてクライアントとの接続を切断します</p>
  </li>
  <li>
    <p>consumer_backlog_eviction: Brokerはバックログメッセージの破棄を開始します</p>
  </li>
</ol>

<p>バックログクォータ制限はバックログクォータタイプ: destination_storageを定義することによって考慮されるようになります。</p>

<h6 id="cli-8">CLI</h6>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$ pulsar-admin namespaces set-backlog-quota --limit 10 --policy producer_request_hold test-property/cl1/ns1
</code></pre></div></div>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>N/A
</code></pre></div></div>

<h6 id="rest-11">REST</h6>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>POST /admin/namespaces/{property}/{cluster}/{namespace}/backlogQuota
</code></pre></div></div>

<h6 id="java-25">Java</h6>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">admin</span><span class="o">.</span><span class="na">namespaces</span><span class="o">().</span><span class="na">setBacklogQuota</span><span class="o">(</span><span class="n">namespace</span><span class="o">,</span> <span class="k">new</span> <span class="n">BacklogQuota</span><span class="o">(</span><span class="n">limit</span><span class="o">,</span> <span class="n">policy</span><span class="o">))</span>
</code></pre></div></div>

<h4 id="バックログクォータポリシーの取得">バックログクォータポリシーの取得</h4>

<p>指定したネームスペースのバックログクォータ設定を表示します。</p>

<h6 id="cli-9">CLI</h6>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$ pulsar-admin namespaces get-backlog-quotas test-property/cl1/ns1
</code></pre></div></div>

<div class="language-json highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">{</span><span class="w">
    </span><span class="s2">"destination_storage"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
        </span><span class="s2">"limit"</span><span class="p">:</span><span class="w"> </span><span class="mi">10</span><span class="p">,</span><span class="w">
        </span><span class="s2">"policy"</span><span class="p">:</span><span class="w"> </span><span class="s2">"producer_request_hold"</span><span class="w">
    </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">          
</span></code></pre></div></div>

<h6 id="rest-12">REST</h6>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>GET /admin/namespaces/{property}/{cluster}/{namespace}/backlogQuotaMap
</code></pre></div></div>

<h6 id="java-26">Java</h6>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">admin</span><span class="o">.</span><span class="na">namespaces</span><span class="o">().</span><span class="na">getBacklogQuotaMap</span><span class="o">(</span><span class="n">namespace</span><span class="o">)</span>
</code></pre></div></div>

<h4 id="バックログクォータポリシーの削除">バックログクォータポリシーの削除</h4>

<p>指定したネームスペースのバックログクォータポリシーを削除します。</p>

<h6 id="cli-10">CLI</h6>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$ pulsar-admin namespaces remove-backlog-quota test-property/cl1/ns1
</code></pre></div></div>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>N/A
</code></pre></div></div>

<h6 id="rest-13">REST</h6>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>DELETE /admin/namespaces/{property}/{cluster}/{namespace}/backlogQuota
</code></pre></div></div>

<h6 id="java-27">Java</h6>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">admin</span><span class="o">.</span><span class="na">namespaces</span><span class="o">().</span><span class="na">removeBacklogQuota</span><span class="o">(</span><span class="n">namespace</span><span class="o">,</span> <span class="n">backlogQuotaType</span><span class="o">)</span>
</code></pre></div></div>

<h4 id="永続性ポリシーの設定">永続性ポリシーの設定</h4>

<p>永続性ポリシーは指定したネームスペースにあるすべてのトピックの永続性レベルを設定できます。</p>

<ul>
  <li>
    <p>Bookkeeper-ack-quorum: 各エントリに対して書き込み成功のAckを待機するBookieの数（保証されるコピーの数）、デフォルト: 0</p>
  </li>
  <li>
    <p>Bookkeeper-ensemble: 一つのトピックに対して使用されるBookieの数、デフォルト: 0</p>
  </li>
  <li>
    <p>Bookkeeper-write-quorum: 各エントリに対して書き込みを行うBookieの数、デフォルト: 0</p>
  </li>
  <li>
    <p>Ml-mark-delete-max-rate: mark-delete操作のスロットル率 (0は無制限)、デフォルト: 0.0</p>
  </li>
</ul>

<h6 id="cli-11">CLI</h6>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$ pulsar-admin namespaces set-persistence --bookkeeper-ack-quorum 2 --bookkeeper-ensemble 3 --bookkeeper-write-quorum 2 --ml-mark-delete-max-rate 0 test-property/cl1/ns1
</code></pre></div></div>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>N/A
</code></pre></div></div>

<h6 id="rest-14">REST</h6>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>POST /admin/persistent/{property}/{cluster}/{namespace}/persistence
</code></pre></div></div>

<h6 id="java-28">Java</h6>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">admin</span><span class="o">.</span><span class="na">namespaces</span><span class="o">().</span><span class="na">setPersistence</span><span class="o">(</span><span class="n">namespace</span><span class="o">,</span><span class="k">new</span> <span class="n">PersistencePolicies</span><span class="o">(</span><span class="n">bookkeeperEnsemble</span><span class="o">,</span> <span class="n">bookkeeperWriteQuorum</span><span class="o">,</span><span class="n">bookkeeperAckQuorum</span><span class="o">,</span><span class="n">managedLedgerMaxMarkDeleteRate</span><span class="o">))</span>
</code></pre></div></div>

<h4 id="永続性ポリシーの取得">永続性ポリシーの取得</h4>

<p>指定したネームスペースの永続性ポリシーの設定を表示します。</p>

<h6 id="cli-12">CLI</h6>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$ pulsar-admin namespaces get-persistence test-property/cl1/ns1
</code></pre></div></div>

<div class="language-json highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">{</span><span class="w">
  </span><span class="s2">"bookkeeperEnsemble"</span><span class="p">:</span><span class="w"> </span><span class="mi">3</span><span class="p">,</span><span class="w">
  </span><span class="s2">"bookkeeperWriteQuorum"</span><span class="p">:</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span><span class="w">
  </span><span class="s2">"bookkeeperAckQuorum"</span><span class="p">:</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span><span class="w">
  </span><span class="s2">"managedLedgerMaxMarkDeleteRate"</span><span class="p">:</span><span class="w"> </span><span class="mi">0</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div></div>

<h6 id="rest-15">REST</h6>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>GET /admin/namespaces/{property}/{cluster}/{namespace}/persistence
</code></pre></div></div>

<h6 id="java-29">Java</h6>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">admin</span><span class="o">.</span><span class="na">namespaces</span><span class="o">().</span><span class="na">getPersistence</span><span class="o">(</span><span class="n">namespace</span><span class="o">)</span>
</code></pre></div></div>

<h4 id="ネームスペースバンドルのアンロード">ネームスペースバンドルのアンロード</h4>

<p>ネームスペースバンドルは同じネームスペースに属するトピックの仮想的なグループです。多数のバンドルによりBrokerの負荷が高まった場合、このコマンドを使って処理が重いバンドルをそのBrokerから取り外し、より負荷が小さい他のBrokerに扱わせることができます。ネームスペースバンドルは0x00000000と0xffffffffのように開始と終了のレンジによって定義されます。</p>

<h6 id="cli-13">CLI</h6>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$ pulsar-admin namespaces unload --bundle 0x00000000_0xffffffff test-property/pstg-gq1/ns1
</code></pre></div></div>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>N/A
</code></pre></div></div>

<h6 id="rest-16">REST</h6>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>PUT /admin/namespaces/{property}/{cluster}/{namespace}/unload
</code></pre></div></div>

<h6 id="java-30">Java</h6>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">admin</span><span class="o">.</span><span class="na">namespaces</span><span class="o">().</span><span class="na">unloadNamespaceBundle</span><span class="o">(</span><span class="n">namespace</span><span class="o">,</span> <span class="n">bundle</span><span class="o">)</span>
</code></pre></div></div>

<h4 id="メッセージttlの設定">メッセージTTLの設定</h4>

<p>メッセージの生存時間（秒）を設定します。</p>

<h6 id="cli-14">CLI</h6>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$ pulsar-admin namespaces set-message-ttl --messageTTL 100 test-property/cl1/ns1
</code></pre></div></div>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>N/A
</code></pre></div></div>

<h6 id="rest-17">REST</h6>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>POST /admin/namespaces/{property}/{cluster}/{namespace}/messageTTL
</code></pre></div></div>

<h6 id="java-31">Java</h6>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">admin</span><span class="o">.</span><span class="na">namespaces</span><span class="o">().</span><span class="na">setNamespaceMessageTTL</span><span class="o">(</span><span class="n">namespace</span><span class="o">,</span> <span class="n">messageTTL</span><span class="o">)</span>
</code></pre></div></div>

<h4 id="メッセージttlの取得">メッセージTTLの取得</h4>

<p>ネームスペースに対して設定されたメッセージTTLを取得します。</p>

<h6 id="cli-15">CLI</h6>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$ pulsar-admin namespaces get-message-ttl test-property/cl1/ns1
</code></pre></div></div>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>100
</code></pre></div></div>

<h6 id="rest-18">REST</h6>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>GET /admin/namespaces/{property}/{cluster}/{namespace}/messageTTL
</code></pre></div></div>

<h6 id="java-32">Java</h6>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">admin</span><span class="o">.</span><span class="na">namespaces</span><span class="o">().</span><span class="na">getNamespaceReplicationClusters</span><span class="o">(</span><span class="n">namespace</span><span class="o">)</span>
</code></pre></div></div>

<h4 id="バンドルの分割">バンドルの分割</h4>

<p>各ネームスペースのバンドルは複数のトピックを含み、各バンドルはただ一つのBrokerによって扱われます。バンドルがそれに含まれる複数のトピックの処理で重くなった場合、Brokerに対し負荷を発生させます。これを解決するため、管理者はこのコマンドを用いてバンドルを分割できます。</p>

<h6 id="cli-16">CLI</h6>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$ pulsar-admin namespaces split-bundle --bundle 0x00000000_0xffffffff test-property/cl1/ns1
</code></pre></div></div>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>N/A
</code></pre></div></div>

<h6 id="rest-19">REST</h6>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>PUT /admin/namespaces/{property}/{cluster}/{namespace}/{bundle}/split
</code></pre></div></div>

<h6 id="java-33">Java</h6>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">admin</span><span class="o">.</span><span class="na">namespaces</span><span class="o">().</span><span class="na">splitNamespaceBundle</span><span class="o">(</span><span class="n">namespace</span><span class="o">,</span> <span class="n">bundle</span><span class="o">)</span>
</code></pre></div></div>

<h4 id="バックログの削除">バックログの削除</h4>

<p>指定したネームスペースに属するすべてのトピックのすべてのメッセージバックログを削除します。特定のサブスクリプションのバックログのみを削除することも可能です。</p>

<h6 id="cli-17">CLI</h6>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$ pulsar-admin namespaces clear-backlog --sub my-subscription test-property/pstg-gq1/ns1
</code></pre></div></div>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>N/A
</code></pre></div></div>

<h6 id="rest-20">REST</h6>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>POST /admin/namespaces/{property}/{cluster}/{namespace}/clearBacklog
</code></pre></div></div>

<h6 id="java-34">Java</h6>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">admin</span><span class="o">.</span><span class="na">namespaces</span><span class="o">().</span><span class="na">clearNamespaceBacklogForSubscription</span><span class="o">(</span><span class="n">namespace</span><span class="o">,</span> <span class="n">subscription</span><span class="o">)</span>
</code></pre></div></div>

<h4 id="バンドルバックログの削除">バンドルバックログの削除</h4>

<p>特定のネームスペースバンドルに属するすべてのトピックのすべてのメッセージバックログを削除します。特定のサブスクリプションのバックログのみを削除することも可能です。</p>

<h6 id="cli-18">CLI</h6>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$ pulsar-admin namespaces clear-backlog  --bundle 0x00000000_0xffffffff  --sub my-subscription test-property/pstg-gq1/ns1
</code></pre></div></div>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>N/A
</code></pre></div></div>

<h6 id="rest-21">REST</h6>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>POST /admin/namespaces/{property}/{cluster}/{namespace}/{bundle}/clearBacklog
</code></pre></div></div>

<h6 id="java-35">Java</h6>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">admin</span><span class="o">.</span><span class="na">namespaces</span><span class="o">().</span><span class="na">clearNamespaceBundleBacklogForSubscription</span><span class="o">(</span><span class="n">namespace</span><span class="o">,</span> <span class="n">bundle</span><span class="o">,</span> <span class="n">subscription</span><span class="o">)</span>
</code></pre></div></div>

<h4 id="保存情報の設定">保存情報の設定</h4>

<p>各ネームスペースは複数のトピックを含み、各トピックの保存サイズ（ストレージサイズ）は特定の閾値を超えるべきではなく、特定の期間まで保持されるべきです。このコマンドを使って、指定したネームスペース内のトピックの保存サイズと時間を設定できます。</p>

<h6 id="cli-19">CLI</h6>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$ pulsar-admin set-retention --size 10 --time 100 test-property/cl1/ns1
</code></pre></div></div>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>N/A
</code></pre></div></div>

<h6 id="rest-22">REST</h6>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>POST /admin/namespaces/{property}/{cluster}/{namespace}/retention
</code></pre></div></div>

<h6 id="java-36">Java</h6>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">admin</span><span class="o">.</span><span class="na">namespaces</span><span class="o">().</span><span class="na">setRetention</span><span class="o">(</span><span class="n">namespace</span><span class="o">,</span> <span class="k">new</span> <span class="n">RetentionPolicies</span><span class="o">(</span><span class="n">retentionTimeInMin</span><span class="o">,</span> <span class="n">retentionSizeInMB</span><span class="o">))</span>
</code></pre></div></div>

<h4 id="保存情報の取得">保存情報の取得</h4>

<p>指定したネームスペースの保存情報を表示します。</p>

<h6 id="cli-20">CLI</h6>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$ pulsar-admin namespaces get-retention test-property/cl1/ns1
</code></pre></div></div>

<div class="language-json highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">{</span><span class="w">
    </span><span class="s2">"retentionTimeInMinutes"</span><span class="p">:</span><span class="w"> </span><span class="mi">10</span><span class="p">,</span><span class="w">
    </span><span class="s2">"retentionSizeInMB"</span><span class="p">:</span><span class="w"> </span><span class="mi">100</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div></div>

<h6 id="rest-23">REST</h6>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>GET /admin/namespaces/{property}/{cluster}/{namespace}/retention
</code></pre></div></div>

<h6 id="java-37">Java</h6>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">admin</span><span class="o">.</span><span class="na">namespaces</span><span class="o">().</span><span class="na">getRetention</span><span class="o">(</span><span class="n">namespace</span><span class="o">)</span>
</code></pre></div></div>

<h3 id="ネームスペース隔離">ネームスペース隔離</h3>

<p>作成中</p>

<h3 id="brokerからのアンロード">Brokerからのアンロード</h3>

<p>ネームスペース、もしくは<span class="popover-term" tabindex="0" title="ネームスペースバンドルとは？" data-placement="top" data-content="同じネームスペースに属するトピックの仮想グループです。ネームスペースバンドルは、0x00000000と0xffffffffのような2つの32ビットハッシュの間の範囲で定義されます。" data-toggle="popover" data-trigger="focus">ネームスペースバンドル</span>を現在担当しているPulsar <span class="popover-term" tabindex="0" title="Brokerとは？" data-placement="top" data-content="2つの異なるコンポーネントを実行するPulsarクラスタのステートレスなコンポーネントです。2つのコンポーネントとは管理操作とトピックルックアップのためのRESTインターフェースを提供するHTTPサーバと全てのメッセージの転送を処理するディスパッチャです。またPulsarクラスタは基本的に複数のBrokerから構成されます。" data-toggle="popover" data-trigger="focus">Broker</span>からアンロードできます。</p>

<h4 id="pulsar-admin-18">pulsar-admin</h4>

<p><a href="../../reference/CliTools#pulsar-admin-namespaces"><code class="highlighter-rouge">namespaces</code></a>コマンドの<a href="../../reference/CliTools#pulsar-admin-namespaces-unload"><code class="highlighter-rouge">unload</code></a>サブコマンドを使用します。</p>

<h5 id="例">例</h5>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>pulsar-admin namespaces unload my-prop/my-cluster/my-ns
</code></pre></div></div>

<h4 id="rest-api-15">REST API</h4>

<h4 id="java-38">Java</h4>

<h3 id="リソース割り当て">リソース割り当て</h3>

<h4 id="ネームスペースへのリソース割り当て">ネームスペースへのリソース割り当て</h4>

<p>指定されたネームスペースバンドルに対してリソース割り当て情報をセットします。</p>

<h6 id="cli-21">CLI</h6>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$ pulsar-admin resource-quotas set --bandwidthIn 10 --bandwidthOut 10 --bundle 0x00000000_0xffffffff --memory 10 --msgRateIn 10 --msgRateOut 10 --namespace test-property/cl1/ns1
</code></pre></div></div>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>N/A
</code></pre></div></div>

<h6 id="rest-24">REST</h6>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>POST /admin/resource-quotas/{property}/{cluster}/{namespace}/{bundle}
</code></pre></div></div>

<h6 id="java-39">Java</h6>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">admin</span><span class="o">.</span><span class="na">resourceQuotas</span><span class="o">().</span><span class="na">setNamespaceBundleResourceQuota</span><span class="o">(</span><span class="n">namespace</span><span class="o">,</span> <span class="n">bundle</span><span class="o">,</span> <span class="n">quota</span><span class="o">)</span>
</code></pre></div></div>

<h4 id="ネームスペースに対するリソース割り当て情報を取得">ネームスペースに対するリソース割り当て情報を取得</h4>

<p>設定されたリソース割り当て情報を表示します。</p>

<h6 id="cli-22">CLI</h6>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$ pulsar-admin resource-quotas get  --bundle 0x00000000_0xffffffff --namespace test-property/cl1/my-topic
</code></pre></div></div>

<div class="language-json highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">{</span><span class="w">
    </span><span class="s2">"msgRateIn"</span><span class="p">:</span><span class="w"> </span><span class="mf">80.40352101165782</span><span class="p">,</span><span class="w">
    </span><span class="s2">"msgRateOut"</span><span class="p">:</span><span class="w"> </span><span class="mf">132.58187392933146</span><span class="p">,</span><span class="w">
    </span><span class="s2">"bandwidthIn"</span><span class="p">:</span><span class="w"> </span><span class="mf">144273.8819600397</span><span class="p">,</span><span class="w">
    </span><span class="s2">"bandwidthOut"</span><span class="p">:</span><span class="w"> </span><span class="mf">234497.9190227951</span><span class="p">,</span><span class="w">
    </span><span class="s2">"memory"</span><span class="p">:</span><span class="w"> </span><span class="mf">199.91739142481595</span><span class="p">,</span><span class="w">
    </span><span class="s2">"dynamic"</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="w">
</span><span class="p">}</span><span class="w">          
</span></code></pre></div></div>

<h6 id="rest-25">REST</h6>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>GET /admin/resource-quotas/{property}/{cluster}/{namespace}/{bundle}
</code></pre></div></div>

<h6 id="java-40">Java</h6>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">admin</span><span class="o">.</span><span class="na">resourceQuotas</span><span class="o">().</span><span class="na">getNamespaceBundleResourceQuota</span><span class="o">(</span><span class="n">namespace</span><span class="o">,</span> <span class="n">bundle</span><span class="o">)</span>
</code></pre></div></div>

<h4 id="ネームスペースに対するリソース割り当てをリセット">ネームスペースに対するリソース割り当てをリセット</h4>

<p>設定されたリソース割り当てを元に戻し、デフォルトのリソース割り当て情報をセットします。</p>

<h6 id="cli-23">CLI</h6>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$ pulsar-admin resource-quotas reset-namespace-bundle-quota --bundle 0x00000000_0xffffffff --namespace test-property/cl1/my-topic
</code></pre></div></div>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>N/A
</code></pre></div></div>

<h6 id="rest-26">REST</h6>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>DELETE /admin/resource-quotas/{property}/{cluster}/{namespace}/{bundle}
</code></pre></div></div>

<h6 id="java-41">Java</h6>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">admin</span><span class="o">.</span><span class="na">resourceQuotas</span><span class="o">().</span><span class="na">resetNamespaceBundleResourceQuota</span><span class="o">(</span><span class="n">namespace</span><span class="o">,</span> <span class="n">bundle</span><span class="o">)</span>
</code></pre></div></div>

<h2 id="パーシステントトピックの管理">パーシステントトピックの管理</h2>

<p><code class="highlighter-rouge">persistent</code>はメッセージを送受信するための論理的なエンドポイントであるトピックにアクセスするのに役立ちます。Producerはトピックに対してメッセージを発行し、Consumerはそのトピックを購読して発行されたメッセージをconsumeします。</p>

<p>以下の解説におけるパーシステントトピックのフォーマットは次のようになります:</p>

<!--

    Licensed to the Apache Software Foundation (ASF) under one
    or more contributor license agreements.  See the NOTICE file
    distributed with this work for additional information
    regarding copyright ownership.  The ASF licenses this file
    to you under the Apache License, Version 2.0 (the
    "License"); you may not use this file except in compliance
    with the License.  You may obtain a copy of the License at

      http://www.apache.org/licenses/LICENSE-2.0

    Unless required by applicable law or agreed to in writing,
    software distributed under the License is distributed on an
    "AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
    KIND, either express or implied.  See the License for the
    specific language governing permissions and limitations
    under the License.

-->
<section class="topic">
  persistent://<span class="cluster">cluster</span>/<span class="namespace">namespace</span>/<span class="t">topic</span>
</section>

<!--

    Licensed to the Apache Software Foundation (ASF) under one
    or more contributor license agreements.  See the NOTICE file
    distributed with this work for additional information
    regarding copyright ownership.  The ASF licenses this file
    to you under the Apache License, Version 2.0 (the
    "License"); you may not use this file except in compliance
    with the License.  You may obtain a copy of the License at

      http://www.apache.org/licenses/LICENSE-2.0

    Unless required by applicable law or agreed to in writing,
    software distributed under the License is distributed on an
    "AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
    KIND, either express or implied.  See the License for the
    specific language governing permissions and limitations
    under the License.

-->

<p><code class="highlighter-rouge">persistent</code>は、メッセージを発行してconsumeするための論理的なエンドポイントであるトピックにアクセスするのに役立ちます。Producerはトピックにメッセージを発行し、Consumerはトピックを購読してトピックに発行されたメッセージをconsumeします。</p>

<p>以下のすべての手順とコマンドで、トピック名の構造は次のとおりです</p>

<!--

    Licensed to the Apache Software Foundation (ASF) under one
    or more contributor license agreements.  See the NOTICE file
    distributed with this work for additional information
    regarding copyright ownership.  The ASF licenses this file
    to you under the Apache License, Version 2.0 (the
    "License"); you may not use this file except in compliance
    with the License.  You may obtain a copy of the License at

      http://www.apache.org/licenses/LICENSE-2.0

    Unless required by applicable law or agreed to in writing,
    software distributed under the License is distributed on an
    "AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
    KIND, either express or implied.  See the License for the
    specific language governing permissions and limitations
    under the License.

-->
<section class="topic">
  persistent://<span class="cluster">cluster</span>/<span class="namespace">namespace</span>/<span class="t">topic</span>
</section>

<h3 id="トピックのリストの取得">トピックのリストの取得</h3>

<p>指定されたネームスペースの下に存在するパーシステントトピックのリストを提供します。</p>

<h4 id="pulsar-admin-19">pulsar-admin</h4>

<p><a href="../../reference/CliTools#list"><code class="highlighter-rouge">list</code></a>コマンドを使ってトピックのリストを取得できます。</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>pulsar-admin persistent list <span class="se">\</span>
  my-property/my-cluster/my-namespace <span class="se">\</span>
  my-topic
</code></pre></div></div>

<h4 id="rest-api-16">REST API</h4>

<div class="highlighter-rouge endpoint"><pre class="highlight"><code class="method get">GET</code><code class="url">/admin/persistent/<span class="endpoint">:property</span>/<span class="endpoint">:cluster</span>/<span class="endpoint">:namespace</span></code></pre></div>

<p><a href="../../reference/RestApi#/admin/persistent/:property/:cluster/:namespace">詳細</a></p>

<h4 id="java-42">Java</h4>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">String</span> <span class="n">namespace</span> <span class="o">=</span> <span class="s">"my-property/my-cluster-my-namespace"</span><span class="o">;</span>
<span class="n">admin</span><span class="o">.</span><span class="na">persistentTopics</span><span class="o">().</span><span class="na">getList</span><span class="o">(</span><span class="n">namespace</span><span class="o">);</span>
</code></pre></div></div>

<h3 id="パーミッションの付与-1">パーミッションの付与</h3>

<p>特定のトピックに対して特定のアクションを実行するために、クライアントロールに対するパーミッションを付与します。</p>

<h4 id="pulsar-admin-20">pulsar-admin</h4>

<p><a href="../../reference/CliTools#grant-permission"><code class="highlighter-rouge">grant-permission</code></a>コマンドを使ってパーミッションを付与できます。</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>pulsar-admin persistent grant-permission <span class="se">\</span>
  <span class="nt">--actions</span> produce,consume <span class="nt">--role</span> application1 <span class="se">\</span>
  persistent://test-property/cl1/ns1/tp1 <span class="se">\</span>

</code></pre></div></div>

<h4 id="rest-api-17">REST API</h4>

<div class="highlighter-rouge endpoint"><pre class="highlight"><code class="method post">POST</code><code class="url">/admin/namespaces/<span class="endpoint">:property</span>/<span class="endpoint">:cluster</span>/<span class="endpoint">:namespace</span>/permissions/<span class="endpoint">:role</span></code></pre></div>

<p><a href="../../reference/RestApi#/admin/namespaces/:property/:cluster/:namespace/permissions/:role">詳細</a></p>

<h4 id="java-43">Java</h4>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">String</span> <span class="n">destination</span> <span class="o">=</span> <span class="s">"persistent://my-property/my-cluster-my-namespace/my-topic"</span><span class="o">;</span>
<span class="n">String</span> <span class="n">role</span> <span class="o">=</span> <span class="s">"test-role"</span><span class="o">;</span>
<span class="n">Set</span><span class="o">&lt;</span><span class="n">AuthAction</span><span class="o">&gt;</span> <span class="n">actions</span>  <span class="o">=</span> <span class="n">Sets</span><span class="o">.</span><span class="na">newHashSet</span><span class="o">(</span><span class="n">AuthAction</span><span class="o">.</span><span class="na">produce</span><span class="o">,</span> <span class="n">AuthAction</span><span class="o">.</span><span class="na">consume</span><span class="o">);</span>
<span class="n">admin</span><span class="o">.</span><span class="na">persistentTopics</span><span class="o">().</span><span class="na">grantPermission</span><span class="o">(</span><span class="n">destination</span><span class="o">,</span> <span class="n">role</span><span class="o">,</span> <span class="n">actions</span><span class="o">);</span>
</code></pre></div></div>

<h3 id="パーミッションの取得-1">パーミッションの取得</h3>

<p><a href="../../reference/CliTools#permissions"><code class="highlighter-rouge">permissions</code></a>コマンドを使ってパーミッションを取得できます。</p>

<h4 id="pulsar-admin-21">pulsar-admin</h4>

<p>TODO: admin</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>pulsar-admin persistent permissions <span class="se">\</span>
  persistent://test-property/cl1/ns1/tp1 <span class="se">\</span>

<span class="o">{</span>
    <span class="s2">"application1"</span>: <span class="o">[</span>
        <span class="s2">"consume"</span>,
        <span class="s2">"produce"</span>
    <span class="o">]</span>
<span class="o">}</span>
</code></pre></div></div>

<h4 id="rest-api-18">REST API</h4>

<div class="highlighter-rouge endpoint"><pre class="highlight"><code class="method get">GET</code><code class="url">/admin/namespaces/<span class="endpoint">:property</span>/<span class="endpoint">:cluster</span>/<span class="endpoint">:namespace</span>/permissions</code></pre></div>

<p><a href="../../reference/RestApi#/admin/namespaces/:property/:cluster/:namespace/permissions">詳細</a></p>

<h4 id="java-44">Java</h4>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">String</span> <span class="n">destination</span> <span class="o">=</span> <span class="s">"persistent://my-property/my-cluster-my-namespace/my-topic"</span><span class="o">;</span>
<span class="n">admin</span><span class="o">.</span><span class="na">persistentTopics</span><span class="o">().</span><span class="na">getPermissions</span><span class="o">(</span><span class="n">destination</span><span class="o">);</span>
</code></pre></div></div>

<h3 id="パーミッションの剥奪-1">パーミッションの剥奪</h3>

<p>クライアントロールに付与されているパーミッションを剥奪します。</p>

<h4 id="pulsar-admin-22">pulsar-admin</h4>

<p><a href="../../reference/CliTools#revoke-permission"><code class="highlighter-rouge">revoke-permission</code></a>コマンドを使ってパーミッションを剥奪できます。</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>pulsar-admin persistent revoke-permission <span class="se">\</span>
  <span class="nt">--role</span> application1 <span class="se">\</span>
  persistent://test-property/cl1/ns1/tp1 <span class="se">\</span>

<span class="o">{</span>
    <span class="s2">"application1"</span>: <span class="o">[</span>
        <span class="s2">"consume"</span>,
        <span class="s2">"produce"</span>
    <span class="o">]</span>
<span class="o">}</span>
</code></pre></div></div>

<h4 id="rest-api-19">REST API</h4>

<div class="highlighter-rouge endpoint"><pre class="highlight"><code class="method delete">DELETE</code><code class="url">/admin/namespaces/<span class="endpoint">:property</span>/<span class="endpoint">:cluster</span>/<span class="endpoint">:namespace</span>/permissions/<span class="endpoint">:role</span></code></pre></div>

<p><a href="../../reference/RestApi#/admin/namespaces/:property/:cluster/:namespace/permissions/:role">詳細</a></p>

<h4 id="java-45">Java</h4>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">String</span> <span class="n">destination</span> <span class="o">=</span> <span class="s">"persistent://my-property/my-cluster-my-namespace/my-topic"</span><span class="o">;</span>
<span class="n">String</span> <span class="n">role</span> <span class="o">=</span> <span class="s">"test-role"</span><span class="o">;</span>
<span class="n">admin</span><span class="o">.</span><span class="na">persistentTopics</span><span class="o">().</span><span class="na">revokePermissions</span><span class="o">(</span><span class="n">destination</span><span class="o">,</span> <span class="n">role</span><span class="o">);</span>
</code></pre></div></div>

<h3 id="統計情報の取得">統計情報の取得</h3>

<p>パーティションドではないトピックの現在の統計情報を表示します。</p>

<ul>
  <li>
    <p><strong>msgRateIn</strong>: 全てのローカルのPublisherとレプリケーション用のPublisherの発行レートの合計で、1秒あたりのメッセージ数です。</p>
  </li>
  <li>
    <p><strong>msgThroughputIn</strong>: 上記と同様ですが、1秒あたりのバイト数です。</p>
  </li>
  <li>
    <p><strong>msgRateOut</strong>: 全てのローカルのConsumerとレプリケーション用のConsumerへの配送レートの合計で、1秒あたりのメッセージ数です。</p>
  </li>
  <li>
    <p><strong>msgThroughputOut</strong>: 上記と同様ですが、1秒あたりのバイト数です。</p>
  </li>
  <li>
    <p><strong>averageMsgSize</strong>: 直近のインターバル内で発行されたメッセージの平均バイトサイズです。</p>
  </li>
  <li>
    <p><strong>storageSize</strong>: Ledgerストレージのサイズの合計です。</p>
  </li>
  <li>
    <p><strong>publishers</strong>: トピック内の全てのローカルPublisherの一覧です。0または何千もの可能性があります。</p>
  </li>
  <li>
    <p><strong>averageMsgSize</strong>: 直近のインターバル内でこのPublisherからのメッセージの平均バイトサイズです。</p>
  </li>
  <li>
    <p><strong>producerId</strong>: このトピック上での、このProducerの内部的な識別子です。</p>
  </li>
  <li>
    <p><strong>producerName</strong>: クライアントライブラリによって生成されたこのProducerの内部的な識別子です。</p>
  </li>
  <li>
    <p><strong>address</strong>: このProducerの接続用のIPアドレスと送信元ポートです。</p>
  </li>
  <li>
    <p><strong>connectedSince</strong>: このProducerが作成または最後に再接続したタイムスタンプです。</p>
  </li>
  <li>
    <p><strong>subscriptions</strong>: トピックに対してのローカルの全サブスクリプションリストです。</p>
  </li>
  <li>
    <p><strong>my-subscription</strong>: このサブスクリプションの名前です (クライアントが定義します) 。</p>
  </li>
  <li>
    <p><strong>msgBacklog</strong>: このサブスクリプションのバックログにあるメッセージの数です。</p>
  </li>
  <li>
    <p><strong>type</strong>: このサブスクリプションのタイプです。</p>
  </li>
  <li>
    <p><strong>msgRateExpired</strong>: TTLのため、サブスクリプションに配信されず破棄されているメッセージのレートです。</p>
  </li>
  <li>
    <p><strong>consumers</strong>: このサブスクリプションに接続しているConsumerリストです。</p>
  </li>
  <li>
    <p><strong>consumerName</strong>: クライアントライブラリによって生成されたこのConsumerの内部的な識別子です。</p>
  </li>
  <li>
    <p><strong>availablePermits</strong>: このConsumerがクライアントライブラリのlistenキューに格納できるメッセージ数です。0はクライアントライブラリのキューがいっぱいであり、receive()はコールされないことを意味します。0でない場合には、このConsumerはメッセージを配送される準備ができています。</p>
  </li>
  <li>
    <p><strong>replication</strong>: このセクションは、トピックのクラスタ間でのレプリケーションの統計情報を示します。</p>
  </li>
  <li>
    <p><strong>replicationBacklog</strong>: メッセージの送信レプリケーションのバックログです。</p>
  </li>
  <li>
    <p><strong>connected</strong>: 送信レプリケータが接続されているかどうかです。</p>
  </li>
  <li>
    <p><strong>replicationDelayInSeconds</strong>: 接続されている場合、一番古いメッセージが送信されずに待機している時間です。</p>
  </li>
  <li>
    <p><strong>inboundConnection</strong>: このBrokerに対しての、リモートクラスタのPublisher接続におけるそのBrokerのIPとポートです。</p>
  </li>
  <li>
    <p><strong>inboundConnectedSince</strong>: リモートクラスタにメッセージを発行するために使われているTCP接続です。もし接続しているローカルのPublisherがいない場合には、この接続は数分後に自動的に閉じられます。</p>
  </li>
</ul>

<div class="language-json highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">{</span><span class="w">
  </span><span class="s2">"msgRateIn"</span><span class="p">:</span><span class="w"> </span><span class="mf">4641.528542257553</span><span class="p">,</span><span class="w">
  </span><span class="s2">"msgThroughputIn"</span><span class="p">:</span><span class="w"> </span><span class="mf">44663039.74947473</span><span class="p">,</span><span class="w">
  </span><span class="s2">"msgRateOut"</span><span class="p">:</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w">
  </span><span class="s2">"msgThroughputOut"</span><span class="p">:</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w">
  </span><span class="s2">"averageMsgSize"</span><span class="p">:</span><span class="w"> </span><span class="mf">1232439.816728665</span><span class="p">,</span><span class="w">
  </span><span class="s2">"storageSize"</span><span class="p">:</span><span class="w"> </span><span class="mi">135532389160</span><span class="p">,</span><span class="w">
  </span><span class="s2">"publishers"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
    </span><span class="p">{</span><span class="w">
      </span><span class="s2">"msgRateIn"</span><span class="p">:</span><span class="w"> </span><span class="mf">57.855383881403576</span><span class="p">,</span><span class="w">
      </span><span class="s2">"msgThroughputIn"</span><span class="p">:</span><span class="w"> </span><span class="mf">558994.7078932219</span><span class="p">,</span><span class="w">
      </span><span class="s2">"averageMsgSize"</span><span class="p">:</span><span class="w"> </span><span class="mi">613135</span><span class="p">,</span><span class="w">
      </span><span class="s2">"producerId"</span><span class="p">:</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w">
      </span><span class="s2">"producerName"</span><span class="p">:</span><span class="w"> </span><span class="kc">null</span><span class="p">,</span><span class="w">
      </span><span class="s2">"address"</span><span class="p">:</span><span class="w"> </span><span class="kc">null</span><span class="p">,</span><span class="w">
      </span><span class="s2">"connectedSince"</span><span class="p">:</span><span class="w"> </span><span class="kc">null</span><span class="w">
    </span><span class="p">}</span><span class="w">
  </span><span class="p">],</span><span class="w">
  </span><span class="s2">"subscriptions"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="s2">"my-topic_subscription"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
      </span><span class="s2">"msgRateOut"</span><span class="p">:</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w">
      </span><span class="s2">"msgThroughputOut"</span><span class="p">:</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w">
      </span><span class="s2">"msgBacklog"</span><span class="p">:</span><span class="w"> </span><span class="mi">116632</span><span class="p">,</span><span class="w">
      </span><span class="s2">"type"</span><span class="p">:</span><span class="w"> </span><span class="kc">null</span><span class="p">,</span><span class="w">
      </span><span class="s2">"msgRateExpired"</span><span class="p">:</span><span class="w"> </span><span class="mf">36.98245516804671</span><span class="p">,</span><span class="w">
      </span><span class="s2">"consumers"</span><span class="p">:</span><span class="w"> </span><span class="p">[]</span><span class="w">
    </span><span class="p">}</span><span class="w">
  </span><span class="p">},</span><span class="w">
  </span><span class="s2">"replication"</span><span class="p">:</span><span class="w"> </span><span class="p">{}</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div></div>

<h4 id="pulsar-admin-23">pulsar-admin</h4>

<p><a href="../../reference/CliTools#stats"><code class="highlighter-rouge">stats</code></a>コマンドを使ってトピックの統計情報を取得できます。</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>pulsar-admin persistent stats <span class="se">\</span>
  persistent://test-property/cl1/ns1/tp1 <span class="se">\</span>
</code></pre></div></div>

<h4 id="rest-api-20">REST API</h4>

<div class="highlighter-rouge endpoint"><pre class="highlight"><code class="method get">GET</code><code class="url">/admin/persistent/<span class="endpoint">:property</span>/<span class="endpoint">:cluster</span>/<span class="endpoint">:namespace</span>/<span class="endpoint">:destination</span>/stats</code></pre></div>

<p><a href="../../reference/RestApi#/admin/persistent/:property/:cluster/:namespace/:destination/stats">詳細</a></p>

<h4 id="java-46">Java</h4>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">String</span> <span class="n">destination</span> <span class="o">=</span> <span class="s">"persistent://my-property/my-cluster-my-namespace/my-topic"</span><span class="o">;</span>
<span class="n">admin</span><span class="o">.</span><span class="na">persistentTopics</span><span class="o">().</span><span class="na">getStats</span><span class="o">(</span><span class="n">destination</span><span class="o">);</span>
</code></pre></div></div>

<h3 id="詳細な統計情報の取得">詳細な統計情報の取得</h3>

<p>トピックの詳細な統計情報を表示します。</p>

<ul>
  <li>
    <p><strong>entriesAddedCounter</strong>: Brokerがこのトピックを読み込んだ後に発行されたメッセージです。</p>
  </li>
  <li>
    <p><strong>numberOfEntries</strong>: トラックされているメッセージの総数です。</p>
  </li>
  <li>
    <p><strong>totalSize</strong>: 全てのメッセージの合計ストレージ容量 (バイト) です。</p>
  </li>
  <li>
    <p><strong>currentLedgerEntries</strong>: 現在書き込み用に開いているLedgerに書き込まれたメッセージの数です。</p>
  </li>
  <li>
    <p><strong>currentLedgerSize</strong>: 現在書き込み用に開いているLedgerに書き込まれたメッセージのサイズ (バイト) です。</p>
  </li>
  <li>
    <p><strong>lastLedgerCreatedTimestamp</strong>: 最後のLedgerが作成された時間です。</p>
  </li>
  <li>
    <p><strong>lastLedgerCreationFailureTimestamp</strong>: 最後のLedgerが破損した時間です。</p>
  </li>
  <li>
    <p><strong>waitingCursorsCount</strong>: “捕捉”され、新しいメッセージが発行されるのを待つカーソルの数です。</p>
  </li>
  <li>
    <p><strong>pendingAddEntriesCount</strong>: 完了を待っている書き込みリクエストを持つメッセージの数です。</p>
  </li>
  <li>
    <p><strong>lastConfirmedEntry</strong>: 書き込みが完了した最新のメッセージのLedgerID:エントリIDです。エントリIDが-1の場合、Ledgerはオープンしたばかりであるか、現在オープンされているものの書き込みされていません。</p>
  </li>
  <li>
    <p><strong>state</strong>: 書き込みのためのLedgerの状態です。LedgerOpenedは発行されたメッセージを保存するためのLedgerがオープンされていることを意味します。</p>
  </li>
  <li>
    <p><strong>ledgers</strong>: メッセージを保持しているこのトピックの全てのLedgerの順序付きリストです。</p>
  </li>
  <li>
    <p><strong>cursors</strong>: このトピックの全てのカーソルのリストです。トピックの統計情報に表示されたサブスクリプションごとに1つずつ表示されます。</p>
  </li>
  <li>
    <p><strong>markDeletePosition</strong>: Ackの位置です。つまり、Subscriberが受信のAckを返した最後のメッセージです。</p>
  </li>
  <li>
    <p><strong>readPosition</strong>: メッセージを読むためのSubscriberの最新の位置です。</p>
  </li>
  <li>
    <p><strong>waitingReadOp</strong>: サブスクリプションがこのトピックに発行された最新のメッセージを受信し、新しいメッセージが発行されるのを待っている場合は、これが<code class="highlighter-rouge">true</code>となります。</p>
  </li>
  <li>
    <p><strong>pendingReadOps</strong>: BookKeeperに対して処理中の未解決の読み込みリクエストの数です。</p>
  </li>
  <li>
    <p><strong>messagesConsumedCounter</strong>: このBrokerがこのトピックをロードしてからこのカーソルがAckしたメッセージの数です。</p>
  </li>
  <li>
    <p><strong>cursorLedger</strong>: 現在のmarkDeletePositionを永続的に保存するために使用されるLedgerです。</p>
  </li>
  <li>
    <p><strong>cursorLedgerLastEntry</strong>: 現在のmarkDeletePositionを永続的に保存するために使用された最後のエントリIDです。</p>
  </li>
  <li>
    <p><strong>individuallyDeletedMessages</strong>: Ackが順不同で返されている場合、markDeletePositionと読み取り位置の間でAckを返されたメッセージの範囲を表示します。</p>
  </li>
  <li>
    <p><strong>lastLedgerSwitchTimestamp</strong>: カーソルLedgerがロールオーバーされた最後の時間です。</p>
  </li>
  <li>
    <p><strong>state</strong>: カーソルLedgerの状態です。<code class="highlighter-rouge">Open</code>はmarkDeletePositionの更新を保存するためのLedgerを持つことを意味します。</p>
  </li>
</ul>

<div class="language-json highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">{</span><span class="w">
    </span><span class="s2">"entriesAddedCounter"</span><span class="p">:</span><span class="w"> </span><span class="mi">20449518</span><span class="p">,</span><span class="w">
    </span><span class="s2">"numberOfEntries"</span><span class="p">:</span><span class="w"> </span><span class="mi">3233</span><span class="p">,</span><span class="w">
    </span><span class="s2">"totalSize"</span><span class="p">:</span><span class="w"> </span><span class="mi">331482</span><span class="p">,</span><span class="w">
    </span><span class="s2">"currentLedgerEntries"</span><span class="p">:</span><span class="w"> </span><span class="mi">3233</span><span class="p">,</span><span class="w">
    </span><span class="s2">"currentLedgerSize"</span><span class="p">:</span><span class="w"> </span><span class="mi">331482</span><span class="p">,</span><span class="w">
    </span><span class="s2">"lastLedgerCreatedTimestamp"</span><span class="p">:</span><span class="w"> </span><span class="s2">"2016-06-29 03:00:23.825"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"lastLedgerCreationFailureTimestamp"</span><span class="p">:</span><span class="w"> </span><span class="kc">null</span><span class="p">,</span><span class="w">
    </span><span class="s2">"waitingCursorsCount"</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w">
    </span><span class="s2">"pendingAddEntriesCount"</span><span class="p">:</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w">
    </span><span class="s2">"lastConfirmedEntry"</span><span class="p">:</span><span class="w"> </span><span class="s2">"324711539:3232"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"state"</span><span class="p">:</span><span class="w"> </span><span class="s2">"LedgerOpened"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"ledgers"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
        </span><span class="p">{</span><span class="w">
            </span><span class="s2">"ledgerId"</span><span class="p">:</span><span class="w"> </span><span class="mi">324711539</span><span class="p">,</span><span class="w">
            </span><span class="s2">"entries"</span><span class="p">:</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w">
            </span><span class="s2">"size"</span><span class="p">:</span><span class="w"> </span><span class="mi">0</span><span class="w">
        </span><span class="p">}</span><span class="w">
    </span><span class="p">],</span><span class="w">
    </span><span class="s2">"cursors"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
        </span><span class="s2">"my-subscription"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
            </span><span class="s2">"markDeletePosition"</span><span class="p">:</span><span class="w"> </span><span class="s2">"324711539:3133"</span><span class="p">,</span><span class="w">
            </span><span class="s2">"readPosition"</span><span class="p">:</span><span class="w"> </span><span class="s2">"324711539:3233"</span><span class="p">,</span><span class="w">
            </span><span class="s2">"waitingReadOp"</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span><span class="w">
            </span><span class="s2">"pendingReadOps"</span><span class="p">:</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w">
            </span><span class="s2">"messagesConsumedCounter"</span><span class="p">:</span><span class="w"> </span><span class="mi">20449501</span><span class="p">,</span><span class="w">
            </span><span class="s2">"cursorLedger"</span><span class="p">:</span><span class="w"> </span><span class="mi">324702104</span><span class="p">,</span><span class="w">
            </span><span class="s2">"cursorLedgerLastEntry"</span><span class="p">:</span><span class="w"> </span><span class="mi">21</span><span class="p">,</span><span class="w">
            </span><span class="s2">"individuallyDeletedMessages"</span><span class="p">:</span><span class="w"> </span><span class="s2">"[(324711539:3134‥324711539:3136], (324711539:3137‥324711539:3140], ]"</span><span class="p">,</span><span class="w">
            </span><span class="s2">"lastLedgerSwitchTimestamp"</span><span class="p">:</span><span class="w"> </span><span class="s2">"2016-06-29 01:30:19.313"</span><span class="p">,</span><span class="w">
            </span><span class="s2">"state"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Open"</span><span class="w">
        </span><span class="p">}</span><span class="w">
    </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div></div>

<h4 id="pulsar-admin-24">pulsar-admin</h4>

<p><a href="../../reference/CliTools#stats-internal"><code class="highlighter-rouge">stats-internal</code></a>コマンドを使って、トピックの詳細な統計情報が取得できます。</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>pulsar-admin persistent stats-internal <span class="se">\</span>
  persistent://test-property/cl1/ns1/tp1 <span class="se">\</span>
</code></pre></div></div>

<h4 id="rest-api-21">REST API</h4>

<div class="highlighter-rouge endpoint"><pre class="highlight"><code class="method get">GET</code><code class="url">/admin/persistent/<span class="endpoint">:property</span>/<span class="endpoint">:cluster</span>/<span class="endpoint">:namespace</span>/<span class="endpoint">:destination</span>/internalStats</code></pre></div>

<p><a href="../../reference/RestApi#/admin/persistent/:property/:cluster/:namespace/:destination/internalStats">詳細</a></p>

<h4 id="java-47">Java</h4>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">String</span> <span class="n">destination</span> <span class="o">=</span> <span class="s">"persistent://my-property/my-cluster-my-namespace/my-topic"</span><span class="o">;</span>
<span class="n">admin</span><span class="o">.</span><span class="na">persistentTopics</span><span class="o">().</span><span class="na">getInternalStats</span><span class="o">(</span><span class="n">destination</span><span class="o">);</span>
</code></pre></div></div>

<h3 id="メッセージの閲覧">メッセージの閲覧</h3>

<p>特定のトピックの特定のサブスクリプションについてN個のメッセージを表示します。</p>

<h4 id="pulsar-admin-25">pulsar-admin</h4>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>pulsar-admin persistent peek-messages <span class="se">\</span>
  <span class="nt">--count</span> 10 <span class="nt">--subscription</span> my-subscription <span class="se">\</span>
  persistent://test-property/cl1/ns1/tp1 <span class="se">\</span>

Message ID: 315674752:0  
Properties:  <span class="o">{</span>  <span class="s2">"X-Pulsar-publish-time"</span> : <span class="s2">"2015-07-13 17:40:28.451"</span>  <span class="o">}</span>
msg-payload
</code></pre></div></div>

<h4 id="rest-api-22">REST API</h4>

<div class="highlighter-rouge endpoint"><pre class="highlight"><code class="method get">GET</code><code class="url">/admin/persistent/<span class="endpoint">:property</span>/<span class="endpoint">:cluster</span>/<span class="endpoint">:namespace</span>/<span class="endpoint">:destination</span>/subscription/<span class="endpoint">:subName</span>/position/<span class="endpoint">:messagePosition</span></code></pre></div>

<p><a href="../../reference/RestApi#/admin/persistent/:property/:cluster/:namespace/:destination/subscription/:subName/position/:messagePosition">詳細</a></p>

<h4 id="java-48">Java</h4>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">String</span> <span class="n">destination</span> <span class="o">=</span> <span class="s">"persistent://my-property/my-cluster-my-namespace/my-topic"</span><span class="o">;</span>
<span class="n">String</span> <span class="n">subName</span> <span class="o">=</span> <span class="s">"my-subscription"</span><span class="o">;</span>
<span class="kt">int</span> <span class="n">numMessages</span> <span class="o">=</span> <span class="mi">1</span><span class="o">;</span>
<span class="n">admin</span><span class="o">.</span><span class="na">persistentTopics</span><span class="o">().</span><span class="na">peekMessages</span><span class="o">(</span><span class="n">destination</span><span class="o">,</span> <span class="n">subName</span><span class="o">,</span> <span class="n">numMessages</span><span class="o">);</span>
</code></pre></div></div>

<h3 id="メッセージのスキップ">メッセージのスキップ</h3>

<p>特定のトピックの特定のサブスクリプションに対してN個のメッセージをスキップします。</p>

<h4 id="pulsar-admin-26">pulsar-admin</h4>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>pulsar-admin persistent skip <span class="se">\</span>
  <span class="nt">--count</span> 10 <span class="nt">--subscription</span> my-subscription <span class="se">\</span>
  persistent://test-property/cl1/ns1/tp1 <span class="se">\</span>
</code></pre></div></div>

<h4 id="rest-api-23">REST API</h4>

<div class="highlighter-rouge endpoint"><pre class="highlight"><code class="method post">POST</code><code class="url">/admin/persistent/<span class="endpoint">:property</span>/<span class="endpoint">:cluster</span>/<span class="endpoint">:namespace</span>/<span class="endpoint">:destination</span>/subscription/<span class="endpoint">:subName</span>/skip/<span class="endpoint">:numMessages</span></code></pre></div>

<p><a href="../../reference/RestApi#/admin/persistent/:property/:cluster/:namespace/:destination/subscription/:subName/skip/:numMessages">詳細</a></p>

<h4 id="java-49">Java</h4>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">String</span> <span class="n">destination</span> <span class="o">=</span> <span class="s">"persistent://my-property/my-cluster-my-namespace/my-topic"</span><span class="o">;</span>
<span class="n">String</span> <span class="n">subName</span> <span class="o">=</span> <span class="s">"my-subscription"</span><span class="o">;</span>
<span class="kt">int</span> <span class="n">numMessages</span> <span class="o">=</span> <span class="mi">1</span><span class="o">;</span>
<span class="n">admin</span><span class="o">.</span><span class="na">persistentTopics</span><span class="o">().</span><span class="na">skipMessages</span><span class="o">(</span><span class="n">destination</span><span class="o">,</span> <span class="n">subName</span><span class="o">,</span> <span class="n">numMessages</span><span class="o">);</span>
</code></pre></div></div>

<h3 id="全てのメッセージのスキップ">全てのメッセージのスキップ</h3>

<p>特定のトピックの特定のサブスクリプションのすべての古いメッセージをスキップします。</p>

<h4 id="pulsar-admin-27">pulsar-admin</h4>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>pulsar-admin persistent skip-all <span class="se">\</span>
  <span class="nt">--subscription</span> my-subscription <span class="se">\</span>
  persistent://test-property/cl1/ns1/tp1 <span class="se">\</span>
</code></pre></div></div>

<h4 id="rest-api-24">REST API</h4>

<div class="highlighter-rouge endpoint"><pre class="highlight"><code class="method post">POST</code><code class="url">/admin/persistent/<span class="endpoint">:property</span>/<span class="endpoint">:cluster</span>/<span class="endpoint">:namespace</span>/<span class="endpoint">:destination</span>/subscription/<span class="endpoint">:subName</span>/skip_all</code></pre></div>

<p><a href="../../reference/RestApi#/admin/persistent/:property/:cluster/:namespace/:destination/subscription/:subName/skip_all">詳細</a></p>

<h4 id="java-50">Java</h4>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">String</span> <span class="n">destination</span> <span class="o">=</span> <span class="s">"persistent://my-property/my-cluster-my-namespace/my-topic"</span><span class="o">;</span>
<span class="n">String</span> <span class="n">subName</span> <span class="o">=</span> <span class="s">"my-subscription"</span><span class="o">;</span>
<span class="n">admin</span><span class="o">.</span><span class="na">persistentTopics</span><span class="o">().</span><span class="na">skipAllMessages</span><span class="o">(</span><span class="n">destination</span><span class="o">,</span> <span class="n">subName</span><span class="o">);</span>
</code></pre></div></div>

<h3 id="カーソルのリセット">カーソルのリセット</h3>

<p>サブスクリプションのカーソル位置をX分前に記録された位置に戻します。これは本質的にはX分前のカーソルの時間と位置を計算し、その位置でリセットします。</p>

<h4 id="pulsar-admin-28">pulsar-admin</h4>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>pulsar-admin persistent reset-cursor <span class="se">\</span>
  <span class="nt">--subscription</span> my-subscription <span class="nt">--time</span> 10 <span class="se">\</span>
  persistent://test-property/cl1/ns1/tp1 <span class="se">\</span>
</code></pre></div></div>

<h4 id="rest-api-25">REST API</h4>

<div class="highlighter-rouge endpoint"><pre class="highlight"><code class="method post">POST</code><code class="url">/admin/persistent/<span class="endpoint">:property</span>/<span class="endpoint">:cluster</span>/<span class="endpoint">:namespace</span>/<span class="endpoint">:destination</span>/subscription/<span class="endpoint">:subName</span>/resetcursor/<span class="endpoint">:timestamp</span></code></pre></div>

<p><a href="../../reference/RestApi#/admin/persistent/:property/:cluster/:namespace/:destination/subscription/:subName/resetcursor/:timestamp">詳細</a></p>

<h4 id="java-51">Java</h4>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">String</span> <span class="n">destination</span> <span class="o">=</span> <span class="s">"persistent://my-property/my-cluster-my-namespace/my-topic"</span><span class="o">;</span>
<span class="n">String</span> <span class="n">subName</span> <span class="o">=</span> <span class="s">"my-subscription"</span><span class="o">;</span>
<span class="kt">long</span> <span class="n">timestamp</span> <span class="o">=</span> <span class="mi">2342343L</span><span class="o">;</span>
<span class="n">admin</span><span class="o">.</span><span class="na">persistentTopics</span><span class="o">().</span><span class="na">skipAllMessages</span><span class="o">(</span><span class="n">destination</span><span class="o">,</span> <span class="n">subName</span><span class="o">,</span> <span class="n">timestamp</span><span class="o">);</span>
</code></pre></div></div>

<h3 id="トピックのルックアップ">トピックのルックアップ</h3>

<p>特定のトピックに対応しているBrokerのURLを探索します。</p>

<h4 id="pulsar-admin-29">pulsar-admin</h4>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>pulsar-admin persistent lookup <span class="se">\</span>
  persistent://test-property/cl1/ns1/tp1 <span class="se">\</span>

 <span class="s2">"pulsar://broker1.org.com:4480"</span>
</code></pre></div></div>

<h4 id="rest-api-26">REST API</h4>

<div class="highlighter-rouge endpoint"><pre class="highlight"><code class="method get">GET</code><code class="url">/lookup/v2/destination/persistent/<span class="endpoint">:property</span>/<span class="endpoint">:cluster</span>/<span class="endpoint">:namespace</span>/<span class="endpoint">:destination</span></code></pre></div>

<h4 id="java-52">Java</h4>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">String</span> <span class="n">destination</span> <span class="o">=</span> <span class="s">"persistent://my-property/my-cluster-my-namespace/my-topic"</span><span class="o">;</span>
<span class="n">admin</span><span class="o">.</span><span class="na">lookup</span><span class="o">().</span><span class="na">lookupDestination</span><span class="o">(</span><span class="n">destination</span><span class="o">);</span>
</code></pre></div></div>

<h3 id="サブスクリプションの取得">サブスクリプションの取得</h3>

<p>指定されたトピックの全てのサブスクリプション名を表示します。</p>

<h4 id="pulsar-admin-30">pulsar-admin</h4>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>pulsar-admin persistent subscriptions <span class="se">\</span>
  persistent://test-property/cl1/ns1/tp1 <span class="se">\</span>

 my-subscription
</code></pre></div></div>

<h4 id="rest-api-27">REST API</h4>

<div class="highlighter-rouge endpoint"><pre class="highlight"><code class="method get">GET</code><code class="url">/admin/persistent/<span class="endpoint">:property</span>/<span class="endpoint">:cluster</span>/<span class="endpoint">:namespace</span>/<span class="endpoint">:destination</span>/subscriptions</code></pre></div>

<p><a href="../../reference/RestApi#/admin/persistent/:property/:cluster/:namespace/:destination/subscriptions">詳細</a></p>

<h4 id="java-53">Java</h4>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">String</span> <span class="n">destination</span> <span class="o">=</span> <span class="s">"persistent://my-property/my-cluster-my-namespace/my-topic"</span><span class="o">;</span>
<span class="n">admin</span><span class="o">.</span><span class="na">persistentTopics</span><span class="o">().</span><span class="na">getSubscriptions</span><span class="o">(</span><span class="n">destination</span><span class="o">);</span>
</code></pre></div></div>

<h3 id="購読の解除">購読の解除</h3>

<p>それ以上のメッセージを処理しないサブスクリプションの登録を解除するのに役立ちます。</p>

<h4 id="pulsar-admin-31">pulsar-admin</h4>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>pulsar-admin persistent unsubscribe <span class="se">\</span>
  <span class="nt">--subscription</span> my-subscription <span class="se">\</span>
  persistent://test-property/cl1/ns1/tp1 <span class="se">\</span>
</code></pre></div></div>

<h4 id="rest-api-28">REST API</h4>

<div class="highlighter-rouge endpoint"><pre class="highlight"><code class="method post">POST</code><code class="url">/admin/namespaces/<span class="endpoint">:property</span>/<span class="endpoint">:cluster</span>/<span class="endpoint">:namespace</span>/unsubscribe/<span class="endpoint">:subscription</span></code></pre></div>

<p><a href="../../reference/RestApi#/admin/namespaces/:property/:cluster/:namespace/unsubscribe/:subscription">詳細</a></p>

<h4 id="java-54">Java</h4>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">String</span> <span class="n">destination</span> <span class="o">=</span> <span class="s">"persistent://my-property/my-cluster-my-namespace/my-topic"</span><span class="o">;</span>
<span class="n">String</span> <span class="n">subscriptionName</span> <span class="o">=</span> <span class="s">"my-subscription"</span><span class="o">;</span>
<span class="n">admin</span><span class="o">.</span><span class="na">persistentTopics</span><span class="o">().</span><span class="na">deleteSubscription</span><span class="o">(</span><span class="n">destination</span><span class="o">,</span> <span class="n">subscriptionName</span><span class="o">);</span>
</code></pre></div></div>

<h3 id="ネームスペース隔離ポリシー">ネームスペース隔離ポリシー</h3>

<h4 id="ネームスペース隔離ポリシーの作成と更新">ネームスペース隔離ポリシーの作成と更新</h4>

<p>次のようなパラメータを指定する事でネームスペース隔離ポリシーを作成します。</p>

<ul>
  <li>
    <p>auto-failover-policy-params: カンマで区切られたname=value形式の自動フェイルオーバーポリシーのパラメータ</p>
  </li>
  <li>
    <p>auto-failover-policy-type: 自動フェイルオーバーポリシーのタイプ名 [‘min_available’]</p>
  </li>
  <li>
    <p>namespaces: カンマで区切られたネームスペースの正規表現リスト</p>
  </li>
  <li>
    <p>primary: カンマで区切られたプライマリBrokerの正規表現リスト</p>
  </li>
  <li>
    <p>secondary: カンマで区切られたセカンダリBrokerの正規表現リスト</p>
  </li>
</ul>

<h6 id="cli-24">CLI</h6>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$ pulsar-admin ns-isolation-policy --auto-failover-policy-params min_limit=0 --auto-failover-policy-type min_available --namespaces test-property/cl1/ns.*|test-property/cl1/test-ns*.* --secondary broker2.* --primary broker1.* cl1 ns-is-policy1
</code></pre></div></div>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>N/A
</code></pre></div></div>

<h6 id="rest-27">REST</h6>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>POST /admin/clusters/{cluster}/namespaceIsolationPolicies/{policyName}
</code></pre></div></div>

<h6 id="java-55">Java</h6>
<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">admin</span><span class="o">.</span><span class="na">clusters</span><span class="o">().</span><span class="na">createNamespaceIsolationPolicy</span><span class="o">(</span><span class="n">clusterName</span><span class="o">,</span> <span class="n">policyName</span><span class="o">,</span> <span class="n">namespaceIsolationData</span><span class="o">);</span>
</code></pre></div></div>

<h4 id="ネームスペース隔離ポリシーの取得">ネームスペース隔離ポリシーの取得</h4>

<p>作成されたネームスペース隔離ポリシーを表示します。</p>

<h6 id="cli-25">CLI</h6>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$ pulsar-admin ns-isolation-policy get cl1 ns-is-policy1
</code></pre></div></div>

<div class="language-json highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">{</span><span class="w">
    </span><span class="s2">"namespaces"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
        </span><span class="s2">"test-property/cl1/ns.*|test-property/cl1/test-ns*.*"</span><span class="w">
    </span><span class="p">],</span><span class="w">
    </span><span class="s2">"primary"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
        </span><span class="s2">"broker1.*"</span><span class="w">
    </span><span class="p">],</span><span class="w">
    </span><span class="s2">"secondary"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
        </span><span class="s2">"broker2.*"</span><span class="w">
    </span><span class="p">],</span><span class="w">
    </span><span class="s2">"auto_failover_policy"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
        </span><span class="s2">"policy_type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"min_available"</span><span class="p">,</span><span class="w">
        </span><span class="s2">"parameters"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
            </span><span class="s2">"min_limit"</span><span class="p">:</span><span class="w"> </span><span class="s2">"0"</span><span class="w">
        </span><span class="p">}</span><span class="w">
    </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div></div>

<h6 id="rest-28">REST</h6>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>GET /admin/clusters/{cluster}/namespaceIsolationPolicies/{policyName}
</code></pre></div></div>

<h6 id="java-56">Java</h6>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">admin</span><span class="o">.</span><span class="na">clusters</span><span class="o">().</span><span class="na">getNamespaceIsolationPolicy</span><span class="o">(</span><span class="n">clusterName</span><span class="o">,</span> <span class="n">policyName</span><span class="o">)</span>
</code></pre></div></div>

<h4 id="ネームスペース隔離ポリシーの削除">ネームスペース隔離ポリシーの削除</h4>

<p>ネームスペース隔離ポリシーを削除します。</p>

<h6 id="cli-26">CLI</h6>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$ pulsar-admin ns-isolation-policy delete ns-is-policy1
</code></pre></div></div>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>N/A
</code></pre></div></div>

<h6 id="rest-29">REST</h6>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>DELETE /admin/clusters/{cluster}/namespaceIsolationPolicies/{policyName}
</code></pre></div></div>

<h6 id="java-57">Java</h6>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">admin</span><span class="o">.</span><span class="na">clusters</span><span class="o">().</span><span class="na">deleteNamespaceIsolationPolicy</span><span class="o">(</span><span class="n">clusterName</span><span class="o">,</span> <span class="n">policyName</span><span class="o">)</span>
</code></pre></div></div>

<h4 id="全てのネームスペース隔離ポリシーのリストを取得">全てのネームスペース隔離ポリシーのリストを取得</h4>

<p>指定されたクラスタで提供されている全てのネームスペース隔離ポリシーを表示します。</p>

<h6 id="cli-27">CLI</h6>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$ pulsar-admin ns-isolation-policy list cl1
</code></pre></div></div>

<div class="language-json highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">{</span><span class="w">
    </span><span class="s2">"ns-is-policy1"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
        </span><span class="s2">"namespaces"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
            </span><span class="s2">"test-property/cl1/ns.*|test-property/cl1/test-ns*.*"</span><span class="w">
        </span><span class="p">],</span><span class="w">
        </span><span class="s2">"primary"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
            </span><span class="s2">"broker1.*"</span><span class="w">
        </span><span class="p">],</span><span class="w">
        </span><span class="s2">"secondary"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
            </span><span class="s2">"broker2.*"</span><span class="w">
        </span><span class="p">],</span><span class="w">
        </span><span class="s2">"auto_failover_policy"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
            </span><span class="s2">"policy_type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"min_available"</span><span class="p">,</span><span class="w">
            </span><span class="s2">"parameters"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
                </span><span class="s2">"min_limit"</span><span class="p">:</span><span class="w"> </span><span class="s2">"0"</span><span class="w">
            </span><span class="p">}</span><span class="w">
        </span><span class="p">}</span><span class="w">
    </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div></div>

<h6 id="rest-30">REST</h6>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>GET /admin/clusters/{cluster}/namespaceIsolationPolicies
</code></pre></div></div>

<h6 id="java-58">Java</h6>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">admin</span><span class="o">.</span><span class="na">clusters</span><span class="o">().</span><span class="na">getNamespaceIsolationPolicies</span><span class="o">(</span><span class="n">clusterName</span><span class="o">)</span>
</code></pre></div></div>

<h2 id="ノンパーシステントトピックの管理">ノンパーシステントトピックの管理</h2>

<p><code class="highlighter-rouge">non-persistent</code>は、発行されたメッセージをリアルタイムにconsumeするだけで、永続性の保証を必要としないアプリケーションで利用できます。メッセージの永続化に伴うオーバーヘッドを排除する事により、メッセージの発行にかかるレイテンシの短縮が可能です。</p>

<!--

    Licensed to the Apache Software Foundation (ASF) under one
    or more contributor license agreements.  See the NOTICE file
    distributed with this work for additional information
    regarding copyright ownership.  The ASF licenses this file
    to you under the Apache License, Version 2.0 (the
    "License"); you may not use this file except in compliance
    with the License.  You may obtain a copy of the License at

      http://www.apache.org/licenses/LICENSE-2.0

    Unless required by applicable law or agreed to in writing,
    software distributed under the License is distributed on an
    "AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
    KIND, either express or implied.  See the License for the
    specific language governing permissions and limitations
    under the License.

-->

<p><code class="highlighter-rouge">non-persistent</code>は発行されたメッセージをリアルタイムでのみconsumeを行いたく、永続的な保証が不要なアプリケーションで利用することができます。<code class="highlighter-rouge">non-persistent</code>はメッセージを永続化するオーバーヘッドをなくすことでメッセージの発行レイテンシを抑えることができます。</p>

<p>以下の全ての例において、トピック名の構造は次の通りです:</p>

<p><code class="highlighter-rouge">non-persistent://property/cluster/namespace/topic</code></p>

<h3 id="統計情報の取得-1">統計情報の取得</h3>

<p>パーティションドトピックではないトピックの現在の統計情報を表示します。</p>

<ul>
  <li>
    <p><strong>msgRateIn</strong>: 全てのローカルのPublisherとレプリケーション用のPublisherの発行レートの合計で、1秒あたりのメッセージ数です。</p>
  </li>
  <li>
    <p><strong>msgThroughputIn</strong>: 上記と同様ですが、1秒あたりのバイト数です。</p>
  </li>
  <li>
    <p><strong>msgRateOut</strong>: 全てのローカルのConsumerとレプリケーション用のConsumerへの配送レートの合計で、1秒あたりのメッセージ数です。</p>
  </li>
  <li>
    <p><strong>msgThroughputOut</strong>: 上記と同様ですが、1秒あたりのバイト数です。</p>
  </li>
  <li>
    <p><strong>averageMsgSize</strong>: 直近のインターバル内で発行されたメッセージの平均バイトサイズです。</p>
  </li>
  <li>
    <p><strong>publishers</strong>: トピック内の全てのローカルPublisherの一覧です。0または何千もの可能性があります。</p>
  </li>
  <li>
    <p><strong>averageMsgSize</strong>: 直近のインターバル内でこのPublisherからのメッセージの平均バイトサイズです。</p>
  </li>
  <li>
    <p><strong>producerId</strong>: このトピック上での、このProducerの内部的な識別子です。</p>
  </li>
  <li>
    <p><strong>producerName</strong>: クライアントライブラリによって生成されたこのProducerの内部的な識別子です。</p>
  </li>
  <li>
    <p><strong>address</strong>: このProducerの接続用のIPアドレスと送信元ポートです。</p>
  </li>
  <li>
    <p><strong>connectedSince</strong>: このProducerが作成または最後に再接続したタイムスタンプです。</p>
  </li>
  <li>
    <p><strong>subscriptions</strong>: トピックに対してのローカルの全サブスクリプションリストです。</p>
  </li>
  <li>
    <p><strong>my-subscription</strong>: このサブスクリプションの名前です (クライアントが定義します) 。</p>
  </li>
  <li>
    <p><strong>type</strong>: このサブスクリプションのタイプです。</p>
  </li>
  <li>
    <p><strong>consumers</strong>: このサブスクリプションに接続しているConsumerリストです。</p>
  </li>
  <li>
    <p><strong>consumerName</strong>: クライアントライブラリによって生成されたこのConsumerの内部的な識別子です。</p>
  </li>
  <li>
    <p><strong>availablePermits</strong>: このConsumerがクライアントライブラリのlistenキューに格納できるメッセージ数です。0はクライアントライブラリのキューがいっぱいであり、receive()はコールされないことを意味します。0でない場合には、このConsumerはメッセージを配送される準備ができています。</p>
  </li>
  <li>
    <p><strong>replication</strong>: このセクションは、トピックのクラスタ間でのレプリケーションの統計情報を示します。</p>
  </li>
  <li>
    <p><strong>connected</strong>: 送信レプリケータが接続されているかどうかです。</p>
  </li>
  <li>
    <p><strong>inboundConnection</strong>: このBrokerに対しての、リモートクラスタのPublisher接続におけるそのBrokerのIPとポートです。</p>
  </li>
  <li>
    <p><strong>inboundConnectedSince</strong>: リモートクラスタにメッセージを発行するために使われているTCP接続です。もし接続しているローカルのPublisherがいない場合には、この接続は数分後に自動的に閉じられます。</p>
  </li>
  <li>
    <p><strong>msgDropRate</strong>: Publisherのメッセージ発行に対してBrokerは接続ごとに設定された転送数のみを許可しており、閾値を超えて発行された全てのメッセージは削除されます。Brokerは利用できない制限がありコネクションが書き込み可能ではない場合もサブスクリプションのメッセージを削除します。</p>
  </li>
</ul>

<div class="language-json highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">{</span><span class="w">
  </span><span class="s2">"msgRateIn"</span><span class="p">:</span><span class="w"> </span><span class="mf">4641.528542257553</span><span class="p">,</span><span class="w">
  </span><span class="s2">"msgThroughputIn"</span><span class="p">:</span><span class="w"> </span><span class="mf">44663039.74947473</span><span class="p">,</span><span class="w">
  </span><span class="s2">"msgRateOut"</span><span class="p">:</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w">
  </span><span class="s2">"msgThroughputOut"</span><span class="p">:</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w">
  </span><span class="s2">"averageMsgSize"</span><span class="p">:</span><span class="w"> </span><span class="mf">1232439.816728665</span><span class="p">,</span><span class="w">
  </span><span class="s2">"storageSize"</span><span class="p">:</span><span class="w"> </span><span class="mi">135532389160</span><span class="p">,</span><span class="w">
  </span><span class="s2">"msgDropRate"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="mf">0.0</span><span class="p">,</span><span class="w">
  </span><span class="s2">"publishers"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
    </span><span class="p">{</span><span class="w">
      </span><span class="s2">"msgRateIn"</span><span class="p">:</span><span class="w"> </span><span class="mf">57.855383881403576</span><span class="p">,</span><span class="w">
      </span><span class="s2">"msgThroughputIn"</span><span class="p">:</span><span class="w"> </span><span class="mf">558994.7078932219</span><span class="p">,</span><span class="w">
      </span><span class="s2">"averageMsgSize"</span><span class="p">:</span><span class="w"> </span><span class="mi">613135</span><span class="p">,</span><span class="w">
      </span><span class="s2">"producerId"</span><span class="p">:</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w">
      </span><span class="s2">"producerName"</span><span class="p">:</span><span class="w"> </span><span class="kc">null</span><span class="p">,</span><span class="w">
      </span><span class="s2">"address"</span><span class="p">:</span><span class="w"> </span><span class="kc">null</span><span class="p">,</span><span class="w">
      </span><span class="s2">"connectedSince"</span><span class="p">:</span><span class="w"> </span><span class="kc">null</span><span class="p">,</span><span class="w">
      </span><span class="s2">"msgDropRate"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="mf">0.0</span><span class="w">
    </span><span class="p">}</span><span class="w">
  </span><span class="p">],</span><span class="w">
  </span><span class="s2">"subscriptions"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="s2">"my-topic_subscription"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
      </span><span class="s2">"msgRateOut"</span><span class="p">:</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w">
      </span><span class="s2">"msgThroughputOut"</span><span class="p">:</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w">
      </span><span class="s2">"msgBacklog"</span><span class="p">:</span><span class="w"> </span><span class="mi">116632</span><span class="p">,</span><span class="w">
      </span><span class="s2">"type"</span><span class="p">:</span><span class="w"> </span><span class="kc">null</span><span class="p">,</span><span class="w">
      </span><span class="s2">"msgRateExpired"</span><span class="p">:</span><span class="w"> </span><span class="mf">36.98245516804671</span><span class="p">,</span><span class="w">
       </span><span class="s2">"consumers"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w"> </span><span class="p">{</span><span class="w">
        </span><span class="s2">"msgRateOut"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="mf">20343.506296021893</span><span class="p">,</span><span class="w">
        </span><span class="s2">"msgThroughputOut"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="mf">2.0979855364233278E7</span><span class="p">,</span><span class="w">
        </span><span class="s2">"msgRateRedeliver"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="mf">0.0</span><span class="p">,</span><span class="w">
        </span><span class="s2">"consumerName"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"fe3c0"</span><span class="p">,</span><span class="w">
        </span><span class="s2">"availablePermits"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="mi">950</span><span class="p">,</span><span class="w">
        </span><span class="s2">"unackedMessages"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w">
        </span><span class="s2">"blockedConsumerOnUnackedMsgs"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="p">,</span><span class="w">
        </span><span class="s2">"address"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"/10.73.210.249:60578"</span><span class="p">,</span><span class="w">
        </span><span class="s2">"connectedSince"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"2017-07-26 15:13:48.026-0700"</span><span class="p">,</span><span class="w">
        </span><span class="s2">"clientVersion"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"1.19-incubating-SNAPSHOT"</span><span class="w">
      </span><span class="p">}</span><span class="w"> </span><span class="p">],</span><span class="w">
      </span><span class="s2">"msgDropRate"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="mf">432.2390921571593</span><span class="w">

    </span><span class="p">}</span><span class="w">
  </span><span class="p">},</span><span class="w">
  </span><span class="s2">"replication"</span><span class="p">:</span><span class="w"> </span><span class="p">{}</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div></div>

<h4 id="pulsar-admin-32">pulsar-admin</h4>

<p>トピックの統計情報は<a href="../../reference/CliTools#stats"><code class="highlighter-rouge">stats</code></a>コマンドを使って取得できます。</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>pulsar-admin non-persistent stats <span class="se">\</span>
  non-persistent://test-property/cl1/ns1/tp1 <span class="se">\</span>
</code></pre></div></div>

<h4 id="rest-api-29">REST API</h4>

<div class="highlighter-rouge endpoint"><pre class="highlight"><code class="method get">GET</code><code class="url">/admin/non-persistent/<span class="endpoint">:property</span>/<span class="endpoint">:cluster</span>/<span class="endpoint">:namespace</span>/<span class="endpoint">:destination</span>/stats</code></pre></div>

<h4 id="java-59">Java</h4>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">String</span> <span class="n">destination</span> <span class="o">=</span> <span class="s">"non-persistent://my-property/my-cluster-my-namespace/my-topic"</span><span class="o">;</span>
<span class="n">admin</span><span class="o">.</span><span class="na">nonPersistentTopics</span><span class="o">().</span><span class="na">getStats</span><span class="o">(</span><span class="n">destination</span><span class="o">);</span>
</code></pre></div></div>

<h3 id="詳細な統計情報の取得-1">詳細な統計情報の取得</h3>

<p>トピックの詳細な統計情報を表示します。</p>

<h4 id="pulsar-admin-33">pulsar-admin</h4>

<p>トピックの詳細な統計情報は<a href="../../reference/CliTools#stats-internal"><code class="highlighter-rouge">stats-internal</code></a>で取得できます。</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>pulsar-admin non-persistent stats-internal <span class="se">\</span>
  non-persistent://test-property/cl1/ns1/tp1 <span class="se">\</span>

<span class="o">{</span>
  <span class="s2">"entriesAddedCounter"</span> : 48834,
  <span class="s2">"numberOfEntries"</span> : 0,
  <span class="s2">"totalSize"</span> : 0,
  <span class="s2">"cursors"</span> : <span class="o">{</span>
    <span class="s2">"s1"</span> : <span class="o">{</span>
      <span class="s2">"waitingReadOp"</span> : <span class="nb">false</span>,
      <span class="s2">"pendingReadOps"</span> : 0,
      <span class="s2">"messagesConsumedCounter"</span> : 0,
      <span class="s2">"cursorLedger"</span> : 0,
      <span class="s2">"cursorLedgerLastEntry"</span> : 0
    <span class="o">}</span>
  <span class="o">}</span>
<span class="o">}</span>

</code></pre></div></div>

<h4 id="rest-api-30">REST API</h4>

<div class="highlighter-rouge endpoint"><pre class="highlight"><code class="method get">GET</code><code class="url">/admin/non-persistent/<span class="endpoint">:property</span>/<span class="endpoint">:cluster</span>/<span class="endpoint">:namespace</span>/<span class="endpoint">:destination</span>/internalStats</code></pre></div>

<h4 id="java-60">Java</h4>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">String</span> <span class="n">destination</span> <span class="o">=</span> <span class="s">"non-persistent://my-property/my-cluster-my-namespace/my-topic"</span><span class="o">;</span>
<span class="n">admin</span><span class="o">.</span><span class="na">nonPersistentTopics</span><span class="o">().</span><span class="na">getInternalStats</span><span class="o">(</span><span class="n">destination</span><span class="o">);</span>
</code></pre></div></div>

<h3 id="パーティションドトピックの作成">パーティションドトピックの作成</h3>

<p>Pulsarのパーティションドトピックは明示的に作成しなければなりません。新しいパーティションドトピックを作成する際には、トピックの名前と必要なパーティションの数を指定する必要があります。</p>

<h4 id="pulsar-admin-34">pulsar-admin</h4>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>bin/pulsar-admin non-persistent create-partitioned-topic <span class="se">\</span>
  non-persistent://my-property/my-cluster-my-namespace/my-topic <span class="se">\</span>
  <span class="nt">--partitions</span> 4
</code></pre></div></div>

<h4 id="rest-api-31">REST API</h4>

<div class="highlighter-rouge endpoint"><pre class="highlight"><code class="method put">PUT</code><code class="url">/admin/non-persistent/<span class="endpoint">:property</span>/<span class="endpoint">:cluster</span>/<span class="endpoint">:namespace</span>/<span class="endpoint">:destination</span>/partitions</code></pre></div>

<h4 id="java-61">Java</h4>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">String</span> <span class="n">topicName</span> <span class="o">=</span> <span class="s">"non-persistent://my-property/my-cluster-my-namespace/my-topic"</span><span class="o">;</span>
<span class="kt">int</span> <span class="n">numPartitions</span> <span class="o">=</span> <span class="mi">4</span><span class="o">;</span>
<span class="n">admin</span><span class="o">.</span><span class="na">nonPersistentTopics</span><span class="o">().</span><span class="na">createPartitionedTopic</span><span class="o">(</span><span class="n">topicName</span><span class="o">,</span> <span class="n">numPartitions</span><span class="o">);</span>
</code></pre></div></div>

<h3 id="メタデータの取得">メタデータの取得</h3>
<p>パーティションドトピックには、JSONオブジェクトとして取得できるメタデータが関連付けられています。現在、次のメタデータフィールドが利用可能です:</p>

<table>
  <thead>
    <tr>
      <th style="text-align: left">フィールド</th>
      <th style="text-align: left">意味</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td style="text-align: left"><code class="highlighter-rouge">partitions</code></td>
      <td style="text-align: left">トピックが分割されるパーティションの数</td>
    </tr>
  </tbody>
</table>

<h4 id="pulsar-admin-35">pulsar-admin</h4>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>pulsar-admin persistent get-partitioned-topic-metadata <span class="se">\</span>
  non-persistent://my-property/my-cluster-my-namespace/my-topic
<span class="o">{</span>
  <span class="s2">"partitions"</span>: 4
<span class="o">}</span>
</code></pre></div></div>

<h4 id="rest-api-32">REST API</h4>

<div class="highlighter-rouge endpoint"><pre class="highlight"><code class="method get">GET</code><code class="url">/admin/non-persistent/<span class="endpoint">:property</span>/<span class="endpoint">:cluster</span>:/<span class="endpoint">:namespace</span>/<span class="endpoint">:destination</span>/partitions</code></pre></div>

<h4 id="java-62">Java</h4>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">String</span> <span class="n">topicName</span> <span class="o">=</span> <span class="s">"non-persistent://my-property/my-cluster-my-namespace/my-topic"</span><span class="o">;</span>
<span class="n">admin</span><span class="o">.</span><span class="na">nonPersistentTopics</span><span class="o">().</span><span class="na">getPartitionedTopicMetadata</span><span class="o">(</span><span class="n">topicName</span><span class="o">);</span>
</code></pre></div></div>

<h2 id="パーティションドトピックの管理">パーティションドトピックの管理</h2>

<p>パーティションドトピックは実際にはN個の内部トピックとして実現されます。ここでのNはパーティション数です。パーティションドトピックにメッセージを送信すると、それぞれのメッセージは複数のBrokerの内の1つにルーティングされます。Broker間でのパーティションの分散はPulsarによって自動的に処理されます。</p>

<p>以下の解説におけるパーティションドトピックのフォーマットは次のようになります:</p>

<!--

    Licensed to the Apache Software Foundation (ASF) under one
    or more contributor license agreements.  See the NOTICE file
    distributed with this work for additional information
    regarding copyright ownership.  The ASF licenses this file
    to you under the Apache License, Version 2.0 (the
    "License"); you may not use this file except in compliance
    with the License.  You may obtain a copy of the License at

      http://www.apache.org/licenses/LICENSE-2.0

    Unless required by applicable law or agreed to in writing,
    software distributed under the License is distributed on an
    "AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
    KIND, either express or implied.  See the License for the
    specific language governing permissions and limitations
    under the License.

-->
<section class="topic">
  persistent://<span class="cluster">cluster</span>/<span class="namespace">namespace</span>/<span class="t">topic</span>
</section>

<!--

    Licensed to the Apache Software Foundation (ASF) under one
    or more contributor license agreements.  See the NOTICE file
    distributed with this work for additional information
    regarding copyright ownership.  The ASF licenses this file
    to you under the Apache License, Version 2.0 (the
    "License"); you may not use this file except in compliance
    with the License.  You may obtain a copy of the License at

      http://www.apache.org/licenses/LICENSE-2.0

    Unless required by applicable law or agreed to in writing,
    software distributed under the License is distributed on an
    "AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
    KIND, either express or implied.  See the License for the
    specific language governing permissions and limitations
    under the License.

-->

<p>通常のトピックは単一の<span class="popover-term" tabindex="0" title="Brokerとは？" data-placement="top" data-content="2つの異なるコンポーネントを実行するPulsarクラスタのステートレスなコンポーネントです。2つのコンポーネントとは管理操作とトピックルックアップのためのRESTインターフェースを提供するHTTPサーバと全てのメッセージの転送を処理するディスパッチャです。またPulsarクラスタは基本的に複数のBrokerから構成されます。" data-toggle="popover" data-trigger="focus">Broker</span>によってのみ提供されるため、トピックの最大スループットが制限されます。<em>パーティションドトピック</em>は複数のBrokerによって処理される特殊なトピックであり、より高いスループットの実現を可能にします。</p>

<p>裏側では、パーティションドトピックはN個の内部トピックとして実装されます。ここでのNはパーティションの数です。パーティションドトピックにメッセージを発行すると、それぞれのメッセージは複数のBrokerの内のいずれかにルーティングされます。Broker間のパーティションの分散はPulsarによって自動的に処理されます。</p>

<p>次の図は以上の事を示したものです:</p>

<p><img src="/img/pulsar_partitioned_topic.jpg" alt="パーティションドトピック" /></p>

<p>ここでは、トピック<strong>T1</strong>は3つのBrokerにまたがる5つのパーティション (<strong>P0</strong>から<strong>P4</strong>) を持ちます。Brokerよりも多くのパーティションが存在するため、2つのBrokerが2つのパーティションを処理し、3つ目のBrokerは1つのパーティションしか処理しません (Pulsarはこのパーティションの分散を自動的に処理します) 。</p>

<p>このトピックに対するメッセージは2つの<span class="popover-term" tabindex="0" title="Consumerとは？" data-placement="top" data-content="Pulsarのトピックを購読し、Producerによって発行されたメッセージを処理するプロセスです。" data-toggle="popover" data-trigger="focus">Consumer</span>に配信されます。<a href="#ルーティングモード">ルーティングモード</a>によってそれぞれのパーティションをどのBrokerが処理するかが決定され、<a href="../../getting-started/ConceptsAndArchitecture#サブスクリプションモード">サブスクリプションモード</a>によってどのメッセージがどのCondumerに行くかが決定されます。</p>

<p>ルーティングとサブスクリプションモードをどうするかという問題は、ほとんどの場合分けて考える事ができます。パーティショニング/ルーティングはスループットに対する懸念によって決まり、サブスクリプションはアプリケーションのセマンティクスによって決まるべきです。</p>

<p>サブスクリプションモードがどのように動作するかという点において、パーティションドトピックと通常のトピックに違いはありません。パーティショニングは、メッセージが<span class="popover-term" tabindex="0" title="Producerとは？" data-placement="top" data-content="Pulsarのトピックにメッセージを発行するプロセスです。" data-toggle="popover" data-trigger="focus">Producer</span>によって発行される時と、<span class="popover-term" tabindex="0" title="Consumerとは？" data-placement="top" data-content="Pulsarのトピックを購読し、Producerによって発行されたメッセージを処理するプロセスです。" data-toggle="popover" data-trigger="focus">Consumer</span>によって処理され<span class="popover-term" tabindex="0" title="Ack (確認応答) とは？" data-placement="top" data-content="メッセージが正常に処理されたことを知らせるためにConsumerがPulsar Brokerに送信するメッセージのことです。Ackはそのメッセージをシステム上から削除できることをPulsarが知る方法です。もしAckがなければ、そのメッセージは処理されるまで保持されます。" data-toggle="popover" data-trigger="focus">Ack</span> (確認応答) が返される時の間に、何が起こるかだけを決定します。</p>

<p>パーティションドトピックは<a href="../../admin/AdminInterface">admin API</a>から明示的に作成する必要があります。パーティション数はトピックを作成する際に指定できます。</p>

<h4 id="ルーティングモード">ルーティングモード</h4>

<p>パーティションドトピックにメッセージの発行を行う時、<em>ルーティングモード</em>を指定しなければなりません。ルーティングモードはどのパーティション—つまりどの内部トピック—に各メッセージを発行するかを決定します。</p>

<p>デフォルトでは利用可能なルーティングモードが3つ存在します:</p>

<table>
  <thead>
    <tr>
      <th style="text-align: left">モード</th>
      <th style="text-align: left">説明</th>
      <th style="text-align: left">順序保証</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td style="text-align: left">キーハッシュ</td>
      <td style="text-align: left">メッセージにキープロパティが指定されていた場合、パーティションドProducerはキーのハッシュを計算し、それを特定のパーティションに割り当てます。</td>
      <td style="text-align: left">キーバケットごとの保証</td>
    </tr>
    <tr>
      <td style="text-align: left">シングルデフォルトパーティション</td>
      <td style="text-align: left">キーが指定されていなかった場合、各Producerのメッセージは専用のパーティション (最初はランダムに選択) にルーティングされます。</td>
      <td style="text-align: left">Producerごとの保証</td>
    </tr>
    <tr>
      <td style="text-align: left">ラウンドロビンディストリビューション</td>
      <td style="text-align: left">キーが指定されていなかった場合、最大スループットを達成するために全てのメッセージが異なるパーティションにラウンドロビン方式でルーティングされます。</td>
      <td style="text-align: left">なし</td>
    </tr>
  </tbody>
</table>

<p>これらデフォルトのモードに加えて、もし<a href="../../clients/Java">Javaクライアント</a>を使用しているなら<a target="_blank" href="/api/client/com/yahoo/pulsar/client/api/MessageRouter.html"><code class="highlighter-rouge">MessageRouter</code></a>インターフェースを実装する事で独自のルーティングモードを作成可能です。</p>

<h3 id="パーティションドトピック">パーティションドトピック</h3>

<!--

    Licensed to the Apache Software Foundation (ASF) under one
    or more contributor license agreements.  See the NOTICE file
    distributed with this work for additional information
    regarding copyright ownership.  The ASF licenses this file
    to you under the Apache License, Version 2.0 (the
    "License"); you may not use this file except in compliance
    with the License.  You may obtain a copy of the License at

      http://www.apache.org/licenses/LICENSE-2.0

    Unless required by applicable law or agreed to in writing,
    software distributed under the License is distributed on an
    "AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
    KIND, either express or implied.  See the License for the
    specific language governing permissions and limitations
    under the License.

-->

<p>Pulsarの<a href="../../admin/AdminInterface">admin API</a>を使用する事で、パーティションドトピックの作成と管理が可能です。</p>

<p>以下の全ての例において、トピック名の構造は次の通りです:</p>

<!--

    Licensed to the Apache Software Foundation (ASF) under one
    or more contributor license agreements.  See the NOTICE file
    distributed with this work for additional information
    regarding copyright ownership.  The ASF licenses this file
    to you under the Apache License, Version 2.0 (the
    "License"); you may not use this file except in compliance
    with the License.  You may obtain a copy of the License at

      http://www.apache.org/licenses/LICENSE-2.0

    Unless required by applicable law or agreed to in writing,
    software distributed under the License is distributed on an
    "AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
    KIND, either express or implied.  See the License for the
    specific language governing permissions and limitations
    under the License.

-->
<section class="topic">
  persistent://<span class="cluster">cluster</span>/<span class="namespace">namespace</span>/<span class="t">topic</span>
</section>

<h3 id="作成-1">作成</h3>

<p>Pulsarのパーティションドトピックは明示的に作成しなければなりません。新しいパーティションドトピックを作成する際には、トピックの名前と必要なパーティションの数を指定する必要があります。</p>

<!--

    Licensed to the Apache Software Foundation (ASF) under one
    or more contributor license agreements.  See the NOTICE file
    distributed with this work for additional information
    regarding copyright ownership.  The ASF licenses this file
    to you under the Apache License, Version 2.0 (the
    "License"); you may not use this file except in compliance
    with the License.  You may obtain a copy of the License at

      http://www.apache.org/licenses/LICENSE-2.0

    Unless required by applicable law or agreed to in writing,
    software distributed under the License is distributed on an
    "AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
    KIND, either express or implied.  See the License for the
    specific language governing permissions and limitations
    under the License.

-->
<div class="admonition">
  <div class="info">
    <span class="admonition-title"><p>グローバルなパーティションドトピック</p>
</span>
    
<p>グローバルなパーティションドトピックを作成する場合、ここで説明する手順でパーティションドトピックを作成し、トピック名に含まれるクラスタを<code class="highlighter-rouge">global</code>とする必要があります。</p>

  </div>
</div>

<h4 id="pulsar-admin-36">pulsar-admin</h4>

<p><a href="../../reference/CliTools#pulsar-admin-persistent-create-partitioned-topic"><code class="highlighter-rouge">create-partitioned-topic</code></a>コマンドを使用する事でパーティションドトピックの作成が可能です。この時、引数としてトピック名を、<code class="highlighter-rouge">-p</code>または<code class="highlighter-rouge">--partitions</code>オプションでパーティション数を指定できます。以下はその例となります:</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>bin/pulsar-admin persistent create-partitioned-topic <span class="se">\</span>
  persistent://my-property/my-cluster-my-namespace/my-topic <span class="se">\</span>
  <span class="nt">--partitions</span> 4
</code></pre></div></div>

<h4 id="rest-api-33">REST API</h4>

<div class="highlighter-rouge endpoint"><pre class="highlight"><code class="method put">PUT</code><code class="url">/admin/persistent/<span class="endpoint">:property</span>/<span class="endpoint">:cluster</span>/<span class="endpoint">:namespace</span>/<span class="endpoint">:destination</span>/partitions</code></pre></div>

<p><a href="../../reference/RestApi#/admin/persistent/:property/:cluster/:namespace/:destination/partitions">詳細</a></p>

<h4 id="java-63">Java</h4>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">String</span> <span class="n">topicName</span> <span class="o">=</span> <span class="s">"persistent://my-property/my-cluster-my-namespace/my-topic"</span><span class="o">;</span>
<span class="kt">int</span> <span class="n">numPartitions</span> <span class="o">=</span> <span class="mi">4</span><span class="o">;</span>
<span class="n">admin</span><span class="o">.</span><span class="na">persistentTopics</span><span class="o">().</span><span class="na">createPartitionedTopic</span><span class="o">(</span><span class="n">topicName</span><span class="o">,</span> <span class="n">numPartitions</span><span class="o">);</span>
</code></pre></div></div>

<h3 id="メタデータの取得-1">メタデータの取得</h3>

<p>パーティションドトピックには、JSONオブジェクトとして取得できるメタデータが関連付けられています。現在、次のメタデータフィールドが利用可能です:</p>

<table>
  <thead>
    <tr>
      <th style="text-align: left">フィールド</th>
      <th style="text-align: left">意味</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td style="text-align: left"><code class="highlighter-rouge">partitions</code></td>
      <td style="text-align: left">トピックが分割されるパーティションの数</td>
    </tr>
  </tbody>
</table>

<h4 id="pulsar-admin-37">pulsar-admin</h4>

<p><a href="../../reference/CliTools#pulsar-admin-persistent-get-partitioned-topic"><code class="highlighter-rouge">get-partitioned-topic-metadata</code></a>サブコマンドを使用する事で、パーティションドトピックのパーティション数を確認できます。以下はその例となります:</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>pulsar-admin persistent get-partitioned-topic-metadata <span class="se">\</span>
  persistent://my-property/my-cluster-my-namespace/my-topic
<span class="o">{</span>
  <span class="s2">"partitions"</span>: 4
<span class="o">}</span>
</code></pre></div></div>

<h4 id="rest-api-34">REST API</h4>

<div class="highlighter-rouge endpoint"><pre class="highlight"><code class="method get">GET</code><code class="url">/admin/persistent/<span class="endpoint">:property</span>/<span class="endpoint">:cluster</span>:/<span class="endpoint">:namespace</span>/<span class="endpoint">:destination</span>/partitions</code></pre></div>

<p><a href="../../reference/RestApi#/admin/persistent/:property/:cluster/:namespace/:destination/partitions">詳細</a></p>

<h4 id="java-64">Java</h4>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">String</span> <span class="n">topicName</span> <span class="o">=</span> <span class="s">"persistent://my-property/my-cluster-my-namespace/my-topic"</span><span class="o">;</span>
<span class="n">admin</span><span class="o">.</span><span class="na">persistentTopics</span><span class="o">().</span><span class="na">getPartitionedTopicMetadata</span><span class="o">(</span><span class="n">topicName</span><span class="o">);</span>
</code></pre></div></div>

<h3 id="更新-1">更新</h3>

<p>トピックがグローバル<em>でない</em>場合に限り、既存のパーティションドトピックのパーティション数を更新できます。更新するためには、新しいパーティション数は既存の数よりも大きいものでなければなりません。</p>

<p>パーティション数の削減は分割されたトピックの削除を意味するため、Pulsarではサポートされていません。</p>

<p>既に作成済みのパーティションドトピックのProducer/Consumerは新たに作成されたパーティションを見つける事ができないため、アプリケーションによって再作成される必要があります。新しく作成されたProducer/Consumerは、新たに追加されたパーティションにも接続できます。したがって、アプリケーションで全てのProducerが再起動されるまでは、Producerにおけるパーティションの順序付けに違反が発生する可能性があります。</p>

<h4 id="pulsar-admin-38">pulsar-admin</h4>

<p>パーティションドトピックは<a href="../../reference/CliTools#pulsar-admin-persistent-update-partitioned-topic"><code class="highlighter-rouge">update-partitioned-topic</code></a>コマンドを使用する事で更新可能です。</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>pulsar-admin persistent update-partitioned-topic <span class="se">\</span>
  persistent://my-property/my-cluster-my-namespace/my-topic <span class="se">\</span>
  <span class="nt">--partitions</span> 8
</code></pre></div></div>

<h4 id="rest-api-35">REST API</h4>

<div class="highlighter-rouge endpoint"><pre class="highlight"><code class="method post">POST</code><code class="url">/admin/persistent/<span class="endpoint">:property</span>/<span class="endpoint">:cluster</span>/<span class="endpoint">:namespace</span>/<span class="endpoint">:destination</span>/partitions</code></pre></div>

<p><a href="../../reference/RestApi#/admin/persistent/:property/:cluster/:namespace/:destination/partitions">詳細</a></p>

<h4 id="java-65">Java</h4>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">admin</span><span class="o">.</span><span class="na">persistentTopics</span><span class="o">().</span><span class="na">updatePartitionedTopic</span><span class="o">(</span><span class="n">persistentTopic</span><span class="o">,</span> <span class="n">numPartitions</span><span class="o">);</span>
</code></pre></div></div>

<h3 id="削除-2">削除</h3>

<h4 id="pulsar-admin-39">pulsar-admin</h4>

<p>パーティションドトピックは<a href="../../reference/CliTools#pulsar-admin-persistent-delete-partitioned-topic"><code class="highlighter-rouge">delete-partitioned-topic</code></a>コマンドを使用し、トピック名を指定する事で削除可能です:</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>bin/pulsar-admin persistent delete-partitioned-topic <span class="se">\</span>
  persistent://my-property/my-cluster-my-namespace/my-topic
</code></pre></div></div>

<h4 id="rest-api-36">REST API</h4>

<div class="highlighter-rouge endpoint"><pre class="highlight"><code class="method delete">DELETE</code><code class="url">/admin/persistent/<span class="endpoint">:property</span>/<span class="endpoint">:cluster</span>/<span class="endpoint">:namespace</span>/<span class="endpoint">:destination</span>/partitions</code></pre></div>

<p><a href="../../reference/RestApi#/admin/persistent/:property/:cluster/:namespace/:destination/partitions">詳細</a></p>

<h4 id="java-66">Java</h4>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">admin</span><span class="o">.</span><span class="na">persistentTopics</span><span class="o">().</span><span class="na">delete</span><span class="o">(</span><span class="n">persistentTopic</span><span class="o">);</span>
</code></pre></div></div>

<h3 id="リストの取得">リストの取得</h3>

<p>指定されたネームスペースの下に存在するパーティションドトピックのリストを表示します。</p>

<h4 id="pulsar-admin-40">pulsar-admin</h4>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>pulsar-admin persistent list prop-1/cluster-1/namespace
persistent://property/cluster/namespace/topic
persistent://property/cluster/namespace/topic
</code></pre></div></div>

<h4 id="rest-api-37">REST API</h4>

<div class="highlighter-rouge endpoint"><pre class="highlight"><code class="method get">GET</code><code class="url">/admin/persistent/<span class="endpoint">:property</span>/<span class="endpoint">:cluster</span>/<span class="endpoint">:namespace</span></code></pre></div>

<p><a href="../../reference/RestApi#/admin/persistent/:property/:cluster/:namespace">詳細</a></p>

<h4 id="java-67">Java</h4>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">admin</span><span class="o">.</span><span class="na">persistentTopics</span><span class="o">().</span><span class="na">getList</span><span class="o">(</span><span class="n">namespace</span><span class="o">);</span>
</code></pre></div></div>

<h3 id="統計情報">統計情報</h3>

<p>指定されたパーティションドトピックの現在の統計情報を表示します。以下はペイロードの例となります:</p>

<div class="language-json highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">{</span><span class="w">
  </span><span class="s2">"msgRateIn"</span><span class="p">:</span><span class="w"> </span><span class="mf">4641.528542257553</span><span class="p">,</span><span class="w">
  </span><span class="s2">"msgThroughputIn"</span><span class="p">:</span><span class="w"> </span><span class="mf">44663039.74947473</span><span class="p">,</span><span class="w">
  </span><span class="s2">"msgRateOut"</span><span class="p">:</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w">
  </span><span class="s2">"msgThroughputOut"</span><span class="p">:</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w">
  </span><span class="s2">"averageMsgSize"</span><span class="p">:</span><span class="w"> </span><span class="mf">1232439.816728665</span><span class="p">,</span><span class="w">
  </span><span class="s2">"storageSize"</span><span class="p">:</span><span class="w"> </span><span class="mi">135532389160</span><span class="p">,</span><span class="w">
  </span><span class="s2">"publishers"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
    </span><span class="p">{</span><span class="w">
      </span><span class="s2">"msgRateIn"</span><span class="p">:</span><span class="w"> </span><span class="mf">57.855383881403576</span><span class="p">,</span><span class="w">
      </span><span class="s2">"msgThroughputIn"</span><span class="p">:</span><span class="w"> </span><span class="mf">558994.7078932219</span><span class="p">,</span><span class="w">
      </span><span class="s2">"averageMsgSize"</span><span class="p">:</span><span class="w"> </span><span class="mi">613135</span><span class="p">,</span><span class="w">
      </span><span class="s2">"producerId"</span><span class="p">:</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w">
      </span><span class="s2">"producerName"</span><span class="p">:</span><span class="w"> </span><span class="kc">null</span><span class="p">,</span><span class="w">
      </span><span class="s2">"address"</span><span class="p">:</span><span class="w"> </span><span class="kc">null</span><span class="p">,</span><span class="w">
      </span><span class="s2">"connectedSince"</span><span class="p">:</span><span class="w"> </span><span class="kc">null</span><span class="w">
    </span><span class="p">}</span><span class="w">
  </span><span class="p">],</span><span class="w">
  </span><span class="s2">"subscriptions"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="s2">"my-topic_subscription"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
      </span><span class="s2">"msgRateOut"</span><span class="p">:</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w">
      </span><span class="s2">"msgThroughputOut"</span><span class="p">:</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w">
      </span><span class="s2">"msgBacklog"</span><span class="p">:</span><span class="w"> </span><span class="mi">116632</span><span class="p">,</span><span class="w">
      </span><span class="s2">"type"</span><span class="p">:</span><span class="w"> </span><span class="kc">null</span><span class="p">,</span><span class="w">
      </span><span class="s2">"msgRateExpired"</span><span class="p">:</span><span class="w"> </span><span class="mf">36.98245516804671</span><span class="p">,</span><span class="w">
      </span><span class="s2">"consumers"</span><span class="p">:</span><span class="w"> </span><span class="p">[]</span><span class="w">
    </span><span class="p">}</span><span class="w">
  </span><span class="p">},</span><span class="w">
  </span><span class="s2">"replication"</span><span class="p">:</span><span class="w"> </span><span class="p">{}</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div></div>

<p>統計情報には次のようなものが含まれます:</p>

<!--

    Licensed to the Apache Software Foundation (ASF) under one
    or more contributor license agreements.  See the NOTICE file
    distributed with this work for additional information
    regarding copyright ownership.  The ASF licenses this file
    to you under the Apache License, Version 2.0 (the
    "License"); you may not use this file except in compliance
    with the License.  You may obtain a copy of the License at

      http://www.apache.org/licenses/LICENSE-2.0

    Unless required by applicable law or agreed to in writing,
    software distributed under the License is distributed on an
    "AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
    KIND, either express or implied.  See the License for the
    specific language governing permissions and limitations
    under the License.

-->

<table class="stats">
  <thead>
    <tr>
      <th>統計情報の項目</th>
      <th>説明</th>
    </tr>
  </thead>
  <tbody>
    
    <tr>
      <td>msgRateIn</td>
      <td>全てのローカルのPublisherとレプリケーション用のPublisherの発行レートの合計で、1秒あたりのメッセージ数です。
</td>
    </tr>
    
    <tr>
      <td>msgThroughputIn</td>
      <td>msgRateInと同様ですが、1秒あたりのバイト数です。
</td>
    </tr>
    
    <tr>
      <td>msgRateOut</td>
      <td>全てのローカルのConsumerとレプリケーション用のConsumerへの配送レートの合計で、1秒あたりのメッセージ数です。
</td>
    </tr>
    
    <tr>
      <td>msgThroughputOut</td>
      <td>msgRateOutと同様ですが、1秒あたりのバイト数です。
</td>
    </tr>
    
    <tr>
      <td>averageMsgSize</td>
      <td>直近のインターバル内でこのPublisherからのメッセージの平均バイトサイズです。
</td>
    </tr>
    
    <tr>
      <td>storageSize</td>
      <td>このトピックのLedgerストレージのサイズの合計です。
</td>
    </tr>
    
    <tr>
      <td>publishers</td>
      <td>トピック内の全てのローカルPublisherの一覧です。0または何千もの可能性があります。
</td>
    </tr>
    
    <tr>
      <td>producerId</td>
      <td>このトピック上での、このProducerの内部的な識別子です。
</td>
    </tr>
    
    <tr>
      <td>producerName</td>
      <td>クライアントライブラリによって生成されたこのProducerの内部的な識別子です。
</td>
    </tr>
    
    <tr>
      <td>address</td>
      <td>このProducerの接続用のIPアドレスと送信元ポートです。
</td>
    </tr>
    
    <tr>
      <td>connectedSince</td>
      <td>このProducerが作成または最後に再接続したタイムスタンプです。
</td>
    </tr>
    
    <tr>
      <td>subscriptions</td>
      <td>トピックに対してのローカルの全サブスクリプションリストです。
</td>
    </tr>
    
    <tr>
      <td>my-subscription</td>
      <td>このサブスクリプションの名前です (クライアントが定義します) 。
</td>
    </tr>
    
    <tr>
      <td>msgBacklog</td>
      <td>このサブスクリプションのバックログにあるメッセージの数です。
</td>
    </tr>
    
    <tr>
      <td>type</td>
      <td>このサブスクリプションのタイプです。
</td>
    </tr>
    
    <tr>
      <td>msgRateExpired</td>
      <td>TTLのため、サブスクリプションに配信されず破棄されているメッセージのレートです。
</td>
    </tr>
    
    <tr>
      <td>consumers</td>
      <td>このサブスクリプションに接続しているConsumerリストです。
</td>
    </tr>
    
    <tr>
      <td>consumerName</td>
      <td>クライアントライブラリによって生成されたこのConsumerの内部的な識別子です。
</td>
    </tr>
    
    <tr>
      <td>availablePermits</td>
      <td>このConsumerがクライアントライブラリのlistenキューに格納できるメッセージ数です。0はクライアントライブラリのキューがいっぱいであり、receive()はコールされないことを意味します。0でない場合には、このConsumerはメッセージを配送される準備ができています。
</td>
    </tr>
    
    <tr>
      <td>replicationBacklog</td>
      <td>メッセージの送信レプリケーションのバックログです。
</td>
    </tr>
    
    <tr>
      <td>connected</td>
      <td>送信レプリケータが接続されているかどうかです。
</td>
    </tr>
    
    <tr>
      <td>replicationDelayInSeconds</td>
      <td>接続されている場合、一番古いメッセージが送信されずに待機している時間です。
</td>
    </tr>
    
    <tr>
      <td>inboundConnection</td>
      <td>このBrokerに対しての、リモートクラスタのPublisher接続におけるそのBrokerのIPとポートです。
</td>
    </tr>
    
    <tr>
      <td>inboundConnectedSince</td>
      <td>リモートクラスタにメッセージを発行するために使われているTCP接続です。もし接続しているローカルのPublisherがいない場合には、この接続は数分後に自動的に閉じられます。
</td>
    </tr>
    
  </tbody>
</table>

<h4 id="pulsar-admin-41">pulsar-admin</h4>

<p><a href="../../reference/CliTools#pulsar-admin-persistent-partitioned-stats"><code class="highlighter-rouge">partitioned-stats</code></a></p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>pulsar-admin persistent partitioned-stats <span class="se">\</span>
  persistent://test-property/cl1/ns1/tp1 <span class="se">\</span>
  <span class="nt">--per-partition</span>        
</code></pre></div></div>

<h4 id="rest-api-38">REST API</h4>

<div class="highlighter-rouge endpoint"><pre class="highlight"><code class="method get">GET</code><code class="url">/admin/persistent/<span class="endpoint">:property</span>/<span class="endpoint">:cluster</span>/<span class="endpoint">:namespace</span>/<span class="endpoint">:destination</span>/partitioned-stats</code></pre></div>

<p><a href="../../reference/RestApi#/admin/persistent/:property/:cluster/:namespace/:destination/partitioned-stats">詳細</a></p>

<h4 id="java-68">Java</h4>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">admin</span><span class="o">.</span><span class="na">persistentTopics</span><span class="o">().</span><span class="na">getStats</span><span class="o">(</span><span class="n">persistentTopic</span><span class="o">);</span>
</code></pre></div></div>

<h3 id="詳細な統計情報">詳細な統計情報</h3>

<p>トピックの詳細な統計情報を表示します。</p>

<!--

    Licensed to the Apache Software Foundation (ASF) under one
    or more contributor license agreements.  See the NOTICE file
    distributed with this work for additional information
    regarding copyright ownership.  The ASF licenses this file
    to you under the Apache License, Version 2.0 (the
    "License"); you may not use this file except in compliance
    with the License.  You may obtain a copy of the License at

      http://www.apache.org/licenses/LICENSE-2.0

    Unless required by applicable law or agreed to in writing,
    software distributed under the License is distributed on an
    "AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
    KIND, either express or implied.  See the License for the
    specific language governing permissions and limitations
    under the License.

-->

<table class="stats">
  <thead>
    <tr>
      <th>統計情報の項目</th>
      <th>説明</th>
    </tr>
  </thead>
  <tbody>
    
    <tr>
      <td>entriesAddedCounter</td>
      <td>Brokerがこのトピックを読み込んだ後に発行されたメッセージです。
</td>
    </tr>
    
    <tr>
      <td>numberOfEntries</td>
      <td>トラックされているメッセージの総数です。
</td>
    </tr>
    
    <tr>
      <td>totalSize</td>
      <td>全てのメッセージの合計ストレージ容量 (バイト) です。
</td>
    </tr>
    
    <tr>
      <td>currentLedgerEntries</td>
      <td>現在書き込み用に開いているLedgerに書き込まれたメッセージの数です。
</td>
    </tr>
    
    <tr>
      <td>currentLedgerSize</td>
      <td>現在書き込み用に開いているLedgerに書き込まれたメッセージのサイズ (バイト) です。
</td>
    </tr>
    
    <tr>
      <td>lastLedgerCreatedTimestamp</td>
      <td>最後のLedgerが作成された時間です。
</td>
    </tr>
    
    <tr>
      <td>lastLedgerCreationFailureTimestamp</td>
      <td>最後のLedgerが破損した時間です。
</td>
    </tr>
    
    <tr>
      <td>waitingCursorsCount</td>
      <td>捕捉され、新しいメッセージが発行されるのを待つカーソルの数です。
</td>
    </tr>
    
    <tr>
      <td>pendingAddEntriesCount</td>
      <td>完了を待っている (非同期の) 書き込みリクエストを持つメッセージの数です。
</td>
    </tr>
    
    <tr>
      <td>lastConfirmedEntry</td>
      <td>書き込みが完了した最新のメッセージのLedgerID:エントリIDです。エントリIDが-1の場合、Ledgerはオープンしたばかりであるか、現在オープンされているものの書き込みされていません。
</td>
    </tr>
    
    <tr>
      <td>state</td>
      <td>カーソルLedgerの状態です。OpenはmarkDeletePositionの更新を保存するためのLedgerを持つことを意味します。
</td>
    </tr>
    
    <tr>
      <td>ledgers</td>
      <td>メッセージを保持しているこのトピックの全てのLedgerの順序付きリストです。
</td>
    </tr>
    
    <tr>
      <td>cursors</td>
      <td>このトピックの全てのカーソルのリストです。トピックの統計情報に表示されたサブスクリプションごとに1つずつ表示されます。
</td>
    </tr>
    
    <tr>
      <td>markDeletePosition</td>
      <td>Ackの位置です。つまり、Subscriberが受信のAckを返した最後のメッセージです。
</td>
    </tr>
    
    <tr>
      <td>readPosition</td>
      <td>メッセージを読むためのSubscriberの最新の位置です。
</td>
    </tr>
    
    <tr>
      <td>waitingReadOp</td>
      <td>サブスクリプションがこのトピックに発行された最新のメッセージを受信し、新しいメッセージが発行されるのを待っている場合は、これが<code class="highlighter-rouge">true</code>となります。
</td>
    </tr>
    
    <tr>
      <td>pendingReadOps</td>
      <td>BookKeeperに対して処理中の未解決の読み込みリクエストの数です。
</td>
    </tr>
    
    <tr>
      <td>messagesConsumedCounter</td>
      <td>このBrokerがこのトピックをロードしてからこのカーソルがAckしたメッセージの数です。
</td>
    </tr>
    
    <tr>
      <td>cursorLedger</td>
      <td>現在のmarkDeletePositionを永続的に保存するために使用されるLedgerです。
</td>
    </tr>
    
    <tr>
      <td>cursorLedgerLastEntry</td>
      <td>現在のmarkDeletePositionを永続的に保存するために使用された最後のエントリIDです。
</td>
    </tr>
    
    <tr>
      <td>individuallyDeletedMessages</td>
      <td>Ackが順不同で返されている場合、markDeletePositionと読み取り位置の間でAckを返されたメッセージの範囲を表示します。
</td>
    </tr>
    
    <tr>
      <td>lastLedgerSwitchTimestamp</td>
      <td>カーソルLedgerがロールオーバーされた最後の時間です。
</td>
    </tr>
    
  </tbody>
</table>

<div class="language-json highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">{</span><span class="w">
  </span><span class="s2">"entriesAddedCounter"</span><span class="p">:</span><span class="w"> </span><span class="mi">20449518</span><span class="p">,</span><span class="w">
  </span><span class="s2">"numberOfEntries"</span><span class="p">:</span><span class="w"> </span><span class="mi">3233</span><span class="p">,</span><span class="w">
  </span><span class="s2">"totalSize"</span><span class="p">:</span><span class="w"> </span><span class="mi">331482</span><span class="p">,</span><span class="w">
  </span><span class="s2">"currentLedgerEntries"</span><span class="p">:</span><span class="w"> </span><span class="mi">3233</span><span class="p">,</span><span class="w">
  </span><span class="s2">"currentLedgerSize"</span><span class="p">:</span><span class="w"> </span><span class="mi">331482</span><span class="p">,</span><span class="w">
  </span><span class="s2">"lastLedgerCreatedTimestamp"</span><span class="p">:</span><span class="w"> </span><span class="s2">"2016-06-29 03:00:23.825"</span><span class="p">,</span><span class="w">
  </span><span class="s2">"lastLedgerCreationFailureTimestamp"</span><span class="p">:</span><span class="w"> </span><span class="kc">null</span><span class="p">,</span><span class="w">
  </span><span class="s2">"waitingCursorsCount"</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w">
  </span><span class="s2">"pendingAddEntriesCount"</span><span class="p">:</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w">
  </span><span class="s2">"lastConfirmedEntry"</span><span class="p">:</span><span class="w"> </span><span class="s2">"324711539:3232"</span><span class="p">,</span><span class="w">
  </span><span class="s2">"state"</span><span class="p">:</span><span class="w"> </span><span class="s2">"LedgerOpened"</span><span class="p">,</span><span class="w">
  </span><span class="s2">"ledgers"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
    </span><span class="p">{</span><span class="w">
      </span><span class="s2">"ledgerId"</span><span class="p">:</span><span class="w"> </span><span class="mi">324711539</span><span class="p">,</span><span class="w">
      </span><span class="s2">"entries"</span><span class="p">:</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w">
      </span><span class="s2">"size"</span><span class="p">:</span><span class="w"> </span><span class="mi">0</span><span class="w">
    </span><span class="p">}</span><span class="w">
  </span><span class="p">],</span><span class="w">
  </span><span class="s2">"cursors"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="s2">"my-subscription"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
      </span><span class="s2">"markDeletePosition"</span><span class="p">:</span><span class="w"> </span><span class="s2">"324711539:3133"</span><span class="p">,</span><span class="w">
      </span><span class="s2">"readPosition"</span><span class="p">:</span><span class="w"> </span><span class="s2">"324711539:3233"</span><span class="p">,</span><span class="w">
      </span><span class="s2">"waitingReadOp"</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span><span class="w">
      </span><span class="s2">"pendingReadOps"</span><span class="p">:</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w">
      </span><span class="s2">"messagesConsumedCounter"</span><span class="p">:</span><span class="w"> </span><span class="mi">20449501</span><span class="p">,</span><span class="w">
      </span><span class="s2">"cursorLedger"</span><span class="p">:</span><span class="w"> </span><span class="mi">324702104</span><span class="p">,</span><span class="w">
      </span><span class="s2">"cursorLedgerLastEntry"</span><span class="p">:</span><span class="w"> </span><span class="mi">21</span><span class="p">,</span><span class="w">
      </span><span class="s2">"individuallyDeletedMessages"</span><span class="p">:</span><span class="w"> </span><span class="s2">"[(324711539:3134‥324711539:3136], (324711539:3137‥324711539:3140], ]"</span><span class="p">,</span><span class="w">
      </span><span class="s2">"lastLedgerSwitchTimestamp"</span><span class="p">:</span><span class="w"> </span><span class="s2">"2016-06-29 01:30:19.313"</span><span class="p">,</span><span class="w">
      </span><span class="s2">"state"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Open"</span><span class="w">
    </span><span class="p">}</span><span class="w">
  </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div></div>

<h4 id="pulsar-admin-42">pulsar-admin</h4>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>pulsar-admin persistent stats-internal <span class="se">\</span>
  persistent://test-property/cl1/ns1/tp1
</code></pre></div></div>

<h4 id="rest-api-39">REST API</h4>

<div class="highlighter-rouge endpoint"><pre class="highlight"><code class="method get">GET</code><code class="url">/admin/persistent/<span class="endpoint">:property</span>/<span class="endpoint">:cluster</span>/<span class="endpoint">:namespace</span>/<span class="endpoint">:destination</span>/internalStats</code></pre></div>

<p><a href="../../reference/RestApi#/admin/persistent/:property/:cluster/:namespace/:destination/internalStats">詳細</a></p>

<h4 id="java-69">Java</h4>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">admin</span><span class="o">.</span><span class="na">persistentTopics</span><span class="o">().</span><span class="na">getInternalStats</span><span class="o">(</span><span class="n">persistentTopic</span><span class="o">);</span>
</code></pre></div></div>


      </section>
    </article>

    <nav class="toc-bar hidden-md-down col-lg-2">
      
      <div id="toc">
        <h4>Pulsar adminインターフェース</h4>
      </div>
      
    </nav>
  </div>
</div>

      </main>
    </main>

    <!--

    Licensed to the Apache Software Foundation (ASF) under one
    or more contributor license agreements.  See the NOTICE file
    distributed with this work for additional information
    regarding copyright ownership.  The ASF licenses this file
    to you under the Apache License, Version 2.0 (the
    "License"); you may not use this file except in compliance
    with the License.  You may obtain a copy of the License at

      http://www.apache.org/licenses/LICENSE-2.0

    Unless required by applicable law or agreed to in writing,
    software distributed under the License is distributed on an
    "AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
    KIND, either express or implied.  See the License for the
    specific language governing permissions and limitations
    under the License.

-->
<footer class="footer">
  <div class="container">
    <p class="text-center">Copyright 2019 The Apache Software Foundation. All Rights Reserved.</p>
    <p class="text-center">Apache, Apache Pulsar and the Apache feather logo are trademarks of The Apache Software Foundation.</p>
  </div>
</footer>


    

    
    <!--

    Licensed to the Apache Software Foundation (ASF) under one
    or more contributor license agreements.  See the NOTICE file
    distributed with this work for additional information
    regarding copyright ownership.  The ASF licenses this file
    to you under the Apache License, Version 2.0 (the
    "License"); you may not use this file except in compliance
    with the License.  You may obtain a copy of the License at

      http://www.apache.org/licenses/LICENSE-2.0

    Unless required by applicable law or agreed to in writing,
    software distributed under the License is distributed on an
    "AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
    KIND, either express or implied.  See the License for the
    specific language governing permissions and limitations
    under the License.

-->

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-102219959-1', 'auto');
  ga('send', 'pageview');
</script>

    

    <script type="text/javascript">
      var navbarOffset = -1 * (document.getElementsByClassName("navbar")[0].offsetHeight);
      var shiftWindow = function() { scrollBy(0, navbarOffset) };
      window.addEventListener("hashchange", shiftWindow);
      window.addEventListener("pageshow", shiftWindow);
      function load() { if (window.location.hash) shiftWindow(); }
    </script>
  </body>
</html>
