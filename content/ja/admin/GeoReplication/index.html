<!DOCTYPE html>

<!--

    Licensed to the Apache Software Foundation (ASF) under one
    or more contributor license agreements.  See the NOTICE file
    distributed with this work for additional information
    regarding copyright ownership.  The ASF licenses this file
    to you under the Apache License, Version 2.0 (the
    "License"); you may not use this file except in compliance
    with the License.  You may obtain a copy of the License at

      http://www.apache.org/licenses/LICENSE-2.0

    Unless required by applicable law or agreed to in writing,
    software distributed under the License is distributed on an
    "AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
    KIND, either express or implied.  See the License for the
    specific language governing permissions and limitations
    under the License.

-->

<html>
  <head>
    <!--

    Licensed to the Apache Software Foundation (ASF) under one
    or more contributor license agreements.  See the NOTICE file
    distributed with this work for additional information
    regarding copyright ownership.  The ASF licenses this file
    to you under the Apache License, Version 2.0 (the
    "License"); you may not use this file except in compliance
    with the License.  You may obtain a copy of the License at

      http://www.apache.org/licenses/LICENSE-2.0

    Unless required by applicable law or agreed to in writing,
    software distributed under the License is distributed on an
    "AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
    KIND, either express or implied.  See the License for the
    specific language governing permissions and limitations
    under the License.

-->
<title>Pulsarのジオレプリケーション</title>

<meta charset="utf-8">

<link rel="stylesheet" href="/css/style.css">
<link rel="shortcut icon" href="/img/favicon.ico">

<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/tether/1.4.0/js/tether.min.js"></script>
<script src="https://code.jquery.com/ui/1.12.1/jquery-ui.min.js"></script>
<script src="/js/jquery.tocify.min.js"></script>
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0-alpha.6/js/bootstrap.min.js" integrity="sha384-vBWWzlZJ8ea9aCX4pEW3rVHjgjt7zpkNpZk+02D9phzyeVkE+jo0ieGizqPLForn" crossorigin="anonymous"></script>

<script src="/js/jquery.scrollTo.min.js"></script>
<script async src="/js/main.js"></script>

  </head>
  <body class="body">
    <main class="main">
      <!--

    Licensed to the Apache Software Foundation (ASF) under one
    or more contributor license agreements.  See the NOTICE file
    distributed with this work for additional information
    regarding copyright ownership.  The ASF licenses this file
    to you under the Apache License, Version 2.0 (the
    "License"); you may not use this file except in compliance
    with the License.  You may obtain a copy of the License at

      http://www.apache.org/licenses/LICENSE-2.0

    Unless required by applicable law or agreed to in writing,
    software distributed under the License is distributed on an
    "AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
    KIND, either express or implied.  See the License for the
    specific language governing permissions and limitations
    under the License.

-->

<nav class="navbar navbar-toggleable-md navbar-light sticky-top">
  <button class="navbar-toggler navbar-toggler-right" type="button" data-toggle="collapse" data-target="#navbarNavDropdown" aria-controls="navbarNavDropdown" aria-expanded="false" aria-label="Toggle navigation">
    <span class="navbar-toggler-icon"></span>
  </button>

  
  <a class="navbar-brand" href="/">
    <img class="main-logo" src="/img/pulsar-logo.png" alt="Pulsar logo">
  </a>
  

  <a class="navbar-nav"></a>

  <div class="collapse navbar-collapse justify-content-end" id="navbarNavDropdown">
    <ul class="navbar-nav">
      <li class="nav-item dropdown">
        <a class="nav-link dropdown-toggle" href="#" id="clientLibsDropdown" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">Documentation</a>

        <div class="dropdown-menu" aria-labelledby="documentationDropdown">
          <a class="dropdown-item" href="/docs/latest/getting-started/LocalCluster">Latest</a>

          <div class="dropdown-divider"></div>
          <h3 class="dropdown-header">Stable release</h3>
          <a class="dropdown-item" href="/docs/v2.0.1-incubating/getting-started/LocalCluster">2.0.1-incubating</a>

          
              <div class="dropdown-divider"></div>
              <h3 class="dropdown-header">Other releases</h3>

              
                  <a class="dropdown-item" href="/docs/v1.22.1-incubating/getting-started/LocalCluster">1.22.1-incubating</a>
              
                  <a class="dropdown-item" href="/docs/v2.0.0-rc1-incubating/getting-started/LocalCluster">2.0.0-rc1-incubating</a>
              
                  <a class="dropdown-item" href="/docs/v1.22.0-incubating/getting-started/LocalCluster">1.22.0-incubating</a>
              
                  <a class="dropdown-item" href="/docs/v1.21.0-incubating/getting-started/LocalCluster">1.21.0-incubating</a>
              
                  <a class="dropdown-item" href="/docs/v1.20.0-incubating/getting-started/LocalCluster">1.20.0-incubating</a>
              
                  <a class="dropdown-item" href="/docs/v1.19.0-incubating/getting-started/LocalCluster">1.19.0-incubating</a>
              
          
        </div>
      </li>

      <li class="nav-item">
          <a class="nav-link" href="/download">Download</a>
      </li>

      <li class="nav-item dropdown">
        <a class="nav-link dropdown-toggle" href="#" id="clientLibsDropdown" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
          Client libraries
        </a>
        <div class="dropdown-menu" aria-labelledby="clientLibsDropdown">
          <a class="dropdown-item" href="/docs/latest/clients/Java">
            Java
          </a>
          <a class="dropdown-item" href="/docs/latest/clients/go">
            Go
          </a>
          <a class="dropdown-item" href="/docs/latest/clients/Python">
            Python
          </a>
          <a class="dropdown-item" href="/docs/latest/clients/Cpp">
            C++
          </a>
          <div class="dropdown-divider"></div>
          <a class="dropdown-item" href="/api/client">
            Java client Javadoc
          </a>
          <a class="dropdown-item" href="/api/admin">
            Java admin Javadoc
          </a>
          <a class="dropdown-item" href="https://godoc.org/github.com/apache/incubator-pulsar/pulsar-client-go/pulsar">
            GoDoc
          </a>
          <a class="dropdown-item" href="/api/pulsar-functions">
            Pulsar Functions Java SDK
          </a>
          <a class="dropdown-item" href="/api/python">
            Python API docs
          </a>
          <a class="dropdown-item" href="/api/cpp">
            C++ API docs
          </a>
        </div>
      </li>

      <li class="nav-item dropdown">
        <a class="nav-link dropdown-toggle" href="#" id="versionsDropdown" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
          Community
        </a>
        <div class="dropdown-menu dropdown-left" aria-labelledby="versionsDropdown">
          <h3 class="dropdown-header">Get in touch</h3>
          <a class="dropdown-item" href="/contact">Contact</a>
          <a class="dropdown-item" href="/events/current-event">Events</a>
          <a class="dropdown-item" href="https://twitter.com/Apache_Pulsar">Twitter</a>
          <a class="dropdown-item" href="https://github.com/apache/incubator-pulsar/wiki">Wiki</a>
          <a class="dropdown-item" href="https://github.com/apache/incubator-pulsar/issues">Issue tracking</a>
          <div class="dropdown-divider"></div>
          <h3 class="dropdown-header">Resources</h3>
          <a class="dropdown-item" href="/resources">Resources</a>
          <a class="dropdown-item" href="/team">Team</a>
          <div class="dropdown-divider"></div>
          <h3 class="dropdown-header">Apache</h3>
          <a class="dropdown-item" href="https://www.apache.org/">The Apache Software Foundation</a>
          <a class="dropdown-item" href="https://www.apache.org/licenses/">License</a>
          <a class="dropdown-item" href="https://www.apache.org/foundation/sponsorship.html">Sponsorship</a>
          <a class="dropdown-item" href="https://www.apache.org/foundation/thanks.html">Thanks</a>
          <a class="dropdown-item" href="https://www.apache.org/security">Security</a>
        </div>
      </li>
    </ul>
  </div>
  <a class="hidden-md-down" href="http://www.apache.org/">
    <img class="asf-logo" title="Apache Software Foundation" src="/img/feather.png" />
  </a>
</nav>

<!--
<nav class="navbar navbar-toggleable-md navbar-light" style="border: 1px solid red;">
  <button class="navbar-toggler navbar-toggler-right" type="button" data-toggle="collapse" data-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
    <span class="navbar-toggler-icon"></span>
  </button>

  <a class="navbar-brand" href="/">
    <img src="/img/pulsar-logo.png" class="d-inline-block align-top" alt="Pulsar logo" height="40" width="60">
  </a>

  <div class="collapse navbar-collapse" id="navbarSupportedContent">
    <ul class="navbar-nav mr-auto">
      <li class="nav-item active">
        <a class="nav-link" href="#">Home <span class="sr-only">(current)</span></a>
      </li>
      <li class="nav-item">
        <a class="nav-link" href="#">Link</a>
      </li>
      <li class="nav-item">
        <a class="nav-link disabled" href="#">Disabled</a>
      </li>
    </ul>
  </div>
</nav>-->


      <main>
        <!--

    Licensed to the Apache Software Foundation (ASF) under one
    or more contributor license agreements.  See the NOTICE file
    distributed with this work for additional information
    regarding copyright ownership.  The ASF licenses this file
    to you under the Apache License, Version 2.0 (the
    "License"); you may not use this file except in compliance
    with the License.  You may obtain a copy of the License at

      http://www.apache.org/licenses/LICENSE-2.0

    Unless required by applicable law or agreed to in writing,
    software distributed under the License is distributed on an
    "AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
    KIND, either express or implied.  See the License for the
    specific language governing permissions and limitations
    under the License.

-->


<div class="docs-container container-fluid">
  <div class="row">
    <nav class="sidebar-nav hidden-md-down col-lg-3">
      <!--

    Licensed to the Apache Software Foundation (ASF) under one
    or more contributor license agreements.  See the NOTICE file
    distributed with this work for additional information
    regarding copyright ownership.  The ASF licenses this file
    to you under the Apache License, Version 2.0 (the
    "License"); you may not use this file except in compliance
    with the License.  You may obtain a copy of the License at

      http://www.apache.org/licenses/LICENSE-2.0

    Unless required by applicable law or agreed to in writing,
    software distributed under the License is distributed on an
    "AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
    KIND, either express or implied.  See the License for the
    specific language governing permissions and limitations
    under the License.

-->


<aside class="sidebar-nav">
  <div id="sidebar-accordion" role="tablist" aria-multiselectable="true">
    
    
    <div class="card">
      <div class="card-header" role="tab" id="heading-入門">
        <h5>
          <a data-toggle="collapse" data-parent="#sidebar-accordion" href="#collapse-入門" aria-controls="collapse-入門">
            入門
          </a>
        </h5>
      </div>

      <div class="sidebar-group collapse" id="collapse-入門" role="tabpanel" aria-labelledby="heading-入門">
        <ul>
          
          
          <li>
            <a href="/ja/getting-started/LocalCluster">
              ローカルでPulsarを起動
            </a>
          </li>
          
          
          <li>
            <a href="/ja/getting-started/Clients">
              クライアントライブラリ
            </a>
          </li>
          
          
          <li>
            <a href="/ja/getting-started/ConceptsAndArchitecture">
              コンセプトとアーキテクチャ
            </a>
          </li>
          
        </ul>
      </div>
    </div>
    
    
    <div class="card">
      <div class="card-header" role="tab" id="heading-デプロイ">
        <h5>
          <a data-toggle="collapse" data-parent="#sidebar-accordion" href="#collapse-デプロイ" aria-controls="collapse-デプロイ">
            デプロイ
          </a>
        </h5>
      </div>

      <div class="sidebar-group collapse" id="collapse-デプロイ" role="tabpanel" aria-labelledby="heading-デプロイ">
        <ul>
          
          
          <li>
            <a href="/ja/deployment/InstanceSetup">
              ベアメタル
            </a>
          </li>
          
          
          <li>
            <a href="/ja/deployment/Kubernetes">
              Kubernetes
            </a>
          </li>
          
          
          <li>
            <a href="/ja/deployment/Kubernetes/#google-kubernetes-engine">
              Google Kubernetes Engine
            </a>
          </li>
          
          
          <li>
            <a href="/ja/deployment/Kubernetes/#amazon-web-services">
              AWS
            </a>
          </li>
          
          
          <li>
            <a href="/ja/deployment/Monitoring">
              監視
            </a>
          </li>
          
        </ul>
      </div>
    </div>
    
    
    <div class="card">
      <div class="card-header" role="tab" id="heading-管理">
        <h5>
          <a data-toggle="collapse" data-parent="#sidebar-accordion" href="#collapse-管理" aria-controls="collapse-管理">
            管理
          </a>
        </h5>
      </div>

      <div class="sidebar-group collapse" id="collapse-管理" role="tabpanel" aria-labelledby="heading-管理">
        <ul>
          
          
          <li>
            <a href="/ja/admin/AdminInterface">
              Pulsar adminインターフェース
            </a>
          </li>
          
          
          <li>
            <a href="/ja/admin/ClustersBrokers">
              クラスタとBroker
            </a>
          </li>
          
          
          <li>
            <a href="/ja/admin/PropertiesNamespaces">
              プロパティとネームスペース
            </a>
          </li>
          
          
          <li>
            <a href="/ja/admin/ZooKeeperBookKeeper">
              ZooKeeperとBookKeeper
            </a>
          </li>
          
          
          <li>
            <a href="/ja/admin/Dashboard">
              ダッシュボード
            </a>
          </li>
          
          
          <li>
            <a href="/ja/admin/Authz">
              認証と認可
            </a>
          </li>
          
          
          <li>
            <a href="/ja/admin/GeoReplication">
              ジオレプリケーション
            </a>
          </li>
          
          
          <li>
            <a href="/ja/admin/Stats">
              統計情報
            </a>
          </li>
          
          
          <li>
            <a href="/ja/admin/ModularLoadManager">
              モジュラロードマネージャ
            </a>
          </li>
          
        </ul>
      </div>
    </div>
    
    
    <div class="card">
      <div class="card-header" role="tab" id="heading-クライアントライブラリ">
        <h5>
          <a data-toggle="collapse" data-parent="#sidebar-accordion" href="#collapse-クライアントライブラリ" aria-controls="collapse-クライアントライブラリ">
            クライアントライブラリ
          </a>
        </h5>
      </div>

      <div class="sidebar-group collapse" id="collapse-クライアントライブラリ" role="tabpanel" aria-labelledby="heading-クライアントライブラリ">
        <ul>
          
          
          <li>
            <a href="/ja/clients/Java">
              Java
            </a>
          </li>
          
          
          <li>
            <a href="/ja/clients/Cpp">
              C++
            </a>
          </li>
          
          
          <li>
            <a href="/ja/clients/Python">
              Python
            </a>
          </li>
          
          
          <li>
            <a href="/ja/clients/WebSocket">
              WebSocket API
            </a>
          </li>
          
        </ul>
      </div>
    </div>
    
    
    <div class="card">
      <div class="card-header" role="tab" id="heading-アダプタ">
        <h5>
          <a data-toggle="collapse" data-parent="#sidebar-accordion" href="#collapse-アダプタ" aria-controls="collapse-アダプタ">
            アダプタ
          </a>
        </h5>
      </div>

      <div class="sidebar-group collapse" id="collapse-アダプタ" role="tabpanel" aria-labelledby="heading-アダプタ">
        <ul>
          
          
          <li>
            <a href="/ja/adaptors/PulsarSpark">
              Spark Streaming
            </a>
          </li>
          
          
          <li>
            <a href="/ja/adaptors/PulsarStorm">
              Apache Storm
            </a>
          </li>
          
        </ul>
      </div>
    </div>
    
    
    <div class="card">
      <div class="card-header" role="tab" id="heading-高度な機能">
        <h5>
          <a data-toggle="collapse" data-parent="#sidebar-accordion" href="#collapse-高度な機能" aria-controls="collapse-高度な機能">
            高度な機能
          </a>
        </h5>
      </div>

      <div class="sidebar-group collapse" id="collapse-高度な機能" role="tabpanel" aria-labelledby="heading-高度な機能">
        <ul>
          
          
          <li>
            <a href="/ja/advanced/PartitionedTopics">
              パーティションドトピック
            </a>
          </li>
          
          
          <li>
            <a href="/ja/advanced/RetentionExpiry">
              保存と有効期限
            </a>
          </li>
          
        </ul>
      </div>
    </div>
    
    
    <div class="card">
      <div class="card-header" role="tab" id="heading-開発">
        <h5>
          <a data-toggle="collapse" data-parent="#sidebar-accordion" href="#collapse-開発" aria-controls="collapse-開発">
            開発
          </a>
        </h5>
      </div>

      <div class="sidebar-group collapse" id="collapse-開発" role="tabpanel" aria-labelledby="heading-開発">
        <ul>
          
          
          <li>
            <a href="/ja/project/SimulationTools">
              シミュレーションツール
            </a>
          </li>
          
          
          <li>
            <a href="/ja/project/BinaryProtocol">
              バイナリプロトコル
            </a>
          </li>
          
          
          <li>
            <a href="/ja/project/Codebase">
              コードベース
            </a>
          </li>
          
        </ul>
      </div>
    </div>
    
    
    <div class="card">
      <div class="card-header" role="tab" id="heading-リファレンス">
        <h5>
          <a data-toggle="collapse" data-parent="#sidebar-accordion" href="#collapse-リファレンス" aria-controls="collapse-リファレンス">
            リファレンス
          </a>
        </h5>
      </div>

      <div class="sidebar-group collapse" id="collapse-リファレンス" role="tabpanel" aria-labelledby="heading-リファレンス">
        <ul>
          
          
          <li>
            <a href="/ja/reference/RestApi">
              Pulsar REST API
            </a>
          </li>
          
          
          <li>
            <a href="/ja/reference/CliTools">
              コマンドラインツール
            </a>
          </li>
          
          
          <li>
            <a href="/ja/reference/Configuration">
              設定
            </a>
          </li>
          
        </ul>
      </div>
    </div>
    
  </div>
</aside>


    </nav>

    <article class="col-xs-12 col-sm-12 col-md-12 col-lg-7">
      <section class="docs-header">
        <h1 class="docs-title">Pulsarのジオレプリケーション</h1>
        
        <section class="tags">
          
        </section>

        <hr class="hr">
      </section>

      <section class="content">
        <!--

    Licensed to the Apache Software Foundation (ASF) under one
    or more contributor license agreements.  See the NOTICE file
    distributed with this work for additional information
    regarding copyright ownership.  The ASF licenses this file
    to you under the Apache License, Version 2.0 (the
    "License"); you may not use this file except in compliance
    with the License.  You may obtain a copy of the License at

      http://www.apache.org/licenses/LICENSE-2.0

    Unless required by applicable law or agreed to in writing,
    software distributed under the License is distributed on an
    "AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
    KIND, either express or implied.  See the License for the
    specific language governing permissions and limitations
    under the License.

-->

<p><em>ジオレプリケーション</em>とは、Pulsar<span class="popover-term" tabindex="0" title="Pulsarインスタンスとは？" data-placement="top" data-content="単一の単位として動作するPulsarクラスタのグループのことです。" data-toggle="popover" data-trigger="focus">インスタンス</span>の複数の<span class="popover-term" tabindex="0" title="クラスタとは？" data-placement="top" data-content="Pulsar BrokerとBookKeeperサーバ (Bookie) のセットのことです。それぞれのクラスタは異なる地理的地域に存在することができ、メッセージをクラスタ間で相互に複製することができます。この機能をジオレプリケーションと呼びます。" data-toggle="popover" data-trigger="focus">クラスタ</span>を横断して永続的に保存されたメッセージをレプリケーションすることです。</p>

<h2 id="どのように動作するか">どのように動作するか</h2>

<p>以下の図はPulsarクラスタを横断したジオレプリケーションについて説明します:</p>

<p><img src="/img/GeoReplication.png" alt="レプリケーション図" /></p>

<p>この図では、Producer <strong>P1</strong>, <strong>P2</strong>, <strong>P3</strong>が<strong>Cluster-A</strong>, <strong>Cluster-B</strong>, <strong>Cluster-C</strong>のトピック<strong>T1</strong>にメッセージを発行する際、それぞれのメッセージはクラスタを横断して瞬時に複製されます。複製されると、Consumer <strong>C1</strong>, <strong>C2</strong>はそれらのメッセージをそれぞれのクラスタからconsumeできます。</p>

<p>ジオレプリケーションなしでは、Consumer <strong>C1</strong>と<strong>C2</strong>はProducer <strong>P3</strong>によって発行されたメッセージをconsumeできません。</p>

<h2 id="ジオレプリケーションとpulsarプロパティ">ジオレプリケーションとPulsarプロパティ</h2>

<p>ジオレプリケーションを使用するために、Pulsarの<span class="popover-term" tabindex="0" title="プロパティとは？" data-placement="top" data-content="Pulsarのテナントです。" data-toggle="popover" data-trigger="focus">プロパティ</span>単位の設定をする必要があります。両方のクラスタにアクセスできるプロパティが作成されている場合にのみ、クラスタ間でジオレプリケーションを有効にすることができます。</p>

<p>ジオレプリケーションは2つのクラスタ間で有効にする必要がありますが、実際には<span class="popover-term" tabindex="0" title="ネームスペースとは？" data-placement="top" data-content="関連トピックのグループ化メカニズムです。" data-toggle="popover" data-trigger="focus">ネームスペース</span>単位で管理されています。ネームスペースのジオレプリケーションを有効にするには、以下の操作を行う必要があります:</p>

<ul>
  <li><a href="#グローバルネームスペースの作成">グローバルネームスペースを作成する</a></li>
  <li>2つ以上のプロビジョニングされたクラスタ間で複製するようにネームスペースを設定する</li>
</ul>

<p>そのネームスペースの<em>いかなる</em>トピックに発行されたいかなるメッセージも指定された全てのクラスタにレプリケートされます。</p>

<h2 id="ローカル永続化と転送">ローカル永続化と転送</h2>

<p>Pulsarトピックにメッセージがproduceされると、まずローカルクラスタに永続化され、リモートクラスタに非同期に転送されます。</p>

<p>通常、接続に問題がない場合、メッセージはローカルConsumerに配送されると同時に、すぐに複製されます。通常、エンドツーエンドの配信待ち時間は、リモートリージョン間のネットワーク<a href="https://ja.wikipedia.org/wiki/%E3%83%A9%E3%82%A6%E3%83%B3%E3%83%89%E3%83%88%E3%83%AA%E3%83%83%E3%83%97%E3%82%BF%E3%82%A4%E3%83%A0">ラウンドトリップタイム</a> (RTT) によって定義されます。</p>

<p>アプリケーションは、リモートクラスタに到達できない場合 (ネットワークパーティションの間など) にも、いずれかのクラスタでProducerとConsumerを作成できます。</p>

<!--

    Licensed to the Apache Software Foundation (ASF) under one
    or more contributor license agreements.  See the NOTICE file
    distributed with this work for additional information
    regarding copyright ownership.  The ASF licenses this file
    to you under the Apache License, Version 2.0 (the
    "License"); you may not use this file except in compliance
    with the License.  You may obtain a copy of the License at

      http://www.apache.org/licenses/LICENSE-2.0

    Unless required by applicable law or agreed to in writing,
    software distributed under the License is distributed on an
    "AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
    KIND, either express or implied.  See the License for the
    specific language governing permissions and limitations
    under the License.

-->

<div class="admonition">
  <div class="warning">
    <span class="admonition-title"><p>サブスクリプションはクラスタに対してローカルです</p>
</span>
    <p>Producer/ConsumerはPulsarインスタンス内の任意のクラスタに対してproduce/consumeが可能ですが、サブスクリプションは作成されたクラスタに対してローカルであり、クラスタ間を移動させる事はできません。もしサブスクリプションを移動させたい場合は、対象のクラスタで新しくサブスクリプションを作成する必要があります。</p>

  </div>
</div>

<p>上図の例で、トピック<strong>T1</strong>は<strong>Cluster-A</strong>, <strong>Cluster-B</strong>, <strong>Cluster-C</strong>の3クラスタ間でレプリケートされます。</p>

<p>任意のクラスタで生成されたすべてのメッセージは、他のすべてのクラスタ内のすべてのサブスクリプションに配信されます。この場合、Consumer <strong>C1</strong>および<strong>C2</strong>は、Producer <strong>P1</strong>, <strong>P2</strong>, <strong>P3</strong>によって発行されたすべてのメッセージを受信します。 順序はProducerごとに保証されています。</p>

<h2 id="レプリケーションの設定">レプリケーションの設定</h2>

<p><a href="#ジオレプリケーションとpulsarプロパティ">上記</a>で述べたように、Pulsarのジオレプリケーションは<span class="popover-term" tabindex="0" title="プロパティとは？" data-placement="top" data-content="Pulsarのテナントです。" data-toggle="popover" data-trigger="focus">プロパティ</span>単位の設定が必要です。</p>

<h3 id="プロパティにパーミッションを与える">プロパティにパーミッションを与える</h3>

<p>クラスタへのレプリケーションを確立するために、<span class="popover-term" tabindex="0" title="テナントとは？" data-placement="top" data-content="キャパシティの割り当てと認証/認可スキームを実施するための管理単位です。Pulsarのテナントはプロパティレベルで管理されます。" data-toggle="popover" data-trigger="focus">テナント</span>はそのクラスタを利用するパーミッションが必要です。このパーミッションはプロパティの作成時あるいは作成後に付与することができます。</p>

<p>作成時に、必要なクラスタを指定するには以下のようにします:</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>bin/pulsar-admin properties create my-property <span class="se">\</span>
  <span class="nt">--admin-roles</span> my-admin-role <span class="se">\</span>
  <span class="nt">--allowed-clusters</span> us-west,us-east,us-cent
</code></pre></div></div>

<p>既存プロパティのパーミッションの更新を行うには、<code class="highlighter-rouge">create</code>の代わりに<code class="highlighter-rouge">update</code>を利用します。</p>

<h3 id="グローバルネームスペースを作成する">グローバルネームスペースを作成する</h3>

<p>レプリケーションは<em>グローバル</em>トピックで使用する必要があります。つまり、グローバル<span class="popover-term" tabindex="0" title="ネームスペースとは？" data-placement="top" data-content="関連トピックのグループ化メカニズムです。" data-toggle="popover" data-trigger="focus">ネームスペース</span>に属し、特定のクラスタに結びついていないトピックを意味します。</p>

<p>グローバルネームスペースは<code class="highlighter-rouge">global</code>という仮想のクラスタに作成される必要があります。例えば以下のように作成します:</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>bin/pulsar-admin namespaces create my-property/global/my-namespace
</code></pre></div></div>

<p>最初はネームスペースはどのクラスタにも割り当てられていません。<code class="highlighter-rouge">set-clusters</code>サブコマンドを使用して、ネームスペースをクラスタに割り当てることができます:</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>bin/pulsar-admin namespaces set-clusters my-property/global/my-namespace <span class="se">\</span>
  <span class="nt">--clusters</span> us-west,us-east,us-cent
</code></pre></div></div>

<p>ネームスペースのレプリケーションクラスタは、進行中のトラフィックを中断することなく、いつでも変更できます。レプリケーションチャネルは、設定が変更されるとすぐにすべてのクラスタで即座にセットアップまたは停止されます。</p>

<h3 id="グローバルトピックの使用">グローバルトピックの使用</h3>

<p>グローバルネームスペースを作成すると、そのネームスペース内でProducerまたはConsumerが作成するトピックはすべてグローバルになります。通常、各アプリケーションはローカルクラスタに対する <code class="highlighter-rouge">serviceUrl</code>を使用します。</p>

<h4 id="選択的なレプリケーション">選択的なレプリケーション</h4>

<p>デフォルトでは、メッセージはネームスペースに設定されたすべてのクラスタに複製されます。メッセージに対してレプリケーションリストを指定することによって、レプリケーションを選択的に制限することができます。メッセージは、レプリケーションリストのサブセットにのみレプリケートされます。</p>

<p>以下は<a href="../../clients/Java">Java API</a>での一例です。<a target="_blank" href="/api/client/com/yahoo/pulsar/client/api/Message.html"><code class="highlighter-rouge">Message</code></a>オブジェクトの生成時に<code class="highlighter-rouge">setReplicationClusters</code>メソッドを使用することに注意してください:</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">List</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span> <span class="n">restrictReplicationTo</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ArrayList</span><span class="o">&lt;&gt;;</span>
<span class="n">restrictReplicationTo</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="s">"us-west"</span><span class="o">);</span>
<span class="n">restrictReplicationTo</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="s">"us-east"</span><span class="o">);</span>

<span class="n">Message</span> <span class="n">message</span> <span class="o">=</span> <span class="n">MessageBuilder</span><span class="o">.</span><span class="na">create</span><span class="o">()</span>
        <span class="o">.</span><span class="na">setContent</span><span class="o">(</span><span class="s">"my-payload"</span><span class="o">.</span><span class="na">getBytes</span><span class="o">())</span>
        <span class="o">.</span><span class="na">setReplicationClusters</span><span class="o">(</span><span class="n">restrictReplicationTo</span><span class="o">)</span>
        <span class="o">.</span><span class="na">build</span><span class="o">();</span>

<span class="n">producer</span><span class="o">.</span><span class="na">send</span><span class="o">(</span><span class="n">message</span><span class="o">);</span>
</code></pre></div></div>

<h4 id="トピックの統計情報">トピックの統計情報</h4>

<p>グローバルトピックのトピック別の統計情報は、<a href="../../reference/CliTools#pulsar-admin"><code class="highlighter-rouge">pulsar-admin</code></a>ツールと<a href="../../reference/RestApi">REST API</a>から利用可能です:</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>bin/pulsar-admin persistent stats persistent://my-property/global/my-namespace/my-topic
</code></pre></div></div>

<p>各クラスタは、受信と送信に関するレプリケーションレートとバックログを含むローカル統計情報をレポートします。</p>

<h4 id="グローバルトピックの消去">グローバルトピックの消去</h4>

<p>グローバルトピックが複数のリージョンに存在する場合、グローバルトピックを直接削除することはできません。その代わり、自動的なトピックガベージコレクションを利用できます。</p>

<p>Pulsarでは、トピックが使用されなくなったとき、つまりProducerまたはConsumerが接続されておらず、<em>さらに</em>サブスクリプションが存在しない場合にトピックが自動的に削除されます。グローバルトピックの場合、各リージョンはフォールトトレラントメカニズムを使用して、いつトピックをローカルで削除するのが安全かを判断します。</p>

<p>グローバルトピックを削除するには、トピックのすべてのProducerとConsumerを閉じて、すべてのレプリケーションクラスタでそのローカルサブスクリプションをすべて削除します。
Pulsarは、トピックの有効なサブスクリプションがシステムに残っていないと判断すると、そのトピックをガベージコレクトします。</p>

      </section>
    </article>

    <nav class="toc-bar hidden-md-down col-lg-2">
      
      <div id="toc">
        <h4>Pulsarのジオレプリケーション</h4>
      </div>
      
    </nav>
  </div>
</div>

      </main>
    </main>

    <!--

    Licensed to the Apache Software Foundation (ASF) under one
    or more contributor license agreements.  See the NOTICE file
    distributed with this work for additional information
    regarding copyright ownership.  The ASF licenses this file
    to you under the Apache License, Version 2.0 (the
    "License"); you may not use this file except in compliance
    with the License.  You may obtain a copy of the License at

      http://www.apache.org/licenses/LICENSE-2.0

    Unless required by applicable law or agreed to in writing,
    software distributed under the License is distributed on an
    "AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
    KIND, either express or implied.  See the License for the
    specific language governing permissions and limitations
    under the License.

-->
<footer class="footer">
  <div class="container">
    <p class="text-center">Copyright 2019 The Apache Software Foundation. All Rights Reserved.</p>
    <p class="text-center">Apache, Apache Pulsar and the Apache feather logo are trademarks of The Apache Software Foundation.</p>
  </div>
</footer>


    

    
    <!--

    Licensed to the Apache Software Foundation (ASF) under one
    or more contributor license agreements.  See the NOTICE file
    distributed with this work for additional information
    regarding copyright ownership.  The ASF licenses this file
    to you under the Apache License, Version 2.0 (the
    "License"); you may not use this file except in compliance
    with the License.  You may obtain a copy of the License at

      http://www.apache.org/licenses/LICENSE-2.0

    Unless required by applicable law or agreed to in writing,
    software distributed under the License is distributed on an
    "AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
    KIND, either express or implied.  See the License for the
    specific language governing permissions and limitations
    under the License.

-->

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-102219959-1', 'auto');
  ga('send', 'pageview');
</script>

    

    <script type="text/javascript">
      var navbarOffset = -1 * (document.getElementsByClassName("navbar")[0].offsetHeight);
      var shiftWindow = function() { scrollBy(0, navbarOffset) };
      window.addEventListener("hashchange", shiftWindow);
      window.addEventListener("pageshow", shiftWindow);
      function load() { if (window.location.hash) shiftWindow(); }
    </script>
  </body>
</html>
