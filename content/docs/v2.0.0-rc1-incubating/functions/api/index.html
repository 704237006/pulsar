<!DOCTYPE html>

<!--

    Licensed to the Apache Software Foundation (ASF) under one
    or more contributor license agreements.  See the NOTICE file
    distributed with this work for additional information
    regarding copyright ownership.  The ASF licenses this file
    to you under the Apache License, Version 2.0 (the
    "License"); you may not use this file except in compliance
    with the License.  You may obtain a copy of the License at

      http://www.apache.org/licenses/LICENSE-2.0

    Unless required by applicable law or agreed to in writing,
    software distributed under the License is distributed on an
    "AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
    KIND, either express or implied.  See the License for the
    specific language governing permissions and limitations
    under the License.

-->

<html>
  <head>
    <!--

    Licensed to the Apache Software Foundation (ASF) under one
    or more contributor license agreements.  See the NOTICE file
    distributed with this work for additional information
    regarding copyright ownership.  The ASF licenses this file
    to you under the Apache License, Version 2.0 (the
    "License"); you may not use this file except in compliance
    with the License.  You may obtain a copy of the License at

      http://www.apache.org/licenses/LICENSE-2.0

    Unless required by applicable law or agreed to in writing,
    software distributed under the License is distributed on an
    "AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
    KIND, either express or implied.  See the License for the
    specific language governing permissions and limitations
    under the License.

-->
<title>The Pulsar Functions API</title>

<meta charset="utf-8">

<link rel="stylesheet" href="/css/style.css">
<link rel="shortcut icon" href="/img/favicon.ico">

<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/tether/1.4.0/js/tether.min.js"></script>
<script src="https://code.jquery.com/ui/1.12.1/jquery-ui.min.js"></script>
<script src="/js/jquery.tocify.min.js"></script>
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0-alpha.6/js/bootstrap.min.js" integrity="sha384-vBWWzlZJ8ea9aCX4pEW3rVHjgjt7zpkNpZk+02D9phzyeVkE+jo0ieGizqPLForn" crossorigin="anonymous"></script>

<script src="/js/jquery.scrollTo.min.js"></script>
<script async src="/js/main.js"></script>

  </head>
  <body class="body">
    <main class="main">
      <!--

    Licensed to the Apache Software Foundation (ASF) under one
    or more contributor license agreements.  See the NOTICE file
    distributed with this work for additional information
    regarding copyright ownership.  The ASF licenses this file
    to you under the Apache License, Version 2.0 (the
    "License"); you may not use this file except in compliance
    with the License.  You may obtain a copy of the License at

      http://www.apache.org/licenses/LICENSE-2.0

    Unless required by applicable law or agreed to in writing,
    software distributed under the License is distributed on an
    "AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
    KIND, either express or implied.  See the License for the
    specific language governing permissions and limitations
    under the License.

-->

<nav class="navbar navbar-toggleable-md navbar-light sticky-top">
  <button class="navbar-toggler navbar-toggler-right" type="button" data-toggle="collapse" data-target="#navbarNavDropdown" aria-controls="navbarNavDropdown" aria-expanded="false" aria-label="Toggle navigation">
    <span class="navbar-toggler-icon"></span>
  </button>

  
  <a class="navbar-brand" href="/">
    <img class="main-logo" src="/img/pulsar-logo.png" alt="Pulsar logo">
  </a>
  

  <a class="navbar-nav"></a>

  <div class="collapse navbar-collapse justify-content-end" id="navbarNavDropdown">
    <ul class="navbar-nav">
      <li class="nav-item dropdown">
        <a class="nav-link dropdown-toggle" href="#" id="clientLibsDropdown" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">Documentation</a>

        <div class="dropdown-menu" aria-labelledby="documentationDropdown">
          <a class="dropdown-item" href="/docs/latest/getting-started/LocalCluster">Latest</a>

          <div class="dropdown-divider"></div>
          <h3 class="dropdown-header">Stable release</h3>
          <a class="dropdown-item" href="/docs/v2.0.0-incubating/getting-started/LocalCluster">2.0.0-incubating</a>

          
              <div class="dropdown-divider"></div>
              <h3 class="dropdown-header">Other releases</h3>

              
                  <a class="dropdown-item" href="/docs/v1.22.0-incubating/getting-started/LocalCluster">1.22.0-incubating</a>
              
                  <a class="dropdown-item" href="/docs/v1.21.0-incubating/getting-started/LocalCluster">1.21.0-incubating</a>
              
                  <a class="dropdown-item" href="/docs/v1.20.0-incubating/getting-started/LocalCluster">1.20.0-incubating</a>
              
                  <a class="dropdown-item" href="/docs/v1.19.0-incubating/getting-started/LocalCluster">1.19.0-incubating</a>
              
          
        </div>
      </li>

      <li class="nav-item">
          <a class="nav-link" href="/download">Download</a>
      </li>

      <li class="nav-item dropdown">
        <a class="nav-link dropdown-toggle" href="#" id="clientLibsDropdown" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
          Client libraries
        </a>
        <div class="dropdown-menu" aria-labelledby="clientLibsDropdown">
          <a class="dropdown-item" href="/docs/latest/clients/Java">
            Java
          </a>
          <a class="dropdown-item" href="/docs/latest/clients/Python">
            Python
          </a>
          <a class="dropdown-item" href="/docs/latest/clients/Cpp">
            C++
          </a>
          <div class="dropdown-divider"></div>
          <a class="dropdown-item" href="/api/client">
            Java client Javadoc
          </a>
          <a class="dropdown-item" href="/api/admin">
            Java admin Javadoc
          </a>
          <a class="dropdown-item" href="/api/pulsar-functions">
            Pulsar Functions Java SDK
          </a>
          <a class="dropdown-item" href="/api/python">
            Python API docs
          </a>
          <a class="dropdown-item" href="/api/cpp">
            C++ API docs
          </a>
        </div>
      </li>

      <li class="nav-item dropdown">
        <a class="nav-link dropdown-toggle" href="#" id="versionsDropdown" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
          Community
        </a>
        <div class="dropdown-menu dropdown-left" aria-labelledby="versionsDropdown">
          <h3 class="dropdown-header">Get in touch</h3>
          <a class="dropdown-item" href="/contact">Contact</a>
          <a class="dropdown-item" href="/events/current-event">Events</a>
          <a class="dropdown-item" href="https://twitter.com/Apache_Pulsar">Twitter</a>
          <a class="dropdown-item" href="https://github.com/apache/incubator-pulsar/wiki">Wiki</a>
          <a class="dropdown-item" href="https://github.com/apache/incubator-pulsar/issues">Issue tracking</a>
          <div class="dropdown-divider"></div>
          <h3 class="dropdown-header">Resources</h3>
          <a class="dropdown-item" href="/resources">Resources</a>
          <a class="dropdown-item" href="/team">Team</a>
          <div class="dropdown-divider"></div>
          <h3 class="dropdown-header">Apache</h3>
          <a class="dropdown-item" href="https://www.apache.org/">The Apache Software Foundation</a>
          <a class="dropdown-item" href="https://www.apache.org/licenses/">License</a>
          <a class="dropdown-item" href="https://www.apache.org/foundation/sponsorship.html">Sponsorship</a>
          <a class="dropdown-item" href="https://www.apache.org/foundation/thanks.html">Thanks</a>
          <a class="dropdown-item" href="https://www.apache.org/security">Security</a>
        </div>
      </li>
    </ul>
  </div>
  <a class="hidden-md-down" href="http://www.apache.org/">
    <img class="asf-logo" title="Apache Software Foundation" src="/img/feather.png" />
  </a>
</nav>

<!--
<nav class="navbar navbar-toggleable-md navbar-light" style="border: 1px solid red;">
  <button class="navbar-toggler navbar-toggler-right" type="button" data-toggle="collapse" data-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
    <span class="navbar-toggler-icon"></span>
  </button>

  <a class="navbar-brand" href="/">
    <img src="/img/pulsar-logo.png" class="d-inline-block align-top" alt="Pulsar logo" height="40" width="60">
  </a>

  <div class="collapse navbar-collapse" id="navbarSupportedContent">
    <ul class="navbar-nav mr-auto">
      <li class="nav-item active">
        <a class="nav-link" href="#">Home <span class="sr-only">(current)</span></a>
      </li>
      <li class="nav-item">
        <a class="nav-link" href="#">Link</a>
      </li>
      <li class="nav-item">
        <a class="nav-link disabled" href="#">Disabled</a>
      </li>
    </ul>
  </div>
</nav>-->


      <main>
        <!--

    Licensed to the Apache Software Foundation (ASF) under one
    or more contributor license agreements.  See the NOTICE file
    distributed with this work for additional information
    regarding copyright ownership.  The ASF licenses this file
    to you under the Apache License, Version 2.0 (the
    "License"); you may not use this file except in compliance
    with the License.  You may obtain a copy of the License at

      http://www.apache.org/licenses/LICENSE-2.0

    Unless required by applicable law or agreed to in writing,
    software distributed under the License is distributed on an
    "AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
    KIND, either express or implied.  See the License for the
    specific language governing permissions and limitations
    under the License.

-->


<div class="docs-container container-fluid">
  <div class="row">
    <nav class="sidebar-nav hidden-md-down col-lg-3">
      <!--

    Licensed to the Apache Software Foundation (ASF) under one
    or more contributor license agreements.  See the NOTICE file
    distributed with this work for additional information
    regarding copyright ownership.  The ASF licenses this file
    to you under the Apache License, Version 2.0 (the
    "License"); you may not use this file except in compliance
    with the License.  You may obtain a copy of the License at

      http://www.apache.org/licenses/LICENSE-2.0

    Unless required by applicable law or agreed to in writing,
    software distributed under the License is distributed on an
    "AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
    KIND, either express or implied.  See the License for the
    specific language governing permissions and limitations
    under the License.

-->


<aside class="sidebar-nav">
  <div id="sidebar-accordion" role="tablist" aria-multiselectable="true">
    
    
    <div class="card">
      <div class="card-header" role="tab" id="heading-getting-started">
        <h5>
          <a data-toggle="collapse" data-parent="#sidebar-accordion" href="#collapse-getting-started" aria-controls="collapse-getting-started">
            Getting started
          </a>
        </h5>
      </div>

      <div class="sidebar-group collapse" id="collapse-getting-started" role="tabpanel" aria-labelledby="heading-getting-started">
        <ul>
          
          
          <li>
            <a href="../../getting-started/Pulsar-2.0">
              Pulsar 2.0
            </a>
          </li>
          
          
          <li>
            <a href="../../getting-started/LocalCluster">
              Run Pulsar locally
            </a>
          </li>
          
          
          <li>
            <a href="../../getting-started/docker">
              Pulsar in Docker
            </a>
          </li>
          
          
          <li>
            <a href="../../getting-started/Clients">
              Client libraries
            </a>
          </li>
          
          
          <li>
            <a href="../../getting-started/ConceptsAndArchitecture">
              Concepts and architecture
            </a>
          </li>
          
        </ul>
      </div>
    </div>
    
    
    <div class="card">
      <div class="card-header" role="tab" id="heading-pulsar-functions">
        <h5>
          <a data-toggle="collapse" data-parent="#sidebar-accordion" href="#collapse-pulsar-functions" aria-controls="collapse-pulsar-functions">
            Pulsar Functions
          </a>
        </h5>
      </div>

      <div class="sidebar-group collapse" id="collapse-pulsar-functions" role="tabpanel" aria-labelledby="heading-pulsar-functions">
        <ul>
          
          
          <li>
            <a href="../../functions/overview">
              Pulsar Functions overview
            </a>
          </li>
          
          
          <li>
            <a href="../../functions/quickstart">
              Getting started with Pulsar Functions
            </a>
          </li>
          
          
          <li>
            <a href="../../functions/api">
              The Pulsar Functions API
            </a>
          </li>
          
          
          <li>
            <a href="../../functions/deployment">
              Deploying Pulsar Functions
            </a>
          </li>
          
          
          <li>
            <a href="../../functions/guarantees">
              Processing guarantees
            </a>
          </li>
          
          
          <li>
            <a href="../../functions/metrics">
              Metrics for Pulsar Functions
            </a>
          </li>
          
        </ul>
      </div>
    </div>
    
    
    <div class="card">
      <div class="card-header" role="tab" id="heading-deployment">
        <h5>
          <a data-toggle="collapse" data-parent="#sidebar-accordion" href="#collapse-deployment" aria-controls="collapse-deployment">
            Deployment
          </a>
        </h5>
      </div>

      <div class="sidebar-group collapse" id="collapse-deployment" role="tabpanel" aria-labelledby="heading-deployment">
        <ul>
          
          
          <li>
            <a href="../../deployment/aws-cluster">
              Deploy on Amazon Web Services
            </a>
          </li>
          
          
          <li>
            <a href="../../deployment/cluster">
              Single cluster on bare metal
            </a>
          </li>
          
          
          <li>
            <a href="../../deployment/instance">
              Multi-cluster instance on bare metal
            </a>
          </li>
          
          
          <li>
            <a href="../../deployment/Kubernetes">
              Pulsar on Kubernetes
            </a>
          </li>
          
          
          <li>
            <a href="../../deployment/Kubernetes/#pulsar-on-google-kubernetes-engine">
              Pulsar on Google Kubernetes Engine
            </a>
          </li>
          
          
          <li>
            <a href="../../deployment/Kubernetes/#pulsar-on-amazon-web-services">
              Pulsar on AWS
            </a>
          </li>
          
          
          <li>
            <a href="../../deployment/dcos">
              Pulsar on DC/OS
            </a>
          </li>
          
          
          <li>
            <a href="../../deployment/Monitoring">
              Monitoring
            </a>
          </li>
          
        </ul>
      </div>
    </div>
    
    
    <div class="card">
      <div class="card-header" role="tab" id="heading-pulsar-administration">
        <h5>
          <a data-toggle="collapse" data-parent="#sidebar-accordion" href="#collapse-pulsar-administration" aria-controls="collapse-pulsar-administration">
            Pulsar administration
          </a>
        </h5>
      </div>

      <div class="sidebar-group collapse" id="collapse-pulsar-administration" role="tabpanel" aria-labelledby="heading-pulsar-administration">
        <ul>
          
          
          <li>
            <a href="../../admin/ZooKeeperBookKeeper">
              ZooKeeper and BookKeeper
            </a>
          </li>
          
          
          <li>
            <a href="../../admin/GeoReplication">
              Geo-replication
            </a>
          </li>
          
          
          <li>
            <a href="../../admin/Authz">
              Authentication and authorization
            </a>
          </li>
          
          
          <li>
            <a href="../../admin/Dashboard">
              Dashboard
            </a>
          </li>
          
          
          <li>
            <a href="../../admin/Stats">
              Pulsar statistics
            </a>
          </li>
          
          
          <li>
            <a href="../../admin/LoadDistribution">
              Load distribution
            </a>
          </li>
          
          
          <li>
            <a href="../../admin/Proxy">
              Pulsar proxy
            </a>
          </li>
          
        </ul>
      </div>
    </div>
    
    
    <div class="card">
      <div class="card-header" role="tab" id="heading-client-libraries">
        <h5>
          <a data-toggle="collapse" data-parent="#sidebar-accordion" href="#collapse-client-libraries" aria-controls="collapse-client-libraries">
            Client libraries
          </a>
        </h5>
      </div>

      <div class="sidebar-group collapse" id="collapse-client-libraries" role="tabpanel" aria-labelledby="heading-client-libraries">
        <ul>
          
          
          <li>
            <a href="../../clients/Java">
              Java client
            </a>
          </li>
          
          
          <li>
            <a href="../../clients/Cpp">
              C++ client
            </a>
          </li>
          
          
          <li>
            <a href="../../clients/Python">
              Python client
            </a>
          </li>
          
          
          <li>
            <a href="../../clients/WebSocket">
              WebSocket API
            </a>
          </li>
          
        </ul>
      </div>
    </div>
    
    
    <div class="card">
      <div class="card-header" role="tab" id="heading-admin-api">
        <h5>
          <a data-toggle="collapse" data-parent="#sidebar-accordion" href="#collapse-admin-api" aria-controls="collapse-admin-api">
            Admin API
          </a>
        </h5>
      </div>

      <div class="sidebar-group collapse" id="collapse-admin-api" role="tabpanel" aria-labelledby="heading-admin-api">
        <ul>
          
          
          <li>
            <a href="../../admin-api/overview">
              Overview
            </a>
          </li>
          
          
          <li>
            <a href="../../admin-api/clusters">
              Clusters
            </a>
          </li>
          
          
          <li>
            <a href="../../admin-api/tenants">
              Tenants
            </a>
          </li>
          
          
          <li>
            <a href="../../admin-api/brokers">
              Brokers
            </a>
          </li>
          
          
          <li>
            <a href="../../admin-api/namespaces">
              Namespaces
            </a>
          </li>
          
          
          <li>
            <a href="../../admin-api/permissions">
              Permissions
            </a>
          </li>
          
          
          <li>
            <a href="../../admin-api/persistent-topics">
              Persistent topics
            </a>
          </li>
          
          
          <li>
            <a href="../../admin-api/non-persistent-topics">
              Non-Persistent topics
            </a>
          </li>
          
          
          <li>
            <a href="../../admin-api/partitioned-topics">
              Partitioned topics
            </a>
          </li>
          
        </ul>
      </div>
    </div>
    
    
    <div class="card">
      <div class="card-header" role="tab" id="heading-adaptors">
        <h5>
          <a data-toggle="collapse" data-parent="#sidebar-accordion" href="#collapse-adaptors" aria-controls="collapse-adaptors">
            Adaptors
          </a>
        </h5>
      </div>

      <div class="sidebar-group collapse" id="collapse-adaptors" role="tabpanel" aria-labelledby="heading-adaptors">
        <ul>
          
          
          <li>
            <a href="../../adaptors/KafkaWrapper">
              Apache Kafka client wrapper
            </a>
          </li>
          
          
          <li>
            <a href="../../adaptors/PulsarSpark">
              Spark Streaming
            </a>
          </li>
          
          
          <li>
            <a href="../../adaptors/PulsarStorm">
              Apache Storm
            </a>
          </li>
          
        </ul>
      </div>
    </div>
    
    
    <div class="card">
      <div class="card-header" role="tab" id="heading-cookbooks">
        <h5>
          <a data-toggle="collapse" data-parent="#sidebar-accordion" href="#collapse-cookbooks" aria-controls="collapse-cookbooks">
            Cookbooks
          </a>
        </h5>
      </div>

      <div class="sidebar-group collapse" id="collapse-cookbooks" role="tabpanel" aria-labelledby="heading-cookbooks">
        <ul>
          
          
          <li>
            <a href="../../cookbooks/message-deduplication">
              Message deduplication
            </a>
          </li>
          
          
          <li>
            <a href="../../cookbooks/non-persistent-messaging">
              Non-persistent messaging
            </a>
          </li>
          
          
          <li>
            <a href="../../cookbooks/PartitionedTopics">
              Partitioned topics
            </a>
          </li>
          
          
          <li>
            <a href="../../cookbooks/RetentionExpiry">
              Retention and expiry
            </a>
          </li>
          
          
          <li>
            <a href="../../cookbooks/Encryption">
              Encryption
            </a>
          </li>
          
          
          <li>
            <a href="../../cookbooks/message-queue">
              Using Pulsar as a message queue
            </a>
          </li>
          
        </ul>
      </div>
    </div>
    
    
    <div class="card">
      <div class="card-header" role="tab" id="heading-developing-pulsar">
        <h5>
          <a data-toggle="collapse" data-parent="#sidebar-accordion" href="#collapse-developing-pulsar" aria-controls="collapse-developing-pulsar">
            Developing Pulsar
          </a>
        </h5>
      </div>

      <div class="sidebar-group collapse" id="collapse-developing-pulsar" role="tabpanel" aria-labelledby="heading-developing-pulsar">
        <ul>
          
          
          <li>
            <a href="../../project/SimulationTools">
              Simulation tools
            </a>
          </li>
          
          
          <li>
            <a href="../../project/BinaryProtocol">
              Pulsar binary protocol
            </a>
          </li>
          
          
          <li>
            <a href="../../project/Codebase">
              Codebase
            </a>
          </li>
          
          
          <li>
            <a href="../../project/schema-storage">
              Custom schema storage
            </a>
          </li>
          
          
          <li>
            <a href="../../project/ModularLoadManager">
              Modular load manager
            </a>
          </li>
          
        </ul>
      </div>
    </div>
    
    
    <div class="card">
      <div class="card-header" role="tab" id="heading-reference">
        <h5>
          <a data-toggle="collapse" data-parent="#sidebar-accordion" href="#collapse-reference" aria-controls="collapse-reference">
            Reference
          </a>
        </h5>
      </div>

      <div class="sidebar-group collapse" id="collapse-reference" role="tabpanel" aria-labelledby="heading-reference">
        <ul>
          
          
          <li>
            <a href="../../reference/RestApi">
              Pulsar REST API
            </a>
          </li>
          
          
          <li>
            <a href="../../reference/CliTools">
              Command-line tools
            </a>
          </li>
          
          
          <li>
            <a href="../../reference/Configuration">
              Pulsar configuration
            </a>
          </li>
          
        </ul>
      </div>
    </div>
    
  </div>
</aside>


    </nav>

    <article class="col-xs-12 col-sm-12 col-md-12 col-lg-7">
      <section class="docs-header">
        <h1 class="docs-title">
          The Pulsar Functions API
          
           <span class="badge badge-warning">Preview</span>
        </h1>
        
        <section class="tags">
          
        </section>

        <!--

    Licensed to the Apache Software Foundation (ASF) under one
    or more contributor license agreements.  See the NOTICE file
    distributed with this work for additional information
    regarding copyright ownership.  The ASF licenses this file
    to you under the Apache License, Version 2.0 (the
    "License"); you may not use this file except in compliance
    with the License.  You may obtain a copy of the License at

      http://www.apache.org/licenses/LICENSE-2.0

    Unless required by applicable law or agreed to in writing,
    software distributed under the License is distributed on an
    "AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
    KIND, either express or implied.  See the License for the
    specific language governing permissions and limitations
    under the License.

-->

<!--

    Licensed to the Apache Software Foundation (ASF) under one
    or more contributor license agreements.  See the NOTICE file
    distributed with this work for additional information
    regarding copyright ownership.  The ASF licenses this file
    to you under the Apache License, Version 2.0 (the
    "License"); you may not use this file except in compliance
    with the License.  You may obtain a copy of the License at

      http://www.apache.org/licenses/LICENSE-2.0

    Unless required by applicable law or agreed to in writing,
    software distributed under the License is distributed on an
    "AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
    KIND, either express or implied.  See the License for the
    specific language governing permissions and limitations
    under the License.

-->
<div class="admonition">
  <div class="success">
    <span class="admonition-title"><p>Pulsar version 2.0</p>
</span>
    
<p>The documentation that you’re reading is for the 2.0 release of Apache Pulsar. For more information on Pulsar 2.0, see <a href="../../getting-started/Pulsar-2.0">this guide</a>.</p>

  </div>
</div>


        <hr class="hr">
      </section>

      <section class="content">
        <p><a href="../overview">Pulsar Functions</a> provides an easy-to-use API that developers can use to create and manage processing logic for the Apache Pulsar messaging system. With Pulsar Functions, you can write functions of any level of complexity in <a href="#java">Java</a> or <a href="#python">Python</a> and run them in conjunction with a Pulsar cluster without needing to run a separate stream processing engine.</p>

<!--

    Licensed to the Apache Software Foundation (ASF) under one
    or more contributor license agreements.  See the NOTICE file
    distributed with this work for additional information
    regarding copyright ownership.  The ASF licenses this file
    to you under the Apache License, Version 2.0 (the
    "License"); you may not use this file except in compliance
    with the License.  You may obtain a copy of the License at

      http://www.apache.org/licenses/LICENSE-2.0

    Unless required by applicable law or agreed to in writing,
    software distributed under the License is distributed on an
    "AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
    KIND, either express or implied.  See the License for the
    specific language governing permissions and limitations
    under the License.

-->
<div class="admonition">
  <div class="info">
    
    <p>For a more in-depth overview of the Pulsar Functions feature, see the <a href="../overview">Pulsar Functions overview</a>.</p>

  </div>
</div>

<h2 id="core-programming-model">Core programming model</h2>

<p>Pulsar Functions provide a wide range of functionality but are based on a very simple programming model. You can think of Pulsar Functions as lightweight processes that</p>

<ul>
  <li><span class="popover-term" tabindex="0" title="What is a consumer?" data-placement="top" data-content="A process that establishes a subscription to a Pulsar topic and processes messages published to that topic by producers." data-toggle="popover" data-trigger="focus">consume</span> messages from one or more Pulsar <span class="popover-term" tabindex="0" title="What is a topic?" data-placement="top" data-content="A named channel used to pass messages published by producers to consumers who process those messages." data-toggle="popover" data-trigger="focus">topics</span> and then</li>
  <li>apply some user-defined processing logic to each incoming message. That processing logic could be just about anything you want, including
    <ul>
      <li><span class="popover-term" tabindex="0" title="What is a producer?" data-placement="top" data-content="A process that publishes messages to a Pulsar topic." data-toggle="popover" data-trigger="focus">producing</span> the resulting, processed message on another Pulsar topic, or</li>
      <li>doing something else with the message, such as writing results to an external database.</li>
    </ul>
  </li>
</ul>

<p>You could use Pulsar Functions, for example, to set up the following processing chain:</p>

<ul>
  <li>A <a href="#python">Python</a> function listens on the <code class="highlighter-rouge">raw-sentences</code> topic and “<a href="#example-function">sanitizes</a>” incoming strings (removing extraneous whitespace and converting all characters to lower case) and then publishes the results to a <code class="highlighter-rouge">sanitized-sentences</code> topic</li>
  <li>A <a href="#java">Java</a> function listens on the <code class="highlighter-rouge">sanitized-sentences</code> topic, counts the number of times each word appears within a specified time window, and publishes the results to a <code class="highlighter-rouge">results</code> topic</li>
  <li>Finally, a Python function listens on the <code class="highlighter-rouge">results</code> topic and writes the results to a MySQL table</li>
</ul>

<h3 id="example-function">Example function</h3>

<p>Here’s an example “input sanitizer” function written in Python and stored in a <code class="highlighter-rouge">sanitizer.py</code> file:</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">clean_string</span><span class="p">(</span><span class="n">s</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">s</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>

<span class="k">def</span> <span class="nf">process</span><span class="p">(</span><span class="nb">input</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">clean_string</span><span class="p">(</span><span class="nb">input</span><span class="p">)</span>
</code></pre></div></div>

<p>Some things to note about this Pulsar Function:</p>

<ul>
  <li>There is no client, producer, or consumer object involved. All message “plumbing” is already taken care of for you, enabling you to worry only about processing logic.</li>
  <li>No topics, subscription types, <span class="popover-term" tabindex="0" title="What is a tenant?" data-placement="top" data-content="An administrative unit for allocating capacity and enforcing an authentication/authorization scheme. Tenants in Pulsar are managed at the property level." data-toggle="popover" data-trigger="focus">tenants</span>, or <span class="popover-term" tabindex="0" title="What is a namespace?" data-placement="top" data-content="A grouping mechanism for related topics." data-toggle="popover" data-trigger="focus">namespaces</span> are specified in the function logic itself. Instead, topics are specified upon <a href="#example-deployment">deployment</a>. This means that you can use and re-use Pulsar Functions across topics, tenants, and namespaces without needing to hard-code those attributes.</li>
</ul>

<h3 id="example-deployment">Example deployment</h3>

<p>Deploying Pulsar Functions is handled by the <a href="../../reference/CliTools#pulsar-admin"><code class="highlighter-rouge">pulsar-admin</code></a> CLI tool, in particular the <a href="../../reference/CliTools#pulsar-admin-functions"><code class="highlighter-rouge">functions</code></a> command. Here’s an example command that would run our <a href="#example-function">sanitizer</a> function from above in <a href="../deployment#local-run">local run</a> mode:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>bin/pulsar-admin functions localrun <span class="se">\</span>
  <span class="nt">--py</span> sanitizer.py <span class="se">\ </span>         <span class="c"># The Python file with the function's code</span>
  <span class="nt">--className</span> sanitizer <span class="se">\ </span>     <span class="c"># The class or function holding the processing logic</span>
  <span class="nt">--tenant</span> sample <span class="se">\ </span>           <span class="c"># The function's tenant (derived from the topic name by default)</span>
  <span class="nt">--namespace</span> ns1 <span class="se">\ </span>           <span class="c"># The function's namespace (derived from the topic name by default)</span>
  <span class="nt">--name</span> sanitizer-function <span class="se">\ </span> <span class="c"># The name of the function (the class name by default)</span>
  <span class="nt">--inputs</span> dirty-strings-in <span class="se">\ </span> <span class="c"># The input topic(s) for the function</span>
  <span class="nt">--output</span> clean-strings-out <span class="se">\ </span><span class="c"># The output topic for the function</span>
  <span class="nt">--logTopic</span> sanitizer-logs    <span class="c"># The topic to which all functions logs are published</span>
</code></pre></div></div>

<p>For instructions on running functions in your Pulsar cluster, see the <a href="../deployment">Deploying Pulsar Functions</a> guide.</p>

<h3 id="apis">Available APIs</h3>

<p>In both Java and Python, you have two options for writing Pulsar Functions:</p>

<table>
  <thead>
    <tr>
      <th style="text-align: left">Interface</th>
      <th style="text-align: left">Description</th>
      <th style="text-align: left">Use cases</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td style="text-align: left">Language-native interface</td>
      <td style="text-align: left">No Pulsar-specific libraries or special dependencies required (only core libraries from Java/Python)</td>
      <td style="text-align: left">Functions that don’t require access to the function’s <a href="#context">context</a></td>
    </tr>
    <tr>
      <td style="text-align: left">Pulsar Function SDK for Java/Python</td>
      <td style="text-align: left">Pulsar-specific libraries that provide a range of functionality not provided by “native” interfaces</td>
      <td style="text-align: left">Functions that require access to the function’s <a href="#context">context</a></td>
    </tr>
  </tbody>
</table>

<p>In Python, for example, this language-native function, which adds an exclamation point to all incoming strings and publishes the resulting string to a topic, would have no external dependencies:</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">process</span><span class="p">(</span><span class="nb">input</span><span class="p">):</span>
    <span class="k">return</span> <span class="s">"{}!"</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">input</span><span class="p">)</span>
</code></pre></div></div>

<p>This function, however, would use the Pulsar Functions <a href="#python-sdk">SDK for Python</a>:</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">from</span> <span class="nn">pulsar</span> <span class="kn">import</span> <span class="n">Function</span>

<span class="k">class</span> <span class="nc">DisplayFunctionName</span><span class="p">(</span><span class="n">Function</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">process</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="nb">input</span><span class="p">,</span> <span class="n">context</span><span class="p">):</span>
        <span class="n">function_name</span> <span class="o">=</span> <span class="n">context</span><span class="o">.</span><span class="n">function_name</span><span class="p">()</span>
        <span class="k">return</span> <span class="s">"The function processing this message has the name {0}"</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">function_name</span><span class="p">)</span>
</code></pre></div></div>

<h3 id="serde">Serialization and deserialization (SerDe)</h3>

<p>SerDe stands for <strong>Ser</strong>ialization and <strong>De</strong>serialization. All Pulsar Functions use SerDe for message handling. How SerDe works by default depends on the language you’re using for a particular function:</p>

<ul>
  <li>In <a href="#python-serde">Python</a>, the default SerDe is identity, meaning that the type is serialized as whatever type the producer function returns</li>
  <li>In <a href="#java-serde">Java</a>, a number of commonly used types (<code class="highlighter-rouge">String</code>s, <code class="highlighter-rouge">Integer</code>s, etc.) are supported by default</li>
</ul>

<p>In both languages, however, you can write your own custom SerDe logic for more complex, application-specific types. See the docs for <a href="#java-serde">Java</a> and <a href="#python-serde">Python</a> for language-specific instructions.</p>

<h3 id="context">Context</h3>

<p>Both the <a href="#java-sdk">Java</a> and <a href="#python-sdk">Python</a> SDKs provide access to a <strong>context object</strong> that can be used by the function. This context object provides a wide variety of information and functionality to the function:</p>

<ul>
  <li>The name and ID of the Pulsar Function</li>
  <li>The message ID of each message. Each Pulsar <span class="popover-term" tabindex="0" title="What is a message in Pulsar?" data-placement="top" data-content="A" data-toggle="popover" data-trigger="focus">message</span> is automatically assigned an ID.</li>
  <li>The name of the topic on which the message was sent</li>
  <li>The names of all input topics as well as the output topic associated with the function</li>
  <li>The name of the class used for <a href="#serde">SerDe</a></li>
  <li>The <span class="popover-term" tabindex="0" title="What is a tenant?" data-placement="top" data-content="An administrative unit for allocating capacity and enforcing an authentication/authorization scheme. Tenants in Pulsar are managed at the property level." data-toggle="popover" data-trigger="focus">tenant</span> and <span class="popover-term" tabindex="0" title="What is a namespace?" data-placement="top" data-content="A grouping mechanism for related topics." data-toggle="popover" data-trigger="focus">namespace</span> associated with the function</li>
  <li>The ID of the Pulsar Functions instance running the function</li>
  <li>The version of the function</li>
  <li>The <a href="#logging">logger object</a> used by the function, which can be used to create function log messages</li>
  <li>Access to arbitrary <a href="#user-config">user config</a> values supplied via the CLI</li>
  <li>An interface for recording <a href="../metrics">metrics</a></li>
</ul>

<h3 id="user-config">User config</h3>

<p>When you run or update Pulsar Functions created using the <a href="#apis">SDK</a>, you can pass arbitrary key/values to them via the command line with the <code class="highlighter-rouge">--userConfig</code> flag. Key/values must be specified as JSON. Here’s an example of a function creation command that passes a user config key/value to a function:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>bin/pulsar-admin functions create <span class="se">\</span>
  <span class="nt">--name</span> word-filter <span class="se">\</span>
  <span class="c"># Other function configs</span>
  <span class="nt">--userConfig</span> <span class="s1">'{"forbidden-word":"rosebud"}'</span>
</code></pre></div></div>

<p>If the function were a Python function, that config value could be accessed like this:</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">from</span> <span class="nn">pulsar</span> <span class="kn">import</span> <span class="n">Function</span>

<span class="k">class</span> <span class="nc">WordFilter</span><span class="p">(</span><span class="n">Function</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">process</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">context</span><span class="p">,</span> <span class="nb">input</span><span class="p">):</span>
        <span class="n">forbidden_word</span> <span class="o">=</span> <span class="n">context</span><span class="o">.</span><span class="n">user_config</span><span class="p">()[</span><span class="s">"forbidden-word"</span><span class="p">]</span>

        <span class="c"># Don't publish the message if it contains the user-supplied</span>
        <span class="c"># forbidden word</span>
        <span class="k">if</span> <span class="n">forbidden_word</span> <span class="ow">in</span> <span class="nb">input</span><span class="p">:</span>
            <span class="k">pass</span>
        <span class="c"># Otherwise publish the message</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="nb">input</span>
</code></pre></div></div>

<h2 id="java">Pulsar Functions for Java</h2>

<p>Writing Pulsar Functions in Java involves implementing one of two interfaces:</p>

<ul>
  <li>The <a href="https://docs.oracle.com/javase/8/docs/api/java/util/function/Function.html"><code class="highlighter-rouge">java.util.Function</code></a> interface</li>
  <li>The <a target="_blank" href="/api/client/org/apache/pulsar/functions/api/Function.html"><code class="highlighter-rouge">Function</code></a> interface. This interface works much like the <code class="highlighter-rouge">java.util.Function</code> interface, but with the important difference that it provides a <a target="_blank" href="/api/client/org/apache/pulsar/functions/api/Context.html"><code class="highlighter-rouge">Context</code></a> object that you can use in a <a href="#context">variety of ways</a></li>
</ul>

<h3 id="getting-started">Getting started</h3>

<p>In order to write Pulsar Functions in Java, you’ll need to install the proper <a href="#java-dependencies">dependencies</a> and package your function <a href="#java-packaging">as a JAR</a>.</p>

<h4 id="java-dependencies">Dependencies</h4>

<p>How you get started writing Pulsar Functions in Java depends on which API you’re using:</p>

<ul>
  <li>If you’re writing a <a href="#java-native">Java native function</a>, you won’t need any external dependencies.</li>
  <li>
    <p>If you’re writing a <a href="#java-sdk">Java SDK function</a>, you’ll need to import the <code class="highlighter-rouge">pulsar-functions-api</code> library.</p>

    <p>Here’s an example for a Maven <code class="highlighter-rouge">pom.xml</code> configuration file:</p>

    <div class="language-xml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">&lt;dependency&gt;</span>
    <span class="nt">&lt;groupId&gt;</span>org.apache.pulsar<span class="nt">&lt;/groupId&gt;</span>
    <span class="nt">&lt;artifactId&gt;</span>pulsar-functions-api<span class="nt">&lt;/artifactId&gt;</span>
    <span class="nt">&lt;version&gt;</span>2.0.0-incubating-SNAPSHOT<span class="nt">&lt;/version&gt;</span>
<span class="nt">&lt;/dependency&gt;</span>
</code></pre></div>    </div>

    <p>Here’s an example for a Gradle <code class="highlighter-rouge">build.gradle</code> configuration file:</p>

    <div class="language-groovy highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">dependencies</span> <span class="o">{</span>
  <span class="n">compile</span> <span class="nl">group:</span> <span class="s1">'org.apache.pulsar'</span><span class="o">,</span> <span class="nl">name:</span> <span class="s1">'pulsar-functions-api'</span><span class="o">,</span> <span class="nl">version:</span> <span class="s1">'2.0.0-incubating-SNAPSHOT'</span>
<span class="o">}</span>
</code></pre></div>    </div>
  </li>
</ul>

<h4 id="java-packaging">Packaging</h4>

<p>Whether you’re writing Java Pulsar Functions using the <a href="#java-native">native</a> Java <code class="highlighter-rouge">java.util.Function</code> interface or using the <a href="#java-sdk">Java SDK</a>, you’ll need to package your function(s) as a “fat” JAR.</p>

<!--

    Licensed to the Apache Software Foundation (ASF) under one
    or more contributor license agreements.  See the NOTICE file
    distributed with this work for additional information
    regarding copyright ownership.  The ASF licenses this file
    to you under the Apache License, Version 2.0 (the
    "License"); you may not use this file except in compliance
    with the License.  You may obtain a copy of the License at

      http://www.apache.org/licenses/LICENSE-2.0

    Unless required by applicable law or agreed to in writing,
    software distributed under the License is distributed on an
    "AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
    KIND, either express or implied.  See the License for the
    specific language governing permissions and limitations
    under the License.

-->
<div class="admonition">
  <div class="success">
    <span class="admonition-title"><p>Starter repo</p>
</span>
    <p>If you’d like to get up and running quickly, you can use <a href="https://github.com/streamlio/pulsar-functions-java-starter">this repo</a>, which contains the necessary Maven configuration to build a fat JAR as well as some example functions.</p>

  </div>
</div>

<h3 id="java-native">Java native functions</h3>

<p>If your function doesn’t require access to its <a href="#java-context">context</a>, you can create a Pulsar Function by implementing the <a href="https://docs.oracle.com/javase/8/docs/api/java/util/function/Function.html"><code class="highlighter-rouge">java.util.Function</code></a> interface, which has this very simple, single-method signature:</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">public</span> <span class="kd">interface</span> <span class="nc">Function</span><span class="o">&lt;</span><span class="n">I</span><span class="o">,</span> <span class="n">O</span><span class="o">&gt;</span> <span class="o">{</span>
    <span class="n">O</span> <span class="nf">apply</span><span class="o">(</span><span class="n">I</span> <span class="n">input</span><span class="o">);</span>
<span class="o">}</span>
</code></pre></div></div>

<p>Here’s an example function that takes a string as its input, adds an exclamation point to the end of the string, and then publishes the resulting string:</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">import</span> <span class="nn">java.util.Function</span><span class="o">;</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">ExclamationFunction</span> <span class="kd">implements</span> <span class="n">Function</span><span class="o">&lt;</span><span class="n">String</span><span class="o">,</span> <span class="n">String</span><span class="o">&gt;</span> <span class="o">{</span>
    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="n">String</span> <span class="nf">process</span><span class="o">(</span><span class="n">String</span> <span class="n">input</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">String</span><span class="o">.</span><span class="na">format</span><span class="o">(</span><span class="s">"%s!"</span><span class="o">,</span> <span class="n">input</span><span class="o">);</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></div></div>

<p>In general, you should use native functions when you don’t need access to the function’s <a href="#context">context</a>. If you <em>do</em> need access to the function’s context, then we recommend using the <a href="#java-sdk">Pulsar Functions Java SDK</a>.</p>

<h4 id="java-native-examples">Java native examples</h4>

<p>There is one example Java native function in <a href="https://github.com/apache/incubator-pulsar/tree/master/pulsar-functions/java-examples/src/main/java/org/apache/pulsar/functions/api/examples">this folder</a>:</p>

<ul>
  <li><a href="https://github.com/apache/incubator-pulsar/blob/master/pulsar-functions/java-examples/src/main/java/org/apache/pulsar/functions/api/examples/JavaNativeExclmationFunction.java"><code class="highlighter-rouge">JavaNativeExclmationFunction</code></a></li>
</ul>

<h3 id="java-sdk">Java SDK functions</h3>

<p>To get started developing Pulsar Functions using the Java SDK, you’ll need to add a dependency on the <code class="highlighter-rouge">pulsar-functions-api</code> artifact to your project. Instructions can be found <a href="#java-dependencies">above</a>.</p>

<!--

    Licensed to the Apache Software Foundation (ASF) under one
    or more contributor license agreements.  See the NOTICE file
    distributed with this work for additional information
    regarding copyright ownership.  The ASF licenses this file
    to you under the Apache License, Version 2.0 (the
    "License"); you may not use this file except in compliance
    with the License.  You may obtain a copy of the License at

      http://www.apache.org/licenses/LICENSE-2.0

    Unless required by applicable law or agreed to in writing,
    software distributed under the License is distributed on an
    "AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
    KIND, either express or implied.  See the License for the
    specific language governing permissions and limitations
    under the License.

-->
<div class="admonition">
  <div class="success">
    
    <p>An easy way to get up and running with Pulsar Functions in Java is to clone the <a href="https://github.com/streamlio/pulsar-functions-java-starter"><code class="highlighter-rouge">pulsar-functions-java-starter</code></a> repo and follow the instructions there.</p>

  </div>
</div>

<h4 id="java-sdk-examples">Java SDK examples</h4>

<p>There are several example Java SDK functions in <a href="https://github.com/apache/incubator-pulsar/tree/master/pulsar-functions/java-examples/src/main/java/org/apache/pulsar/functions/api/examples">this folder</a>:</p>

<table>
  <thead>
    <tr>
      <th style="text-align: left">Function name</th>
      <th style="text-align: left">Description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td style="text-align: left"><a href="https://github.com/apache/incubator-pulsar/blob/master/pulsar-functions/java-examples/src/main/java/org/apache/pulsar/functions/api/examples/ContextFunction.java"><code class="highlighter-rouge">ContextFunction</code></a></td>
      <td style="text-align: left">Illustrates <a href="#context">context</a>-specific functionality like <a href="#java-logging">logging</a> and <a href="#java-metrics">metrics</a></td>
    </tr>
    <tr>
      <td style="text-align: left"><a href="https://github.com/apache/incubator-pulsar/blob/master/pulsar-functions/java-examples/src/main/java/org/apache/pulsar/functions/api/examples/CounterFunction.java"><code class="highlighter-rouge">CounterFunction</code></a></td>
      <td style="text-align: left">Illustrates usage of Pulsar Function <a href="../overview#counters">counters</a></td>
    </tr>
    <tr>
      <td style="text-align: left"><a href="https://github.com/apache/incubator-pulsar/blob/master/pulsar-functions/java-examples/src/main/java/org/apache/pulsar/functions/api/examples/ExclamationFunction.java"><code class="highlighter-rouge">ExclamationFunction</code></a></td>
      <td style="text-align: left">A basic string manipulation function for the Java SDK</td>
    </tr>
    <tr>
      <td style="text-align: left"><a href="https://github.com/apache/incubator-pulsar/blob/master/pulsar-functions/java-examples/src/main/java/org/apache/pulsar/functions/api/examples/LoggingFunction.java"><code class="highlighter-rouge">LoggingFunction</code></a></td>
      <td style="text-align: left">A function that shows how <a href="#java-logging">logging</a> works for Java</td>
    </tr>
    <tr>
      <td style="text-align: left"><a href="https://github.com/apache/incubator-pulsar/blob/master/pulsar-functions/java-examples/src/main/java/org/apache/pulsar/functions/api/examples/PublishFunction.java"><code class="highlighter-rouge">PublishFunction</code></a></td>
      <td style="text-align: left">Publishes results to a topic specified in the function’s <a href="#java-user-config">user config</a> (rather than on the function’s output topic)</td>
    </tr>
    <tr>
      <td style="text-align: left"><a href="https://github.com/apache/incubator-pulsar/blob/master/pulsar-functions/java-examples/src/main/java/org/apache/pulsar/functions/api/examples/UserConfigFunction.java"><code class="highlighter-rouge">UserConfigFunction</code></a></td>
      <td style="text-align: left">A function that consumes <a href="#java-user-config">user-supplied configuration</a> values</td>
    </tr>
    <tr>
      <td style="text-align: left"><a href="https://github.com/apache/incubator-pulsar/blob/master/pulsar-functions/java-examples/src/main/java/org/apache/pulsar/functions/api/examples/UserMetricFunction.java"><code class="highlighter-rouge">UserMetricFunction</code></a></td>
      <td style="text-align: left">A function that records metrics</td>
    </tr>
    <tr>
      <td style="text-align: left"><a href="https://github.com/apache/incubator-pulsar/blob/master/pulsar-functions/java-examples/src/main/java/org/apache/pulsar/functions/api/examples/UserMetricFunction.java"><code class="highlighter-rouge">VoidFunction</code></a></td>
      <td style="text-align: left">A simple <a href="#void-functions">void function</a></td>
    </tr>
  </tbody>
</table>

<h3 id="java-context">Java context object</h3>

<p>The <a target="_blank" href="/api/client/org/apache/pulsar/functions/api/Context.html"><code class="highlighter-rouge">Context</code></a> interface provides a number of methods that you can use to access the function’s <a href="#context">context</a>. The various method signatures for the <code class="highlighter-rouge">Context</code> interface are listed below:</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">public</span> <span class="kd">interface</span> <span class="nc">Context</span> <span class="o">{</span>
    <span class="kt">byte</span><span class="o">[]</span> <span class="nf">getMessageId</span><span class="o">();</span>
    <span class="n">String</span> <span class="nf">getTopicName</span><span class="o">();</span>
    <span class="n">Collection</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span> <span class="nf">getSourceTopics</span><span class="o">();</span>
    <span class="n">String</span> <span class="nf">getSinkTopic</span><span class="o">();</span>
    <span class="n">String</span> <span class="nf">getOutputSerdeClassName</span><span class="o">();</span>
    <span class="n">String</span> <span class="nf">getTenant</span><span class="o">();</span>
    <span class="n">String</span> <span class="nf">getNamespace</span><span class="o">();</span>
    <span class="n">String</span> <span class="nf">getFunctionName</span><span class="o">();</span>
    <span class="n">String</span> <span class="nf">getFunctionId</span><span class="o">();</span>
    <span class="n">String</span> <span class="nf">getInstanceId</span><span class="o">();</span>
    <span class="n">String</span> <span class="nf">getFunctionVersion</span><span class="o">();</span>
    <span class="n">Logger</span> <span class="nf">getLogger</span><span class="o">();</span>
    <span class="n">Map</span><span class="o">&lt;</span><span class="n">String</span><span class="o">,</span> <span class="n">String</span><span class="o">&gt;</span> <span class="nf">getUserConfigMap</span><span class="o">();</span>
    <span class="n">Optional</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span> <span class="nf">getUserConfigValue</span><span class="o">(</span><span class="n">String</span> <span class="n">key</span><span class="o">);</span>
    <span class="n">String</span> <span class="nf">getUserConfigValueOrDefault</span><span class="o">(</span><span class="n">String</span> <span class="n">key</span><span class="o">,</span> <span class="n">String</span> <span class="k">default</span><span class="o">);</span>
    <span class="kt">void</span> <span class="nf">recordMetric</span><span class="o">(</span><span class="n">String</span> <span class="n">metricName</span><span class="o">,</span> <span class="kt">double</span> <span class="n">value</span><span class="o">);</span>
    <span class="o">&lt;</span><span class="n">O</span><span class="o">&gt;</span> <span class="n">CompletableFuture</span><span class="o">&lt;</span><span class="n">Void</span><span class="o">&gt;</span> <span class="nf">publish</span><span class="o">(</span><span class="n">String</span> <span class="n">topicName</span><span class="o">,</span> <span class="n">O</span> <span class="n">object</span><span class="o">,</span> <span class="n">String</span> <span class="n">serDeClassName</span><span class="o">);</span>
    <span class="o">&lt;</span><span class="n">O</span><span class="o">&gt;</span> <span class="n">CompletableFuture</span><span class="o">&lt;</span><span class="n">Void</span><span class="o">&gt;</span> <span class="nf">publish</span><span class="o">(</span><span class="n">String</span> <span class="n">topicName</span><span class="o">,</span> <span class="n">O</span> <span class="n">object</span><span class="o">);</span>
    <span class="n">CompletableFuture</span><span class="o">&lt;</span><span class="n">Void</span><span class="o">&gt;</span> <span class="nf">ack</span><span class="o">(</span><span class="kt">byte</span><span class="o">[]</span> <span class="n">messageId</span><span class="o">,</span> <span class="n">String</span> <span class="n">topic</span><span class="o">);</span>
<span class="o">}</span>
</code></pre></div></div>

<p>Here’s an example function that uses several methods available via the <code class="highlighter-rouge">Context</code> object:</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">import</span> <span class="nn">org.apache.pulsar.functions.api.Context</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.pulsar.functions.api.Function</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.slf4j.Logger</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">java.util.stream.Collectors</span><span class="o">;</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">ContextFunction</span> <span class="kd">implements</span> <span class="n">Function</span><span class="o">&lt;</span><span class="n">String</span><span class="o">,</span> <span class="n">Void</span><span class="o">&gt;</span> <span class="o">{</span>
    <span class="kd">public</span> <span class="n">Void</span> <span class="nf">process</span><span class="o">(</span><span class="n">String</span> <span class="n">input</span><span class="o">,</span> <span class="n">Context</span> <span class="n">context</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">Logger</span> <span class="n">LOG</span> <span class="o">=</span> <span class="n">context</span><span class="o">.</span><span class="na">getLogger</span><span class="o">();</span>
        <span class="n">String</span> <span class="n">inputTopics</span> <span class="o">=</span> <span class="n">context</span><span class="o">.</span><span class="na">getInputTopics</span><span class="o">().</span><span class="na">stream</span><span class="o">().</span><span class="na">collect</span><span class="o">(</span><span class="n">Collectors</span><span class="o">.</span><span class="na">joining</span><span class="o">(</span><span class="s">", "</span><span class="o">));</span>
        <span class="n">String</span> <span class="n">functionName</span> <span class="o">=</span> <span class="n">context</span><span class="o">.</span><span class="na">getFunctionName</span><span class="o">();</span>

        <span class="n">String</span> <span class="n">logMessage</span> <span class="o">=</span> <span class="n">String</span><span class="o">.</span><span class="na">format</span><span class="o">(</span><span class="s">"A message with a value of \"%s\" has arrived on one of the following topics: %s\n"</span><span class="o">,</span>
                <span class="n">input</span><span class="o">,</span>
                <span class="n">inputTopics</span><span class="o">);</span>

        <span class="n">LOG</span><span class="o">.</span><span class="na">info</span><span class="o">(</span><span class="n">logMessage</span><span class="o">);</span>

        <span class="n">String</span> <span class="n">metricName</span> <span class="o">=</span> <span class="n">String</span><span class="o">.</span><span class="na">format</span><span class="o">(</span><span class="s">"function-%s-messages-received"</span><span class="o">,</span> <span class="n">functionName</span><span class="o">);</span>
        <span class="n">context</span><span class="o">.</span><span class="na">recordMetric</span><span class="o">(</span><span class="n">metricName</span><span class="o">,</span> <span class="mi">1</span><span class="o">);</span>

        <span class="k">return</span> <span class="kc">null</span><span class="o">;</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></div></div>

<h3 id="void-functions">Void functions</h3>

<p>Pulsar Functions can publish results to an output <span class="popover-term" tabindex="0" title="What is a topic?" data-placement="top" data-content="A named channel used to pass messages published by producers to consumers who process those messages." data-toggle="popover" data-trigger="focus">topic</span>, but this isn’t required. You can also have functions that simply produce a log, write results to a database, etc. Here’s a function that writes a simple log every time a message is received:</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">import</span> <span class="nn">org.slf4j.Logger</span><span class="o">;</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">LogFunction</span> <span class="kd">implements</span> <span class="n">PulsarFunction</span><span class="o">&lt;</span><span class="n">String</span><span class="o">,</span> <span class="n">Void</span><span class="o">&gt;</span> <span class="o">{</span>
    <span class="kd">public</span> <span class="n">String</span> <span class="nf">apply</span><span class="o">(</span><span class="n">String</span> <span class="n">input</span><span class="o">,</span> <span class="n">Context</span> <span class="n">context</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">Logger</span> <span class="n">LOG</span> <span class="o">=</span> <span class="n">context</span><span class="o">.</span><span class="na">getLogger</span><span class="o">();</span>
        <span class="n">LOG</span><span class="o">.</span><span class="na">info</span><span class="o">(</span><span class="s">"The following message was received: {}"</span><span class="o">,</span> <span class="n">input</span><span class="o">);</span>
        <span class="k">return</span> <span class="kc">null</span><span class="o">;</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></div></div>

<!--

    Licensed to the Apache Software Foundation (ASF) under one
    or more contributor license agreements.  See the NOTICE file
    distributed with this work for additional information
    regarding copyright ownership.  The ASF licenses this file
    to you under the Apache License, Version 2.0 (the
    "License"); you may not use this file except in compliance
    with the License.  You may obtain a copy of the License at

      http://www.apache.org/licenses/LICENSE-2.0

    Unless required by applicable law or agreed to in writing,
    software distributed under the License is distributed on an
    "AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
    KIND, either express or implied.  See the License for the
    specific language governing permissions and limitations
    under the License.

-->
<div class="admonition">
  <div class="warning">
    
    <p>When using Java functions in which the output type is <code class="highlighter-rouge">Void</code>, the function must <em>always</em> return <code class="highlighter-rouge">null</code>.</p>

  </div>
</div>

<h3 id="java-serde">Java SerDe</h3>

<p>Pulsar Functions use <a href="#serde">SerDe</a> when publishing data to and consuming data from Pulsar topics. When you’re writing Pulsar Functions in Java, the following basic Java types are built in and supported by default:</p>

<ul>
  <li><code class="highlighter-rouge">String</code></li>
  <li><code class="highlighter-rouge">Double</code></li>
  <li><code class="highlighter-rouge">Integer</code></li>
  <li><code class="highlighter-rouge">Float</code></li>
  <li><code class="highlighter-rouge">Long</code></li>
  <li><code class="highlighter-rouge">Short</code></li>
  <li><code class="highlighter-rouge">Byte</code></li>
</ul>

<p>Built-in vs. custom. For custom, you need to implement this interface:</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">public</span> <span class="kd">interface</span> <span class="nc">SerDe</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span> <span class="o">{</span>
    <span class="n">T</span> <span class="nf">deserialize</span><span class="o">(</span><span class="kt">byte</span><span class="o">[]</span> <span class="n">input</span><span class="o">);</span>
    <span class="kt">byte</span><span class="o">[]</span> <span class="nf">serialize</span><span class="o">(</span><span class="n">T</span> <span class="n">input</span><span class="o">);</span>
<span class="o">}</span>
</code></pre></div></div>

<h4 id="java-serde-example">Java SerDe example</h4>

<p>Imagine that you’re writing Pulsar Functions in Java that are processing tweet objects. Here’s a simple example <code class="highlighter-rouge">Tweet</code> class:</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">public</span> <span class="kd">class</span> <span class="nc">Tweet</span> <span class="o">{</span>
    <span class="kd">private</span> <span class="n">String</span> <span class="n">username</span><span class="o">;</span>
    <span class="kd">private</span> <span class="n">String</span> <span class="n">tweetContent</span><span class="o">;</span>

    <span class="kd">public</span> <span class="nf">Tweet</span><span class="o">(</span><span class="n">String</span> <span class="n">username</span><span class="o">,</span> <span class="n">String</span> <span class="n">tweetContent</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">this</span><span class="o">.</span><span class="na">username</span> <span class="o">=</span> <span class="n">username</span><span class="o">;</span>
        <span class="k">this</span><span class="o">.</span><span class="na">tweetContent</span> <span class="o">=</span> <span class="n">tweetContent</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="c1">// Standard setters and getters</span>
<span class="o">}</span>
</code></pre></div></div>

<p>In order to be able to pass <code class="highlighter-rouge">Tweet</code> objects directly between Pulsar Functions, you’ll need to provide a custom SerDe class. In the example below, <code class="highlighter-rouge">Tweet</code> objects are basically strings in which the username and tweet content are separated by a <code class="highlighter-rouge">|</code>.</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">package</span> <span class="n">com</span><span class="o">.</span><span class="na">example</span><span class="o">.</span><span class="na">serde</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">org.apache.pulsar.functions.api.SerDe</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">java.util.regex.Pattern</span><span class="o">;</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">TweetSerde</span> <span class="kd">implements</span> <span class="n">SerDe</span><span class="o">&lt;</span><span class="n">Tweet</span><span class="o">&gt;</span> <span class="o">{</span>
    <span class="kd">public</span> <span class="n">Tweet</span> <span class="nf">deserialize</span><span class="o">(</span><span class="kt">byte</span><span class="o">[]</span> <span class="n">input</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">String</span> <span class="n">s</span> <span class="o">=</span> <span class="k">new</span> <span class="n">String</span><span class="o">(</span><span class="n">input</span><span class="o">);</span>
        <span class="n">String</span><span class="o">[]</span> <span class="n">fields</span> <span class="o">=</span> <span class="n">s</span><span class="o">.</span><span class="na">split</span><span class="o">(</span><span class="n">Pattern</span><span class="o">.</span><span class="na">quote</span><span class="o">(</span><span class="s">"|"</span><span class="o">));</span>
        <span class="k">return</span> <span class="k">new</span> <span class="nf">Tweet</span><span class="o">(</span><span class="n">fields</span><span class="o">[</span><span class="mi">0</span><span class="o">],</span> <span class="n">fields</span><span class="o">[</span><span class="mi">1</span><span class="o">]);</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kt">byte</span><span class="o">[]</span> <span class="nf">serialize</span><span class="o">(</span><span class="n">Tweet</span> <span class="n">input</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">return</span> <span class="s">"%s|%s"</span><span class="o">.</span><span class="na">format</span><span class="o">(</span><span class="n">input</span><span class="o">.</span><span class="na">getUsername</span><span class="o">(),</span> <span class="n">input</span><span class="o">.</span><span class="na">getTweetContent</span><span class="o">()).</span><span class="na">getBytes</span><span class="o">();</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></div></div>

<p>To apply this custom SerDe to a particular Pulsar Function, you would need to:</p>

<ul>
  <li>Package the <code class="highlighter-rouge">Tweet</code> and <code class="highlighter-rouge">TweetSerde</code> classes into a JAR</li>
  <li>Specify a path to the JAR and SerDe class name when deploying the function</li>
</ul>

<p>Here’s an example <a href="../../reference/CliTools#pulsar-admin-functions-create"><code class="highlighter-rouge">create</code></a> operation:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>bin/pulsar-admin functions create <span class="se">\</span>
  <span class="nt">--jar</span> /path/to/your.jar <span class="se">\</span>
  <span class="nt">--outputSerdeClassName</span> com.example.serde.TweetSerde <span class="se">\</span>
  <span class="c"># Other function attributes</span>
</code></pre></div></div>

<!--

    Licensed to the Apache Software Foundation (ASF) under one
    or more contributor license agreements.  See the NOTICE file
    distributed with this work for additional information
    regarding copyright ownership.  The ASF licenses this file
    to you under the Apache License, Version 2.0 (the
    "License"); you may not use this file except in compliance
    with the License.  You may obtain a copy of the License at

      http://www.apache.org/licenses/LICENSE-2.0

    Unless required by applicable law or agreed to in writing,
    software distributed under the License is distributed on an
    "AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
    KIND, either express or implied.  See the License for the
    specific language governing permissions and limitations
    under the License.

-->
<div class="admonition">
  <div class="warning">
    <span class="admonition-title"><p>Custom SerDe classes must be packaged with your function JARs</p>
</span>
    
<p>Pulsar does not store your custom SerDe classes separately from your Pulsar Functions. That means that you’ll need to always include your SerDe classes in your function JARs. If not, Pulsar will return an error.</p>

  </div>
</div>

<h3 id="java-logging">Java logging</h3>

<p>Pulsar Functions that use the <a href="#java-sdk">Java SDK</a> have access to an <a href="https://www.slf4j.org/">SLF4j</a> <a href="https://www.slf4j.org/api/org/apache/log4j/Logger.html"><code class="highlighter-rouge">Logger</code></a> object that can be used to produce logs at the chosen log level. Here’s a simple example function that logs either a <code class="highlighter-rouge">WARNING</code>- or <code class="highlighter-rouge">INFO</code>-level log based on whether the incoming string contains the word <code class="highlighter-rouge">danger</code>:</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">import</span> <span class="nn">org.apache.pulsar.functions.api.Context</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.pulsar.functions.api.Function</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.slf4j.Logger</span><span class="o">;</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">LoggingFunction</span> <span class="kd">implements</span> <span class="n">Function</span><span class="o">&lt;</span><span class="n">String</span><span class="o">,</span> <span class="n">Void</span><span class="o">&gt;</span> <span class="o">{</span>
    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">apply</span><span class="o">(</span><span class="n">String</span> <span class="n">input</span><span class="o">,</span> <span class="n">Context</span> <span class="n">context</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">Logger</span> <span class="n">LOG</span> <span class="o">=</span> <span class="n">context</span><span class="o">.</span><span class="na">getLogger</span><span class="o">();</span>
        <span class="n">String</span> <span class="n">messageId</span> <span class="o">=</span> <span class="k">new</span> <span class="n">String</span><span class="o">(</span><span class="n">context</span><span class="o">.</span><span class="na">getMessageId</span><span class="o">());</span>

        <span class="k">if</span> <span class="o">(</span><span class="n">input</span><span class="o">.</span><span class="na">contains</span><span class="o">(</span><span class="s">"danger"</span><span class="o">))</span> <span class="o">{</span>
            <span class="n">LOG</span><span class="o">.</span><span class="na">warn</span><span class="o">(</span><span class="s">"A warning was received in message {}"</span><span class="o">,</span> <span class="n">messageId</span><span class="o">);</span>
        <span class="o">}</span> <span class="k">else</span> <span class="o">{</span>
            <span class="n">LOG</span><span class="o">.</span><span class="na">info</span><span class="o">(</span><span class="s">"Message {} received\nContent: {}"</span><span class="o">,</span> <span class="n">messageId</span><span class="o">,</span> <span class="n">input</span><span class="o">);</span>
        <span class="o">}</span>

        <span class="k">return</span> <span class="kc">null</span><span class="o">;</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></div></div>

<p>If you want your function to produce logs, you need to specify a log topic when creating or running the function. Here’s an example:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>bin/pulsar-admin functions create <span class="se">\</span>
  <span class="nt">--jar</span> my-functions.jar <span class="se">\</span>
  <span class="nt">--className</span> my.package.LoggingFunction <span class="se">\</span>
  <span class="nt">--logTopic</span> persistent://sample/standalone/ns1/logging-function-logs <span class="se">\</span>
  <span class="c"># Other function configs</span>
</code></pre></div></div>

<p>Now, all logs produced by the <code class="highlighter-rouge">LoggingFunction</code> above can be accessed via the <code class="highlighter-rouge">persistent://sample/standalone/ns1/logging-function-logs</code> topic.</p>

<h3 id="java-user-config">Java user config</h3>

<p>The Java SDK’s <a href="#java-context"><code class="highlighter-rouge">Context</code></a> object enables you to access key/value pairs provided to the Pulsar Function via the command line (as JSON). Here’s an example function creation command that passes a key/value pair:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>bin/pulsar-admin functions create <span class="se">\</span>
  <span class="c"># Other function configs</span>
  <span class="nt">--userConfig</span> <span class="s1">'{"word-of-the-day":"verdure"}'</span>
</code></pre></div></div>

<p>To access that value in a Java function:</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">import</span> <span class="nn">org.apache.pulsar.functions.api.Context</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.pulsar.functions.api.Function</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.slf4j.Logger</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">java.util.Optional</span><span class="o">;</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">UserConfigFunction</span> <span class="kd">implements</span> <span class="n">Function</span><span class="o">&lt;</span><span class="n">String</span><span class="o">,</span> <span class="n">Void</span><span class="o">&gt;</span> <span class="o">{</span>
    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">apply</span><span class="o">(</span><span class="n">String</span> <span class="n">input</span><span class="o">,</span> <span class="n">Context</span> <span class="n">context</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">Logger</span> <span class="n">LOG</span> <span class="o">=</span> <span class="n">context</span><span class="o">.</span><span class="na">getLogger</span><span class="o">();</span>
        <span class="n">Optional</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span> <span class="n">wotd</span> <span class="o">=</span> <span class="n">context</span><span class="o">.</span><span class="na">getUserConfigValue</span><span class="o">(</span><span class="s">"word-of-the-day"</span><span class="o">);</span>
        <span class="k">if</span> <span class="o">(</span><span class="n">wotd</span><span class="o">.</span><span class="na">isPresent</span><span class="o">())</span> <span class="o">{</span>
            <span class="n">LOG</span><span class="o">.</span><span class="na">info</span><span class="o">(</span><span class="s">"The word of the day is {}"</span><span class="o">,</span> <span class="n">wotd</span><span class="o">);</span>
        <span class="o">}</span> <span class="k">else</span> <span class="o">{</span>
            <span class="n">LOG</span><span class="o">.</span><span class="na">warn</span><span class="o">(</span><span class="s">"No word of the day provided"</span><span class="o">);</span>
        <span class="o">}</span>
        <span class="k">return</span> <span class="kc">null</span><span class="o">;</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></div></div>

<p>The <code class="highlighter-rouge">UserConfigFunction</code> function will log the string <code class="highlighter-rouge">"The word of the day is verdure"</code> every time the function is invoked (i.e. every time a message arrives). The <code class="highlighter-rouge">word-of-the-day</code> user config will be changed only when the function is updated with a new config value via the command line.</p>

<p>You can also access the entire user config map or set a default value in case no value is present:</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// Get the whole config map</span>
<span class="n">Map</span><span class="o">&lt;</span><span class="n">String</span><span class="o">,</span> <span class="n">String</span><span class="o">&gt;</span> <span class="n">allConfigs</span> <span class="o">=</span> <span class="n">context</span><span class="o">.</span><span class="na">getUserConfigMap</span><span class="o">();</span>

<span class="c1">// Get value or resort to default</span>
<span class="n">String</span> <span class="n">wotd</span> <span class="o">=</span> <span class="n">context</span><span class="o">.</span><span class="na">getUserConfigValueOrDefault</span><span class="o">(</span><span class="s">"word-of-the-day"</span><span class="o">,</span> <span class="s">"perspicacious"</span><span class="o">);</span>
</code></pre></div></div>

<!--

    Licensed to the Apache Software Foundation (ASF) under one
    or more contributor license agreements.  See the NOTICE file
    distributed with this work for additional information
    regarding copyright ownership.  The ASF licenses this file
    to you under the Apache License, Version 2.0 (the
    "License"); you may not use this file except in compliance
    with the License.  You may obtain a copy of the License at

      http://www.apache.org/licenses/LICENSE-2.0

    Unless required by applicable law or agreed to in writing,
    software distributed under the License is distributed on an
    "AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
    KIND, either express or implied.  See the License for the
    specific language governing permissions and limitations
    under the License.

-->
<div class="admonition">
  <div class="info">
    
    <p>For all key/value pairs passed to Java Pulsar Functions, both the key <em>and</em> the value are <code class="highlighter-rouge">String</code>s. If you’d like the value to be of a different type, you will need to deserialize from the <code class="highlighter-rouge">String</code> type.</p>

  </div>
</div>

<h3 id="java-metrics">Java metrics</h3>

<p>You can record metrics using the <a href="#java-context"><code class="highlighter-rouge">Context</code></a> object on a per-key basis. You can, for example, set a metric for the key <code class="highlighter-rouge">process-count</code> and a different metric for the key <code class="highlighter-rouge">elevens-count</code> every time the function processes a message. Here’s an example:</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">import</span> <span class="nn">org.apache.pulsar.functions.api.Context</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.pulsar.functions.api.Function</span><span class="o">;</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">MetricRecorderFunction</span> <span class="kd">implements</span> <span class="n">Function</span><span class="o">&lt;</span><span class="n">Integer</span><span class="o">,</span> <span class="n">Void</span><span class="o">&gt;</span> <span class="o">{</span>
    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">apply</span><span class="o">(</span><span class="n">Integer</span> <span class="n">input</span><span class="o">,</span> <span class="n">Context</span> <span class="n">context</span><span class="o">)</span> <span class="o">{</span>
        <span class="c1">// Records the metric 1 every time a message arrives</span>
        <span class="n">context</span><span class="o">.</span><span class="na">recordMetric</span><span class="o">(</span><span class="s">"hit-count"</span><span class="o">,</span> <span class="mi">1</span><span class="o">);</span>

        <span class="c1">// Records the metric only if the arriving number equals 11</span>
        <span class="k">if</span> <span class="o">(</span><span class="n">input</span> <span class="o">==</span> <span class="mi">11</span><span class="o">)</span> <span class="o">{</span>
            <span class="n">context</span><span class="o">.</span><span class="na">recordMetric</span><span class="o">(</span><span class="s">"elevens-count"</span><span class="o">,</span> <span class="mi">1</span><span class="o">);</span>
        <span class="o">}</span>

        <span class="k">return</span> <span class="kc">null</span><span class="o">;</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></div></div>

<!--

    Licensed to the Apache Software Foundation (ASF) under one
    or more contributor license agreements.  See the NOTICE file
    distributed with this work for additional information
    regarding copyright ownership.  The ASF licenses this file
    to you under the Apache License, Version 2.0 (the
    "License"); you may not use this file except in compliance
    with the License.  You may obtain a copy of the License at

      http://www.apache.org/licenses/LICENSE-2.0

    Unless required by applicable law or agreed to in writing,
    software distributed under the License is distributed on an
    "AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
    KIND, either express or implied.  See the License for the
    specific language governing permissions and limitations
    under the License.

-->
<div class="admonition">
  <div class="info">
    
    <p>For instructions on reading and using metrics, see the <a href="../../deployment/Monitoring">Monitoring</a> guide.</p>

  </div>
</div>

<h2 id="python">Pulsar Functions for Python</h2>

<p>Writing Pulsar Functions in Python entails implementing one of two things:</p>

<ul>
  <li>A <code class="highlighter-rouge">process</code> function that takes an input (message data from the function’s input topic(s)), applies some kind of logic to it, and either returns an object (to be published to the function’s output topic) or <code class="highlighter-rouge">pass</code>es and thus doesn’t produce a message</li>
  <li>A <code class="highlighter-rouge">Function</code> class that has a <code class="highlighter-rouge">process</code> method that provides a message input to process and a <a href="#python-context">context</a> object</li>
</ul>

<h3 id="getting-started-1">Getting started</h3>

<p>Regardless of which <a href="../deployment">deployment mode</a> you’re using, you’ll need to install the following Python libraries on any machine that’s running Pulsar Functions written in Python:</p>

<!--

    Licensed to the Apache Software Foundation (ASF) under one
    or more contributor license agreements.  See the NOTICE file
    distributed with this work for additional information
    regarding copyright ownership.  The ASF licenses this file
    to you under the Apache License, Version 2.0 (the
    "License"); you may not use this file except in compliance
    with the License.  You may obtain a copy of the License at

      http://www.apache.org/licenses/LICENSE-2.0

    Unless required by applicable law or agreed to in writing,
    software distributed under the License is distributed on an
    "AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
    KIND, either express or implied.  See the License for the
    specific language governing permissions and limitations
    under the License.

-->
<ul>
  
  <li>
    <a href="https://pypi.org/project/pulsar-client">
      <code>pulsar-client</code>
    </a>
  </li>
  
  <li>
    <a href="https://pypi.org/project/protobuf">
      <code>protobuf</code>
    </a>
  </li>
  
  <li>
    <a href="https://pypi.org/project/futures">
      <code>futures</code>
    </a>
  </li>
  
  <li>
    <a href="https://pypi.org/project/grpcio">
      <code>grpcio</code>
    </a>
  </li>
  
  <li>
    <a href="https://pypi.org/project/grpcio-tools">
      <code>grpcio-tools</code>
    </a>
  </li>
  
</ul>

<p>That could be your local machine for <a href="../deployment#local-run">local run mode</a> or a machine running a Pulsar <span class="popover-term" tabindex="0" title="What is a broker?" data-placement="top" data-content="A stateless component of Pulsar clusters that runs two other components: an HTTP server exposing a REST interface for administration and topic lookup and a dispatcher that handles all message transers. Pulsar clusters typically consist of multiple brokers." data-toggle="popover" data-trigger="focus">broker</span> for <a href="../deployment#cluster-mode">cluster mode</a>. To install those libraries using pip:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>pip <span class="nb">install </span>pulsar-client protobuf futures grpcio grpcio-tools
</code></pre></div></div>

<h3 id="packaging">Packaging</h3>

<p>At the moment, the code for Pulsar Functions written in Python must be contained within a single Python file. In the future, Pulsar Functions may support other packaging formats, such as <a href="https://github.com/pantsbuild/pex"><strong>P</strong>ython <strong>EX</strong>ecutables</a> (PEXes).</p>

<h3 id="python-native">Python native functions</h3>

<p>If your function doesn’t require access to its <a href="#context">context</a>, you can create a Pulsar Function by implementing a <code class="highlighter-rouge">process</code> function, which provides a single input object that you can process however you wish. Here’s an example function that takes a string as its input, adds an exclamation point at the end of the string, and then publishes the resulting string:</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">process</span><span class="p">(</span><span class="nb">input</span><span class="p">):</span>
    <span class="k">return</span> <span class="s">"{0}!"</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">input</span><span class="p">)</span>
</code></pre></div></div>

<p>In general, you should use native functions when you don’t need access to the function’s <a href="#context">context</a>. If you <em>do</em> need access to the function’s context, then we recommend using the <a href="#python-sdk">Pulsar Functions Python SDK</a>.</p>

<h4 id="python-native-examples">Python native examples</h4>

<p>There is one example Python native function in <a href="https://github.com/apache/incubator-pulsar/tree/master/pulsar-functions/python-examples">this folder</a>:</p>

<ul>
  <li><a href="https://github.com/apache/incubator-pulsar/blob/master/pulsar-functions/python-examples/pure_python_function_exclamation.py"><code class="highlighter-rouge">pure_python_function_exclamation.py</code></a></li>
</ul>

<h3 id="python-sdk">Python SDK functions</h3>

<p>To get started developing Pulsar Functions using the Python SDK, you’ll need to install the <a href="/api/python"><code class="highlighter-rouge">pulsar-client</code></a> library using the instructions <a href="#getting-started">above</a>.</p>

<h4 id="python-sdk-examples">Python SDK examples</h4>

<p>There are several example Python functions in <a href="https://github.com/apache/incubator-pulsar/blob/master/pulsar-functions/python-examples">this folder</a>:</p>

<table>
  <thead>
    <tr>
      <th style="text-align: left">Function file</th>
      <th style="text-align: left">Description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td style="text-align: left"><a href="https://github.com/apache/incubator-pulsar/blob/master/pulsar-functions/python-examples/exclamation.py"><code class="highlighter-rouge">exclamation.py</code></a></td>
      <td style="text-align: left">Adds an exclamation point at the end of each incoming string</td>
    </tr>
    <tr>
      <td style="text-align: left"><a href="https://github.com/apache/incubator-pulsar/blob/master/pulsar-functions/python-examples/logfunction.py"><code class="highlighter-rouge">logfunction.py</code></a></td>
      <td style="text-align: left">Logs each incoming message</td>
    </tr>
    <tr>
      <td style="text-align: left"><a href="https://github.com/apache/incubator-pulsar/blob/master/pulsar-functions/python-examples/thumbnailer.py"><code class="highlighter-rouge">thumbnailer.py</code></a></td>
      <td style="text-align: left">Takes image data as input and outputs a 128x128 thumbnail of each image</td>
    </tr>
  </tbody>
</table>

<h4 id="python-context">Python context object</h4>

<p>The <a href="https://github.com/apache/incubator-pulsar/blob/master/pulsar-client-cpp/python/functions/context.py"><code class="highlighter-rouge">Context</code></a> class provides a number of methods that you can use to access the function’s <a href="#context">context</a>. The various methods for the <code class="highlighter-rouge">Context</code> class are listed below:</p>

<table>
  <thead>
    <tr>
      <th style="text-align: left">Method</th>
      <th style="text-align: left">What it provides</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td style="text-align: left"><code class="highlighter-rouge">get_message_id</code></td>
      <td style="text-align: left">The message ID of the message being processed</td>
    </tr>
    <tr>
      <td style="text-align: left"><code class="highlighter-rouge">get_topic_name</code></td>
      <td style="text-align: left">The input topic of the message being processed</td>
    </tr>
    <tr>
      <td style="text-align: left"><code class="highlighter-rouge">get_function_name</code></td>
      <td style="text-align: left">The name of the current Pulsar Function</td>
    </tr>
    <tr>
      <td style="text-align: left"><code class="highlighter-rouge">get_function_id</code></td>
      <td style="text-align: left">The ID of the current Pulsar Function</td>
    </tr>
    <tr>
      <td style="text-align: left"><code class="highlighter-rouge">get_instance_id</code></td>
      <td style="text-align: left">The ID of the current Pulsar Functions instance</td>
    </tr>
    <tr>
      <td style="text-align: left"><code class="highlighter-rouge">get_function_version</code></td>
      <td style="text-align: left">The version of the current Pulsar Function</td>
    </tr>
    <tr>
      <td style="text-align: left"><code class="highlighter-rouge">get_logger</code></td>
      <td style="text-align: left">A logger object that can be used for <a href="#python-logging">logging</a></td>
    </tr>
    <tr>
      <td style="text-align: left"><code class="highlighter-rouge">get_user_config_value</code></td>
      <td style="text-align: left">Returns the value of a <a href="#python-user-config">user-defined config</a> (or <code class="highlighter-rouge">None</code> if the config doesn’t exist)</td>
    </tr>
    <tr>
      <td style="text-align: left"><code class="highlighter-rouge">get_user_config_map</code></td>
      <td style="text-align: left">Returns the entire user-defined config as a dict</td>
    </tr>
    <tr>
      <td style="text-align: left"><code class="highlighter-rouge">record_metric</code></td>
      <td style="text-align: left">Records a per-key <a href="#python-metrics">metric</a></td>
    </tr>
    <tr>
      <td style="text-align: left"><code class="highlighter-rouge">publish</code></td>
      <td style="text-align: left">Publishes a message to the specified Pulsar topic</td>
    </tr>
    <tr>
      <td style="text-align: left"><code class="highlighter-rouge">get_output_serde_class_name</code></td>
      <td style="text-align: left">The name of the output <a href="#python-serde">SerDe</a> class</td>
    </tr>
    <tr>
      <td style="text-align: left"><code class="highlighter-rouge">ack</code></td>
      <td style="text-align: left"><span class="popover-term" tabindex="0" title="What is an acknowledgement (ack)?" data-placement="top" data-content="A message sent to a Pulsar broker by a consumer that a message has been successfully processed. An acknowledgement (ack) is Pulsar's way of knowing that the message can be deleted from the system; if no acknowledgement, then the message will be retained until it's processed." data-toggle="popover" data-trigger="focus">Acks</span> the message being processed to Pulsar</td>
    </tr>
  </tbody>
</table>

<h3 id="python-serde">Python SerDe</h3>

<p>Pulsar Functions use <a href="#serde">SerDe</a> when publishing data to and consuming data from Pulsar topics (this is true of both <a href="#python-native">native</a> functions and <a href="#python-sdk">SDK</a> functions). You can specify the SerDe when <a href="../deployment#cluster-mode">creating</a> or <a href="../deployment#local-run">running</a> functions. Here’s an example:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>bin/pulsar-admin functions create <span class="se">\</span>
  <span class="nt">--tenant</span> sample <span class="se">\</span>
  <span class="nt">--namespace</span> ns1 <span class="se">\</span>
  <span class="nt">--name</span> my_function <span class="se">\</span>
  <span class="nt">--py</span> my_function.py <span class="se">\</span>
  <span class="nt">--className</span> my_function.MyFunction <span class="se">\</span>
  <span class="nt">--customSerdeInputs</span> <span class="s1">'{"input-topic-1":"Serde1","input-topic-2":"Serde2"}'</span> <span class="se">\</span>
  <span class="nt">--outputSerdeClassName</span> Serde3 <span class="se">\</span>
  <span class="nt">--output</span> output-topic-1
</code></pre></div></div>

<p>In this case, there are two input topics, <code class="highlighter-rouge">input-topic-1</code> and <code class="highlighter-rouge">input-topic-2</code>, each of which is mapped to a different SerDe class (the map must be specified as a JSON string). The output topic, <code class="highlighter-rouge">output-topic-1</code>, uses the <code class="highlighter-rouge">Serde3</code> class for SerDe. At the moment, all Pulsar Function logic, include processing function and SerDe classes, must be contained within a single Python file.</p>

<p>When using Pulsar Functions for Python, you essentially have three SerDe options:</p>

<ol>
  <li>You can use the <a href="https://github.com/apache/incubator-pulsar/blob/master/pulsar-client-cpp/python/functions/serde.py#L70"><code class="highlighter-rouge">IdentitySerde</code></a>, which leaves the data unchanged. The <code class="highlighter-rouge">IdentitySerDe</code> is the <strong>default</strong>. Creating or running a function without explicitly specifying SerDe will mean that this option is used.</li>
  <li>You can use the <a href="https://github.com/apache/incubator-pulsar/blob/master/pulsar-client-cpp/python/functions/serde.py#L62"><code class="highlighter-rouge">PickeSerDe</code></a>, which uses Python’s <a href="https://docs.python.org/3/library/pickle.html"><code class="highlighter-rouge">pickle</code></a> for SerDe.</li>
  <li>You can create a custom SerDe class by implementing the baseline <a href="https://github.com/apache/incubator-pulsar/blob/master/pulsar-client-cpp/python/functions/serde.py#L50"><code class="highlighter-rouge">SerDe</code></a> class, which has just two methods: <a href="https://github.com/apache/incubator-pulsar/blob/master/pulsar-client-cpp/python/functions/serde.py#L53"><code class="highlighter-rouge">serialize</code></a> for converting the object into bytes, and <a href="https://github.com/apache/incubator-pulsar/blob/master/pulsar-client-cpp/python/functions/serde.py#L58"><code class="highlighter-rouge">deserialize</code></a> for converting bytes into an object of the required application-specific type.</li>
</ol>

<p>The table below shows when you should use each SerDe:</p>

<table>
  <thead>
    <tr>
      <th style="text-align: left">SerDe option</th>
      <th style="text-align: left">When to use</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td style="text-align: left"><code class="highlighter-rouge">IdentitySerde</code></td>
      <td style="text-align: left">When you’re working with simple types like strings, Booleans, integers, and the like</td>
    </tr>
    <tr>
      <td style="text-align: left"><code class="highlighter-rouge">PickleSerDe</code></td>
      <td style="text-align: left">When you’re working with complex, application-specific types and are comfortable with <code class="highlighter-rouge">pickle</code>’s “best effort” approach</td>
    </tr>
    <tr>
      <td style="text-align: left">Custom SerDe</td>
      <td style="text-align: left">When you require explicit control over SerDe, potentially for performance or data compatibility purposes</td>
    </tr>
  </tbody>
</table>

<h4 id="python-serde-example">Python SerDe example</h4>

<p>Imagine that you’re writing Pulsar Functions in Python that are processing tweet objects. Here’s a simple <code class="highlighter-rouge">Tweet</code> class:</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">class</span> <span class="nc">Tweet</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">username</span><span class="p">,</span> <span class="n">tweet_content</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">username</span> <span class="o">=</span> <span class="n">username</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tweet_content</span> <span class="o">=</span> <span class="n">tweet_content</span>
</code></pre></div></div>

<p>In order to use this class in Pulsar Functions, you’d have two options:</p>

<ol>
  <li>You could specify <code class="highlighter-rouge">PickleSerDe</code>, which would apply the <a href="https://docs.python.org/3/library/pickle.html"><code class="highlighter-rouge">pickle</code></a> library’s SerDe</li>
  <li>You could create your own SerDe class. Here’s a simple example:</li>
</ol>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  <span class="kn">from</span> <span class="nn">pulsar</span> <span class="kn">import</span> <span class="n">SerDe</span>

  <span class="k">class</span> <span class="nc">TweetSerDe</span><span class="p">(</span><span class="n">SerDe</span><span class="p">):</span>
      <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">tweet</span><span class="p">):</span>
          <span class="bp">self</span><span class="o">.</span><span class="n">tweet</span> <span class="o">=</span> <span class="n">tweet</span>

      <span class="k">def</span> <span class="nf">serialize</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="nb">input</span><span class="p">):</span>
          <span class="k">return</span> <span class="nb">bytes</span><span class="p">(</span><span class="s">"{0}|{1}"</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tweet</span><span class="o">.</span><span class="n">username</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">tweet</span><span class="o">.</span><span class="n">tweet_content</span><span class="p">))</span>

      <span class="k">def</span> <span class="nf">deserialize</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">input_bytes</span><span class="p">):</span>
          <span class="n">tweet_components</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">input_bytes</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">'|'</span><span class="p">)</span>
          <span class="k">return</span> <span class="n">Tweet</span><span class="p">(</span><span class="n">tweet_components</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">tweet_componentsp</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
</code></pre></div></div>

<h3 id="python-logging">Python logging</h3>

<p>Pulsar Functions that use the <a href="#python-sdk">Python SDK</a> have access to a logging object that can be used to produce logs at the chosen log level. Here’s a simple example function that logs either a <code class="highlighter-rouge">WARNING</code>- or <code class="highlighter-rouge">INFO</code>-level log based on whether the incoming string contains the word <code class="highlighter-rouge">danger</code>:</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">from</span> <span class="nn">pulsar</span> <span class="kn">import</span> <span class="n">Function</span>

<span class="k">class</span> <span class="nc">LoggingFunction</span><span class="p">(</span><span class="n">Function</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">process</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="nb">input</span><span class="p">,</span> <span class="n">context</span><span class="p">):</span>
        <span class="n">logger</span> <span class="o">=</span> <span class="n">context</span><span class="o">.</span><span class="n">get_logger</span><span class="p">()</span>
        <span class="n">msg_id</span> <span class="o">=</span> <span class="n">context</span><span class="o">.</span><span class="n">get_message_id</span><span class="p">()</span>
        <span class="k">if</span> <span class="s">'danger'</span> <span class="ow">in</span> <span class="nb">input</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="s">"A warning was received in message {0}"</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">context</span><span class="o">.</span><span class="n">get_message_id</span><span class="p">()))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s">"Message {0} received</span><span class="se">\n</span><span class="s">Content: {1}"</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">msg_id</span><span class="p">,</span> <span class="nb">input</span><span class="p">))</span>
</code></pre></div></div>

<p>If you want your function to produce logs on a Pulsar topic, you need to specify a <strong>log topic</strong> when creating or running the function. Here’s an example:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>bin/pulsar-admin functions create <span class="se">\</span>
  <span class="nt">--py</span> logging_function.py <span class="se">\</span>
  <span class="nt">--className</span> logging_function.LoggingFunction <span class="se">\</span>
  <span class="nt">--logTopic</span> logging-function-logs <span class="se">\</span>
  <span class="c"># Other function configs</span>
</code></pre></div></div>

<p>Now, all logs produced by the <code class="highlighter-rouge">LoggingFunction</code> above can be accessed via the <code class="highlighter-rouge">logging-function-logs</code> topic.</p>

<h3 id="python-user-config">Python user config</h3>

<p>The Python SDK’s <a href="#python-context"><code class="highlighter-rouge">Context</code></a> object enables you to access key/value pairs provided to the Pulsar Function via the command line (as JSON). Here’s an example function creation command that passes a key/value pair:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>bin/pulsar-admin functions create <span class="se">\</span>
  <span class="c"># Other function configs \</span>
  <span class="nt">--userConfig</span> <span class="s1">'{"word-of-the-day":"verdure"}'</span>
</code></pre></div></div>

<p>To access that value in a Python function:</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">from</span> <span class="nn">pulsar</span> <span class="kn">import</span> <span class="n">Function</span>

<span class="k">class</span> <span class="nc">UserConfigFunction</span><span class="p">(</span><span class="n">Function</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">process</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="nb">input</span><span class="p">,</span> <span class="n">context</span><span class="p">):</span>
        <span class="n">logger</span> <span class="o">=</span> <span class="n">context</span><span class="o">.</span><span class="n">get_logger</span><span class="p">()</span>
        <span class="n">wotd</span> <span class="o">=</span> <span class="n">context</span><span class="o">.</span><span class="n">get_user_config_value</span><span class="p">(</span><span class="s">'word-of-the-day'</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">wotd</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="s">'No word of the day provided'</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s">"The word of the day is {0}"</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">wotd</span><span class="p">))</span>
</code></pre></div></div>

<h3 id="python-metrics">Python metrics</h3>

<p>You can record metrics using the <a href="#python-context"><code class="highlighter-rouge">Context</code></a> object on a per-key basis. You can, for example, set a metric for the key <code class="highlighter-rouge">process-count</code> and a different metric for the key <code class="highlighter-rouge">elevens-count</code> every time the function processes a message. Here’s an example:</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">from</span> <span class="nn">pulsar</span> <span class="kn">import</span> <span class="n">Function</span>

<span class="k">class</span> <span class="nc">MetricRecorderFunction</span><span class="p">(</span><span class="n">Function</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">process</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="nb">input</span><span class="p">,</span> <span class="n">context</span><span class="p">):</span>
        <span class="n">context</span><span class="o">.</span><span class="n">record_metric</span><span class="p">(</span><span class="s">'hit-count'</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>

        <span class="k">if</span> <span class="nb">input</span> <span class="o">==</span> <span class="mi">11</span><span class="p">:</span>
            <span class="n">context</span><span class="o">.</span><span class="n">record_metric</span><span class="p">(</span><span class="s">'elevens-count'</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
</code></pre></div></div>

      </section>
    </article>

    <nav class="toc-bar hidden-md-down col-lg-2">
      
      <div id="toc">
        <h4>The Pulsar Functions API</h4>
      </div>
      
    </nav>
  </div>
</div>

      </main>
    </main>

    <!--

    Licensed to the Apache Software Foundation (ASF) under one
    or more contributor license agreements.  See the NOTICE file
    distributed with this work for additional information
    regarding copyright ownership.  The ASF licenses this file
    to you under the Apache License, Version 2.0 (the
    "License"); you may not use this file except in compliance
    with the License.  You may obtain a copy of the License at

      http://www.apache.org/licenses/LICENSE-2.0

    Unless required by applicable law or agreed to in writing,
    software distributed under the License is distributed on an
    "AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
    KIND, either express or implied.  See the License for the
    specific language governing permissions and limitations
    under the License.

-->
<footer class="footer">
  <div class="container">
    <p class="text-center">Copyright 2018 The Apache Software Foundation. All Rights Reserved.</p>
    <p class="text-center">Apache and the Apache feather logo are trademarks of The Apache Software Foundation.</p>
  </div>
</footer>


    

    
    <!--

    Licensed to the Apache Software Foundation (ASF) under one
    or more contributor license agreements.  See the NOTICE file
    distributed with this work for additional information
    regarding copyright ownership.  The ASF licenses this file
    to you under the Apache License, Version 2.0 (the
    "License"); you may not use this file except in compliance
    with the License.  You may obtain a copy of the License at

      http://www.apache.org/licenses/LICENSE-2.0

    Unless required by applicable law or agreed to in writing,
    software distributed under the License is distributed on an
    "AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
    KIND, either express or implied.  See the License for the
    specific language governing permissions and limitations
    under the License.

-->

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-102219959-1', 'auto');
  ga('send', 'pageview');
</script>

    

    <script type="text/javascript">
      var navbarOffset = -1 * (document.getElementsByClassName("navbar")[0].offsetHeight);
      var shiftWindow = function() { scrollBy(0, navbarOffset) };
      window.addEventListener("hashchange", shiftWindow);
      window.addEventListener("pageshow", shiftWindow);
      function load() { if (window.location.hash) shiftWindow(); }
    </script>
  </body>
</html>
